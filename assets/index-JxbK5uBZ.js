import{_ as M,aa as F,r as x,F as V,w as A,o as U,ab as X,c as _,d as b,i as l,j as h,U as $,V as B,J as O,e as g,g as T,f as R,ac as ee,N,h as z,K as te,b as ae,I as S,ad as oe,W as re,ae as j}from"./index-Bx6Y8L80.js";import{E as se,a as le}from"./col-TrHbeXFY.js";import{E as ne}from"./card-fNeABwz5.js";/* empty css            */import{_ as ie}from"./AnimatedNumber-BnUE5Cda.js";import{E as ce,a as pe}from"./skeleton-item-rsqgV45v.js";import{u as Y}from"./meter-5sbrBbgq.js";import{u as L,D as ue}from"./DailyChart-DBNo4Chm.js";import{f as W}from"./date-Cgy1PrMx.js";import{E as me}from"./index-aFn2MKle.js";import{u as de,i as ye,a as he,b as _e,c as fe}from"./installCanvasRenderer-7dDAEUGk.js";import{E as Z}from"./button-8bviUT_H.js";import{B as P}from"./BaseChart-DcPP-dUj.js";import{d as ve}from"./dayjs.min-Cd48fqZ9.js";import{E as ge}from"./dialog-Dt2QUqOw.js";import"./overlay-04qnzRyj.js";import{E as be}from"./scrollbar-DuXO1tWo.js";import{E as we,a as De}from"./radio-group-i8YIvWc2.js";/* empty css              */import{M as ke}from"./MeterTree-CoH_k643.js";import{E as Ce}from"./index-A4BGBRGh.js";/* empty css             *//* empty css                        */import{E as Ee}from"./index-CWCMyxJA.js";import"./plugin-vue_export-helper-CqGSI99y.js";import"./index-iw6eP590.js";import"./index-CuyxIfpa.js";/* empty css                */import"./popper-DBn8ulUn.js";import"./aria-BUADUvnR.js";import"./focus-trap-Ddg061Nm.js";import"./use-form-item-50hJ8Ppj.js";import"./index-AkNVqhGZ.js";import"./icon-6zrsquxY.js";import"./DebounceAndThrottle-B_grFKK4.js";import"./index-DZY-cmUL.js";import"./scroll-BawlEUY1.js";import"./vnode-DK7gyQZj.js";import"./refs-Bp53MkJS.js";import"./MeterDialog-C3DuWE-y.js";import"./form-item-CWYWsPGl.js";import"./castArray-CrUPC_Z8.js";import"./_Uint8Array-B6mJ0Xm4.js";import"./_initCloneObject-nnMrnZRY.js";import"./input-CFaQgGx5.js";import"./checkbox-LjaCbo-5.js";import"./isEqual-BM-Gj-iT.js";import"./date-picker-CfUXe-Kp.js";import"./index-DLcTS03G.js";import"./index-zrRcpBp4.js";import"./select-BmMHn9PT.js";import"./_baseIteratee-CkjM3wkz.js";import"./area-COPnz-hV.js";import"./formula-ClsumsYI.js";import"./formula-SHWkc_ME.js";import"./handleError-DD4JYoq7.js";import"./index-KJp6TXG9.js";import"./constant-Dm8qiNaG.js";import"./constants-NVab_QuI.js";/* empty css                 */import"./tree-Bp6m8vKT.js";const Te={class:"stats-scroll-container"},xe={class:"card-content"},Me={class:"stat-info"},Se={class:"mini-chart-skeleton"},Re={class:"stat-info"},Ve=["title"],$e={class:"stat-value"},Le={class:"stat-time"},We={class:"stat-comparison"},Ae={__name:"EnergyStatsCards",props:{loading:{type:Boolean,default:!1}},setup(y){de([ye,he,_e]);const{t:e}=F(),i=x([]),c=y,o=L(),d=Y(),p=n=>n.toString().replace(/\B(?=(\d{3})+(?!\d))/g,","),t=V(()=>({1:{unit:"m³",name:e("dashboard.water")},2:{unit:"kWh",name:e("dashboard.electricity")},3:{unit:"m³",name:e("dashboard.gas")}})[d.currentSelectedType]||{unit:"",name:e("dashboard.usage")}),a=(n,v)=>!v||v===0?0:Number(((n-v)/v*100).toFixed(2)),s=V(()=>{var n,v,k;return c.loading||o.isLoading?Array(3).fill({title:"",total:0,timeRange:"",data:new Array(24).fill(0),change:0,compareText:""}):[{title:e("dashboard.yesterdayTotal",{type:t.value.name}),total:o.companyReportData.daily.total||0,timeRange:W(new Date,"yyyy-MM-dd"),data:((n=o.companyReportData.daily.data)==null?void 0:n.map(C=>C.Value))||[],change:a(o.companyReportData.daily.total,o.lastCompanyReportData.daily.total),compareText:e("dashboard.comparedToLast")},{title:e("dashboard.monthlyTotal",{type:t.value.name}),total:o.companyReportData.monthly.total||0,timeRange:W(new Date,"yyyy-MM"),data:((v=o.companyReportData.monthly.data)==null?void 0:v.map(C=>C.Value))||[],change:a(o.companyReportData.monthly.total,o.lastCompanyReportData.monthly.total),compareText:e("dashboard.comparedToLast")},{title:e("dashboard.yearlyTotal",{type:t.value.name}),total:o.companyReportData.yearly.total||0,timeRange:W(new Date,"yyyy"),data:((k=o.companyReportData.yearly.data)==null?void 0:k.map(C=>C.Value))||[],change:a(o.companyReportData.yearly.total,o.lastCompanyReportData.yearly.total),compareText:e("dashboard.comparedToLast")}]}),r=(n=[])=>({animation:!1,grid:{top:5,right:5,bottom:5,left:5,containLabel:!1},xAxis:{type:"category",show:!1,boundaryGap:!1},yAxis:{type:"value",show:!1,scale:!0},series:[{type:"line",data:n,smooth:!0,symbol:"none",lineStyle:{width:2,color:"#409EFF"},areaStyle:{color:{type:"linear",x:0,y:0,x2:0,y2:1,colorStops:[{offset:0,color:"rgba(64, 158, 255, 0.3)"},{offset:1,color:"rgba(64, 158, 255, 0.1)"}]}}}]});let m=[];const u=async()=>{c.loading||(m.forEach(n=>n==null?void 0:n.dispose()),m=[],await ee(),i.value.forEach((n,v)=>{if(n&&s.value[v]){const k=fe(n);k.setOption(r(s.value[v].data)),m.push(k)}}))},w=()=>{m.forEach(n=>n==null?void 0:n.resize())};let D=null;const f=()=>{D&&clearTimeout(D),D=setTimeout(async()=>{await u()},300)};return A([s,()=>d.currentSelectedType],f,{deep:!0}),U(()=>{window.addEventListener("resize",w),f()}),X(()=>{window.removeEventListener("resize",w),D&&clearTimeout(D),m.forEach(n=>n==null?void 0:n.dispose()),m=[]}),(n,v)=>{const k=ce,C=pe,G=ie,q=me,J=ne,K=se,H=le;return _(),b("div",Te,[l(H,{gutter:16,class:"energy-stats"},{default:h(()=>[(_(!0),b($,null,B(s.value,(E,Q)=>(_(),O(K,{span:8,key:Q},{default:h(()=>[l(J,{shadow:"hover"},{default:h(()=>[g("div",xe,[y.loading?(_(),b($,{key:0},[g("div",Me,[l(C,{animated:"",rows:3},{template:h(()=>[l(k,{variant:"h3",style:{width:"80%","margin-bottom":"12px"}}),l(k,{variant:"p",style:{width:"70%",margin:"12px 0"}}),l(k,{variant:"text",style:{width:"50%"}})]),_:1})]),g("div",Se,[l(C,{animated:""},{template:h(()=>[l(k,{variant:"image",style:{width:"200px",height:"100px"}})]),_:1})])],64)):(_(),b($,{key:1},[g("div",Re,[g("h3",{class:"stat-title",title:E.title},T(E.title),9,Ve),g("p",$e,[l(G,{value:E.total,formatter:p},null,8,["value"])]),g("p",Le,T(E.timeRange),1),g("p",We,[l(q,{type:E.change>0?"danger":"success",size:"small"},{default:h(()=>[R(T(E.compareText)+T(E.change>0?"+":"")+T(E.change)+"% ",1)]),_:2},1032,["type"])])]),g("div",{class:"mini-chart",ref_for:!0,ref_key:"chartRefs",ref:i},null,512)],64))])]),_:2},1024)]),_:2},1024))),128))]),_:1})])}}},Fe=M(Ae,[["__scopeId","data-v-22c73de2"]]),Ne={class:"chart-selector"},Ie={key:0,class:"button-group"},Be={key:1,class:"button-group"},ze={__name:"ChartSelect",props:{viewType:{type:Array,default:["periods","chartTypes"]},modelValue:{type:Object,required:!0,default:()=>({chartType:"bar",period:"daily"})},chartId:{type:String,default:"default"}},emits:["update:modelValue"],setup(y,{emit:e}){const i=y,c=e,o=[{value:"line",icon:"fa fa-line-chart",label:"折线图"},{value:"bar",icon:"fa fa-bar-chart",label:"柱状图"}],d=[{value:"daily",label:"日"},{value:"weekly",label:"周"},{value:"monthly",label:"月"},{value:"yearly",label:"年"}],p=a=>{c("update:modelValue",{...i.modelValue,chartType:a})},t=a=>{c("update:modelValue",{...i.modelValue,period:a})};return(a,s)=>{const r=Z;return _(),b("div",Ne,[y.viewType.includes("chartTypes")?(_(),b("div",Ie,[(_(),b($,null,B(o,m=>l(r,{key:m.value,class:N({"is-active":y.modelValue.chartType===m.value}),onClick:u=>p(m.value),round:""},{icon:h(()=>[g("i",{class:N(m.icon)},null,2)]),_:2},1032,["class","onClick"])),64))])):z("",!0),y.viewType.includes("periods")?(_(),b("div",Be,[(_(),b($,null,B(d,m=>l(r,{key:m.value,class:N({"is-active":y.modelValue.period===m.value}),onClick:u=>t(m.value),round:""},{default:h(()=>[R(T(m.label),1)]),_:2},1032,["class","onClick"])),64))])):z("",!0)])}}},Ue=M(ze,[["__scopeId","data-v-9771518b"]]),Oe={class:"chart-wrapper"},Ye={__name:"WeeklyChart",props:{chartType:{type:String,default:"bar"}},setup(y){const{t:e}=F(),i=L(),c=y,o=t=>{const a=[e("date.week[0]"),e("date.week[1]"),e("date.week[2]"),e("date.week[3]"),e("date.week[4]"),e("date.week[5]"),e("date.week[6]")],s=new Date(t);return a[s.getDay()]},d=t=>{var a;return(a=t==null?void 0:t.data)!=null&&a.length?t.data.map(s=>({time:o(s.start_time),value:Number(s.Value||0).toFixed(2)})):[]},p=V(()=>{const t=i.fourWeekData[0],a=i.fourWeekData[1],s=i.fourWeekData[2],r=i.fourWeekData[3],m=d(t),u=d(a),w=d(s),D=d(r);return!m.length&&!u.length&&!w.length&&!D.length?null:{title:e("date.title.weekly"),xAxisData:m.map(f=>f.time),series:[{name:e("date.label.threeWeeksAgo"),data:D.map(f=>f.value),type:c.chartType,showExtremum:!0},{name:e("date.label.twoWeeksAgo"),data:w.map(f=>f.value),type:c.chartType,showExtremum:!0},{name:e("date.label.lastWeek"),data:u.map(f=>f.value),type:c.chartType,showExtremum:!0},{name:e("date.label.thisWeek"),data:m.map(f=>f.value),type:c.chartType,showExtremum:!0}],showMarkLine:!0,showZoom:!1}});return(t,a)=>(_(),b("div",Oe,[l(P,{height:"100%",options:p.value},null,8,["options"])]))}},Pe={class:"chart-wrapper",style:{height:"100%",width:"100%"}},je={__name:"MonthlyChart",props:{chartType:{type:String,default:"bar"}},setup(y){const{t:e}=F(),i=L(),c=y,o=p=>{var t;return(t=p==null?void 0:p.data)!=null&&t.length?p.data.map(a=>({time:ve(a.start_time).format("DD"),value:Number(a.Value||0).toFixed(2)})):[]},d=V(()=>{const p=i.getReportDataList("monthly"),t=i.getReportDataList("monthly",!0),a=o(p),s=o(t);return!a.length&&!s.length?null:{title:e("date.title.monthly"),xAxisData:a.map(r=>r.time),series:[{name:e("date.label.lastMonth"),data:s.map(r=>r.value),type:c.chartType,showExtremum:!0},{name:e("date.label.thisMonth"),data:a.map(r=>r.value),type:c.chartType,showExtremum:!0}],customColors:["#DEEEFF","#409EFF"],showMarkLine:!0,showZoom:!1}});return(p,t)=>(_(),b("div",Pe,[l(P,{height:"100%",options:d.value},null,8,["options"])]))}},Ze=M(je,[["__scopeId","data-v-cc5aceeb"]]),Ge={class:"chart-wrapper"},qe={__name:"YearlyChart",props:{chartType:{type:String,default:"bar"}},setup(y){const{t:e}=F(),i=L(),c=y,o=p=>{var t;return(t=p==null?void 0:p.data)!=null&&t.length?p.data.map(a=>({time:W(a.start_time,"MM"),value:Number(a.Value||0).toFixed(2)})):[]},d=V(()=>{const p=i.getReportDataList("yearly"),t=i.getReportDataList("yearly",!0),a=o(p),s=o(t);return!a.length&&!s.length?null:{title:e("date.title.yearly"),xAxisData:a.map(r=>r.time),series:[{name:e("date.label.lastYear"),data:s.map(r=>r.value),type:c.chartType,showExtremum:!0},{name:e("date.label.thisYear"),data:a.map(r=>r.value),type:c.chartType,showExtremum:!0}],customColors:["#d7ebff","#409EFF"],showMarkLine:!0,showZoom:!1}});return(p,t)=>(_(),b("div",Ge,[l(P,{height:"100%",options:d.value},null,8,["options"])]))}},Je=M(qe,[["__scopeId","data-v-25200275"]]),Ke={class:"chart-scroll-container"},He={class:"chart-container"},Qe={class:"chart-header"},Xe={__name:"EnergyChart",setup(y){const e=x({chartType:"bar",period:"daily"}),i=V(()=>({daily:ue,weekly:Ye,monthly:Ze,yearly:Je})[e.value.period]);return(c,o)=>(_(),b("div",Ke,[g("div",He,[g("div",Qe,[l(Ue,{"chart-id":"water",modelValue:e.value,"onUpdate:modelValue":o[0]||(o[0]=d=>e.value=d)},null,8,["modelValue"])]),(_(),O(te(i.value),{chartType:e.value.chartType,class:"charts"},null,8,["chartType"]))])]))}},et=M(Xe,[["__scopeId","data-v-d1583c4b"]]),tt={class:"meter-selector"},at={class:"meter-selector__content"},ot={class:"select-all-option"},rt={class:"dialog-footer"},st={__name:"MeterSelector",props:{type:{type:Number,default:1}},setup(y){const e=Y(),i=x(!1),c=x(!1),o=x(e.currentMeter?"specific":"all"),d=y,p=s=>{s==="all"&&e.setCurrentMeter(null)},t=()=>{o.value==="all"&&e.setCurrentMeter(null),c.value=!1},a=async()=>{try{i.value=!0,await e.fetchMeterList({type:d.type})}catch(s){console.error("Error fetching meters:",s)}finally{i.value=!1}};return A(()=>e.currentMeter,s=>{o.value=s?"specific":"all"}),U(()=>{e.setCurrentMeter(null),a()}),ae(()=>{e.setCurrentMeter(null)}),(s,r)=>{const m=Ce,u=Z,w=we,D=De,f=be,n=ge;return _(),b("div",tt,[l(u,{type:"primary",onClick:r[0]||(r[0]=v=>c.value=!0)},{icon:h(()=>[l(m,null,{default:h(()=>[l(S(oe))]),_:1})]),default:h(()=>[R(" "+T(S(e).currentMeter?S(e).currentMeter.meter_code:"全部"),1)]),_:1}),l(n,{modelValue:c.value,"onUpdate:modelValue":r[2]||(r[2]=v=>c.value=v),title:"当前表计:"+(S(e).currentMeter?S(e).currentMeter.meter_code:"全部"),width:"600px"},{footer:h(()=>[g("span",rt,[l(u,{type:"primary",onClick:t},{default:h(()=>r[5]||(r[5]=[R(" 确认 ")])),_:1})])]),default:h(()=>[g("div",at,[g("div",ot,[l(D,{modelValue:o.value,"onUpdate:modelValue":r[1]||(r[1]=v=>o.value=v),onChange:p},{default:h(()=>[l(w,{label:"all"},{default:h(()=>r[3]||(r[3]=[R("全部")])),_:1}),l(w,{label:"specific"},{default:h(()=>r[4]||(r[4]=[R("选择具体表计")])),_:1})]),_:1},8,["modelValue"])]),l(f,{height:"400px"},{default:h(()=>[l(ke,{data:S(e).treeDataForChart,disabled:o.value==="all"},null,8,["data","disabled"])]),_:1})])]),_:1},8,["modelValue","title"])])}}},lt=M(st,[["__scopeId","data-v-cfa4cd6c"]]),nt={class:"dashboard"},it={class:"dashboard-header page-title"},I=1,ct={__name:"index",setup(y){const e=Y(),i=L(),c=re(),{currentMeter:o,currentSelectedType:d}=j(e),{currentCompany:p}=j(c),t=x(!1),a=x(!1),s=u=>{console.error(u),Ee({title:"数据加载失败",message:(u==null?void 0:u.message)||"数据加载失败",type:"error"})},r=async()=>{if(!t.value)try{t.value=!0,await i.fetchAllReportsData()}catch(u){s(u)}finally{t.value=!1}},m=async()=>{if(!t.value)try{t.value=!0,e.setCurrentMeter(null),e.setCurrentSelectedType(I),await e.fetchMeterList(),await i.fetchAllReportsData()}catch(u){s(u)}finally{t.value=!1}};return A([o,d],async([u,w],[D,f])=>{if(!a.value){u&&w&&(a.value=!0,await r());return}(u!==D||w!==f)&&await r()},{deep:!0}),A(p,async(u,w)=>{if(!(!u||u===w))try{t.value=!0,e.setCurrentSelectedType(I),e.setCurrentMeter(null),await i.fetchAllReportsData()}catch(D){s(D)}finally{t.value=!1}}),U(()=>{m()}),(u,w)=>(_(),b("div",nt,[g("div",it,[l(lt,{type:I})]),l(Fe,{loading:t.value},null,8,["loading"]),t.value?z("",!0):(_(),O(et,{key:0,style:{"margin-top":"16px"}}))]))}},fa=M(ct,[["__scopeId","data-v-367db310"]]);export{fa as default};
