import{ct as $,r as F,aV as P,cu as G,cv as J,aZ as K,u as Q,l as W,F as X,w as h,X as Y,I as o,c as v,J as w,j as r,i as a,h as C,d as H,T as Z,f as E,g as ee,v as oe}from"./index-oALI6hjD.js";import{E as te,a as le}from"./form-item-JkdAUXjO.js";import{E as ae}from"./button-CW4VZptJ.js";import{E as ne}from"./autocomplete-N5BG9fbW.js";import{E as ue}from"./input-_j8YarB1.js";import"./scrollbar-BwLVa3O8.js";import"./popper-8tqvLSZz.js";/* empty css            */import{E as re,a as se}from"./select-B0JZ5Vmm.js";import{E as k}from"./index-CV7ElbEQ.js";import{E as z}from"./index-DKbZ_y2J.js";const ie="Ai0WGVDpQy6Nku83k3BuP2B9rY51aNVt";function de(){return{queryLocationSuggestions:async(y,i)=>{if(!y){i([]);return}try{const u=`/map/place/v2/suggestion?query=${encodeURIComponent(y)}&output=json&ak=${ie}&region=无&city_limit=false`,c=(await $.get(u)).data.result.map(d=>d.location&&d.address?{value:d.name,address:d.address,location:d.location}:null).filter(Boolean);i(c)}catch(u){console.error("Location search error:",u),i([])}}}}function me(V={}){const{defaultValues:y={},onSuccess:i,onError:u,onDelete:g}=V,c=F(!1),d=F(null),e=F({id:null,name:"",status:1,phone:"",company_code:"",sector:"",product_name:"",comment:"",location:"",latitude:"",longitude:"",zoom:17,...y});return{form:e,rules:{name:[{required:!0,message:"请输入公司名称",trigger:"blur"}],status:[{required:!0,message:"请选择公司状态",trigger:"change"}],company_code:[{required:!0,message:"请输入公司代码",trigger:"blur"}],phone:[{required:!0,message:"请输入联系电话",trigger:"blur"},{pattern:/^1[3-9]\d{9}$/,message:"请输入正确的手机号",trigger:"blur"}],location:[{required:!0,message:"请输入地址",trigger:"blur"}],latitude:[{required:!0,message:"纬度不能为空",trigger:"blur"}],longitude:[{required:!0,message:"经度不能为空",trigger:"blur"}]},loading:c,companyForm:d,fetchCompanyDetails:async s=>{if(s){c.value=!0;try{const p=await P({id:s});if(p.code===200)Object.assign(e.value,p.data.companies[0]);else throw new Error(p.message||"加载公司详情失败")}catch(p){throw u==null||u(p),p}finally{c.value=!1}}},submitForm:async()=>{if(d.value)try{if(!await d.value.validate())throw new Error("请完善公司信息");c.value=!0,await(e.value.id?G:J)(e.value),i()}catch(s){throw u==null||u(s),s}finally{c.value=!1}},deleteCompany:async()=>{if(e.value.id)try{c.value=!0;const s=await K({id:e.value.id});if(s.code===200)g==null||g();else throw new Error(s.message||"删除失败")}catch(s){throw u==null||u(s),s}finally{c.value=!1}},resetForm:()=>{d.value&&d.value.resetFields(),Object.assign(e.value,y)}}}const Ce={__name:"CompanyDialog",props:{id:{type:[String,Number],default:null},latitude:{type:Number,default:null},longitude:{type:Number,default:null},zoom:{type:Number,default:17}},emits:["update:latitude","update:longitude","update:zoom","location-change","fetch-company-list"],setup(V,{emit:y}){const i=V,u=y,g=Q(),c=W(),{queryLocationSuggestions:d}=de(),{form:e,rules:B,loading:b,companyForm:q,fetchCompanyDetails:S,submitForm:U,deleteCompany:s,resetForm:p}=me({defaultValues:{latitude:i.latitude,longitude:i.longitude,zoom:i.zoom},onSuccess:()=>{k.success("操作成功"),u("fetch-company-list");let t=g.currentRoute.value.query;t.from&&g.push({name:t.from})},onError:t=>{console.error(t),k.error(t.message||"操作失败")},onDelete:()=>{k.success("删除成功"),g.push({name:"CompanyManagement"}),u("fetch-company-list")}}),A=X(()=>c.name!=="MapSelector"),D=t=>{e.value.location=t.address,e.value.latitude=t.location.lat,e.value.longitude=t.location.lng,u("update:latitude",t.location.lat),u("update:longitude",t.location.lng),u("location-change",t.location.lat,t.location.lng)},N=async()=>{try{await U()}catch{}},M=async()=>{try{await z.confirm("确定要删除该公司吗？","提示",{type:"warning",confirmButtonText:"确定",cancelButtonText:"取消"}),await s()}catch(t){t!=="cancel"&&k.error(t.message||"删除失败")}},T=()=>{z.confirm("确定要重置表单吗？","提示",{type:"warning",confirmButtonText:"确定",cancelButtonText:"取消"}).then(()=>{p()}).catch(()=>{})},L=()=>{g.push({name:"MapSelector",query:{id:e.value.id}})};return h(()=>i.id,t=>{t?S(t):p()},{immediate:!0}),h(()=>i.latitude,t=>{t!==e.value.latitude&&(e.value.latitude=t)}),h(()=>i.longitude,t=>{t!==e.value.longitude&&(e.value.longitude=t)}),h(()=>i.zoom,t=>{t!==e.value.zoom&&(e.value.zoom=t)}),(t,l)=>{const f=ue,m=te,x=re,R=se,j=ne,_=ae,I=le,O=oe;return Y((v(),w(I,{ref_key:"companyForm",ref:q,model:o(e),rules:o(B),"label-width":"120px"},{default:r(()=>[a(m,{label:"公司名称",prop:"name"},{default:r(()=>[a(f,{modelValue:o(e).name,"onUpdate:modelValue":l[0]||(l[0]=n=>o(e).name=n),placeholder:"请输入公司名称"},null,8,["modelValue"])]),_:1}),o(e).id?(v(),w(m,{key:0,label:"公司状态",prop:"status"},{default:r(()=>[a(R,{modelValue:o(e).status,"onUpdate:modelValue":l[1]||(l[1]=n=>o(e).status=n),placeholder:"请选择状态"},{default:r(()=>[a(x,{label:"可用",value:1}),a(x,{label:"不可用",value:2})]),_:1},8,["modelValue"])]),_:1})):C("",!0),a(m,{label:"联系电话",prop:"phone"},{default:r(()=>[a(f,{modelValue:o(e).phone,"onUpdate:modelValue":l[2]||(l[2]=n=>o(e).phone=n),placeholder:"请输入联系电话"},null,8,["modelValue"])]),_:1}),a(m,{label:"行业代码",prop:"company_code"},{default:r(()=>[a(f,{modelValue:o(e).company_code,"onUpdate:modelValue":l[3]||(l[3]=n=>o(e).company_code=n),placeholder:"请输入行业代码"},null,8,["modelValue"])]),_:1}),a(m,{label:"行业名称",prop:"sector"},{default:r(()=>[a(f,{modelValue:o(e).sector,"onUpdate:modelValue":l[4]||(l[4]=n=>o(e).sector=n),placeholder:"请输入行业名称"},null,8,["modelValue"])]),_:1}),a(m,{label:"产品名称",prop:"product_name"},{default:r(()=>[a(f,{modelValue:o(e).product_name,"onUpdate:modelValue":l[5]||(l[5]=n=>o(e).product_name=n),placeholder:"请输入产品名称"},null,8,["modelValue"])]),_:1}),a(m,{label:"地址",prop:"location"},{default:r(()=>[a(j,{modelValue:o(e).location,"onUpdate:modelValue":l[6]||(l[6]=n=>o(e).location=n),"fetch-suggestions":o(d),placeholder:"请输入地址",onSelect:D,"trigger-on-focus":!1,clearable:""},null,8,["modelValue","fetch-suggestions"])]),_:1}),o(e).location?(v(),H(Z,{key:1},[a(m,{label:"纬度",prop:"latitude"},{default:r(()=>[a(f,{modelValue:o(e).latitude,"onUpdate:modelValue":l[7]||(l[7]=n=>o(e).latitude=n),placeholder:"自动获取纬度",disabled:""},null,8,["modelValue"])]),_:1}),a(m,{label:"经度",prop:"longitude"},{default:r(()=>[a(f,{modelValue:o(e).longitude,"onUpdate:modelValue":l[8]||(l[8]=n=>o(e).longitude=n),placeholder:"自动获取经度",disabled:""},null,8,["modelValue"])]),_:1}),a(m,{label:"缩放比例",prop:"zoom"},{default:r(()=>[a(f,{modelValue:o(e).zoom,"onUpdate:modelValue":l[9]||(l[9]=n=>o(e).zoom=n),placeholder:"自动获取缩放比例",disabled:""},null,8,["modelValue"])]),_:1})],64)):C("",!0),a(m,{label:"备注",prop:"comment"},{default:r(()=>[a(f,{resize:"none",modelValue:o(e).comment,"onUpdate:modelValue":l[10]||(l[10]=n=>o(e).comment=n),placeholder:"请输入备注",type:"textarea",rows:2},null,8,["modelValue"])]),_:1}),a(m,null,{default:r(()=>[a(_,{type:"primary",onClick:N,loading:o(b)},{default:r(()=>[E(ee(o(e).id?"修改":"新增"),1)]),_:1},8,["loading"]),a(_,{onClick:T},{default:r(()=>l[11]||(l[11]=[E("重置")])),_:1}),o(e).id?(v(),w(_,{key:0,type:"danger",onClick:M,loading:o(b)},{default:r(()=>l[12]||(l[12]=[E(" 删除 ")])),_:1},8,["loading"])):C("",!0),A.value?(v(),w(_,{key:1,type:"success",onClick:L},{default:r(()=>l[13]||(l[13]=[E(" 在地图上显示 ")])),_:1})):C("",!0)]),_:1})]),_:1},8,["model","rules"])),[[O,o(b)]])}}};export{Ce as _};
