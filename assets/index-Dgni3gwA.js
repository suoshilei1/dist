const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/UserPermission-DQxhl28B.js","assets/index-DU5BV6sj.js","assets/index-CKGHOdoA.css","assets/button-C3fNXQ0E.js","assets/index-BCql8Cu-.js","assets/plugin-vue_export-helper-CqGSI99y.js","assets/index-HfsxB2KS.js","assets/use-form-item-Bwue1zaK.js","assets/icon-Lrcg122U.js","assets/button-CzpQr9Wb.css","assets/tree-D0vh79S7.js","assets/select-CVxfSd-L.js","assets/popper-DmsXjoSL.js","assets/index-imETKNmt.js","assets/aria-BUADUvnR.js","assets/focus-trap-BFH-jL9N.js","assets/popper-CLIXM2zs.css","assets/scrollbar-5YYltO8z.js","assets/scrollbar-C4q0Zfda.css","assets/index-DemxtX7w.js","assets/castArray-C1OtMDCV.js","assets/index-DsemQHVw.js","assets/scroll-b_nwKRMA.js","assets/isEqual-Df5tNRy_.js","assets/_Uint8Array-ntTh0Oyk.js","assets/_baseIteratee-B5KIseQu.js","assets/index-BRz9a87F.js","assets/select-BgyzP3al.css","assets/checkbox-B_XNudq6.js","assets/checkbox-DD4l_ypT.css","assets/tree-Dov2ACS9.css","assets/handleError-Dl3av5vd.js","assets/index-BmwD9m8C.js","assets/index-BjNTkPPk.js","assets/base-CMRK1q-d.css","assets/el-notification-BWnt3bt7.css","assets/index-B1KCpUhn.js","assets/input-Cag95VNY.js","assets/input-CvX03x0l.css","assets/index-DspxDzgo.js","assets/vnode-CCieS0_D.js","assets/validator-BURDFhOy.js","assets/UserPermission-gZks6ncs.css","assets/el-overlay-adAJ4NaI.css","assets/el-badge-BWN_0xb6.css"])))=>i.map(i=>d[i]);
import{_ as O,r as u,a as X,V as D,ab as Z,X as se,c as w,J as T,l as i,k as o,d as q,T as ne,U as be,h as F,f as y,v as ie,w as G,o as H,e as A,g as R,m as I,i as Q,a7 as W,a8 as ye}from"./index-DU5BV6sj.js";import{U as Y,C as $,P as ee,E as he}from"./constants-DzFylwgb.js";import"./overlay-CaKmC84a.js";import{E as we}from"./card-CrntnV6K.js";import{E as Pe}from"./dialog-BqmwFatm.js";import{E as Ce}from"./pagination-DUgTE-0K.js";/* empty css            */import{E as Ue,a as Ee}from"./select-CVxfSd-L.js";import"./scrollbar-5YYltO8z.js";import"./popper-DmsXjoSL.js";import{E as Ve,a as Se}from"./table-column-9ftaDh-i.js";import"./checkbox-B_XNudq6.js";/* empty css                */import{E as ke}from"./empty-FpkiWcnp.js";import{E as me}from"./button-C3fNXQ0E.js";import{E as xe}from"./autocomplete-BgU4xmLg.js";import{E as Ae}from"./input-Cag95VNY.js";import{f as De}from"./date-CToM-Ban.js";import{E as Re,a as Te}from"./form-item-Da9sIxn1.js";import{g as V,a as re,u as oe,d as te}from"./user-BYAcp0CO.js";import{s as ae}from"./sha256-CZX8Myq4.js";/* empty css             *//* empty css                 */import{E as b}from"./index-BmwD9m8C.js";import{d as le}from"./DebounceAndThrottle-B_grFKK4.js";/* empty css                   */import{E as Me}from"./index-B1KCpUhn.js";import"./index-DspxDzgo.js";import"./scroll-b_nwKRMA.js";import"./vnode-CCieS0_D.js";import"./index-BCql8Cu-.js";import"./plugin-vue_export-helper-CqGSI99y.js";import"./index-HfsxB2KS.js";import"./focus-trap-BFH-jL9N.js";import"./aria-BUADUvnR.js";import"./icon-Lrcg122U.js";import"./index-imETKNmt.js";import"./use-form-item-Bwue1zaK.js";import"./refs-BkwxSs2a.js";import"./index-DsemQHVw.js";import"./isEqual-Df5tNRy_.js";import"./_Uint8Array-ntTh0Oyk.js";import"./index-DemxtX7w.js";import"./castArray-C1OtMDCV.js";import"./_baseIteratee-B5KIseQu.js";import"./index-BRz9a87F.js";import"./_initCloneObject-CWYxvHbU.js";import"./dayjs.min-BzhD8rH5.js";import"./validator-BURDFhOy.js";const Le={__name:"UserDialog",props:["id"],emits:["fetchUser"],setup(P,{expose:r,emit:h}){r();let e=u(!1);const g=[{label:"用户权限",value:""+Y},{label:"公司管理员",value:""+$},{label:"平台管理员",value:""+ee}],t=X({id:null,phone:"",email:"",username:"",permission:"",company_id:D().currentCompany.id,real_name:"",password:""}),c={phone:[{required:!0,message:"请输入手机号",trigger:"blur"},{pattern:/^1[3-9]\d{9}$/,message:"请输入有效的手机号",trigger:"blur"}],email:[{required:!0,message:"请输入邮箱",trigger:"blur"},{type:"email",message:"请输入有效的邮箱地址",trigger:["blur","change"]}],username:[{required:!0,message:"请输入账号",trigger:"blur"},{min:3,max:20,message:"账号长度在 3 到 20 个字符",trigger:"blur"},{pattern:/^[a-zA-Z0-9]+$/,message:"账号只能包含字母和数字",trigger:"blur"}],permission:[{required:!0,message:"请选择权限",trigger:"change"}],real_name:[{required:!0,message:"请输入真实姓名",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:6,message:"密码长度不能少于6位",trigger:"blur"}]},l=u(null),p=u(!1),m=h,f=P,d=()=>{t.id=null,t.permission="",t.company_id=D().currentCompany.id,t.real_name="",t.password="",t.phone="",t.email="",t.username=""};Z(async()=>{if(f.id){p.value=!0,t.id=f.id;try{e.value=!0;const a=await V({id:f.id});Object.assign(t,a.results[0])}catch(a){console.log(a),b.error("获取用户信息失败")}finally{e.value=!1}}else p.value=!1,d()});const n={get loading(){return e},set loading(a){e=a},permissionOptions:g,form:t,rules:c,userForm:l,isEditMode:p,emit:m,props:f,onReset:d,onSubmit:async()=>{l.value.validate(async a=>{if(a){e.value=!0,t.password&&(t.password=await ae(t.password)),console.log(t);try{t.id?(await oe(t),b.success("更新成功！")):(await re(t),b.success("添加成功！"))}catch(S){b.error(S.message||"提交失败！")}finally{e.value=!1,m("fetchUser"),l.value.resetFields()}}else return b.error("请检查表单填写是否正确"),e.value=!1,!1})},get UserPermissions(){return Y},get CompanyAdminPermissions(){return $},get PlatformAdminPermissions(){return ee},reactive:X,ref:u,watchEffect:Z,get createUserApi(){return re},get getUserListApi(){return V},get updateUserApi(){return oe},get sha256(){return ae},get useCompanyStore(){return D}};return Object.defineProperty(n,"__isScriptSetup",{enumerable:!1,value:!0}),n}};function ze(P,r,h,e,g,t){const c=Ae,l=Re,p=Ue,m=Ee,f=me,d=Te,C=ie;return se((w(),T(d,{model:e.form,rules:e.rules,ref:"userForm","label-width":"120px"},{default:i(()=>[o(l,{label:"真实姓名",prop:"real_name"},{default:i(()=>[o(c,{modelValue:e.form.real_name,"onUpdate:modelValue":r[0]||(r[0]=n=>e.form.real_name=n),placeholder:"请输入真实姓名"},null,8,["modelValue"])]),_:1}),o(l,{label:"手机号",prop:"phone"},{default:i(()=>[o(c,{modelValue:e.form.phone,"onUpdate:modelValue":r[1]||(r[1]=n=>e.form.phone=n),placeholder:"请输入手机号"},null,8,["modelValue"])]),_:1}),o(l,{label:"邮箱",prop:"email"},{default:i(()=>[o(c,{modelValue:e.form.email,"onUpdate:modelValue":r[2]||(r[2]=n=>e.form.email=n),placeholder:"请输入邮箱"},null,8,["modelValue"])]),_:1}),o(l,{label:"账号",prop:"username"},{default:i(()=>[o(c,{modelValue:e.form.username,"onUpdate:modelValue":r[3]||(r[3]=n=>e.form.username=n),placeholder:"请输入账号"},null,8,["modelValue"])]),_:1}),o(l,{label:"权限",prop:"permission"},{default:i(()=>[o(m,{modelValue:e.form.permission,"onUpdate:modelValue":r[4]||(r[4]=n=>e.form.permission=n),placeholder:"请选择权限"},{default:i(()=>[(w(),q(ne,null,be(e.permissionOptions,n=>o(p,{key:n.value,label:n.label,value:n.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),e.isEditMode?F("",!0):(w(),T(l,{key:0,label:"密码",prop:"password"},{default:i(()=>[o(c,{type:"password",modelValue:e.form.password,"onUpdate:modelValue":r[5]||(r[5]=n=>e.form.password=n),placeholder:"请输入密码"},null,8,["modelValue"])]),_:1})),o(l,{style:{"margin-top":"1rem"}},{default:i(()=>[o(f,{type:"primary",onClick:e.onSubmit},{default:i(()=>r[6]||(r[6]=[y("提交")])),_:1}),o(f,{onClick:e.onReset},{default:i(()=>r[7]||(r[7]=[y("重置")])),_:1})]),_:1})]),_:1},8,["model"])),[[C,e.loading]])}const Fe=O(Le,[["render",ze],["__file","D:/临时存放/green-carbon-1.0/src/views/SystemManagement/UserManagement/components/UserDialog.vue"]]),Be={__name:"UserTable",props:{company_id:{type:[Number,String],default:null}},emits:["showPermission"],setup(P,{expose:r,emit:h}){const e=P,g=h,t=u(!1),c=u([]),l=u(),p=u(null),m=u(!1),f=u(1),d=u(12),C=u(0),n=u(""),a=u(null),S=s=>{a.value=s,N(s)},ue=s=>{s||g("showPermission",null)},N=s=>{l.value&&l.value.setCurrentRow(s),g("showPermission",s)},k=()=>{l.value&&l.value.setCurrentRow(null)},U=async(s=0,_=d.value)=>{m.value=!1;try{t.value=!0;const v={offset:s,limit:_,real_name:n.value?`%${n.value}%`:"%"};let M=Q().query;M.id?v.company_id=M.id:v.company_id=D().currentCompany.id;const x=await V(v);if(x.code===200){const{results:L,total:z}=x;c.value=L,C.value=z,a.value&&(L.some(E=>E.id===a.value.id)||(k(),g("showPermission",null)))}else console.error(x.message),b.error(x.message)}catch(v){console.error(v),b.error("获取用户信息失败")}finally{t.value=!1}},de=()=>{n.value="",f.value=1,k(),g("showPermission",null),U(0,d.value)},ce=s=>{m.value=!0,p.value=s.id},pe=s=>{Me.confirm(`确认删除用户 ${s.real_name} 吗？`,"警告",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then(async()=>{await j(s.username),U((f.value-1)*d.value,d.value)}).catch(()=>{})};async function j(s){try{let _=await te({username:s});_.code===200?b.success("删除成功"):(console.error(_.message),b.error(_.message||"删除失败请稍后重试"))}catch(_){console.error(_),b.error(_.message||"删除失败请稍后重试")}}const fe=s=>{n.value=s.real_name,f.value=1,k(),U(0,d.value)},ge=le(async(s,_)=>{if(!s){_([]);return}try{const v={offset:0,limit:5};e.company_id&&(v.company_id=e.company_id);const[M,x,L]=await Promise.all([V({...v,real_name:"%"+s+"%"}),V({...v,email:"%"+s+"%"}),V({...v,phone:"%"+s+"%"})]),z=[];[M,x,L].forEach(E=>{E.code===200&&z.push(...E.results)});const J=Array.from(new Map(z.map(E=>[E.id,E])).values());_(J)}catch(v){console.error(v),b.error("获取用户信息失败"),_([])}},500),_e=()=>{p.value=null,m.value=!0},ve=s=>{f.value=s,k(),U((f.value-1)*d.value,d.value)};let B=D();G(()=>B.currentCompany,()=>{U(0,d.value)}),H(()=>{U(0,d.value)}),r({clearCurrentRow:k});const K={props:e,emits:g,loading:t,filteredPersonList:c,tableRef:l,currentUser:p,dialogVisible:m,currentPage:f,pageSize:d,totalItems:C,searchKeyword:n,currentRow:a,handleRowClick:S,handleCurrentChange:ue,handleShowPermission:N,clearCurrentRow:k,getPersonList:U,resetFields:de,editPerson:ce,deletePerson:pe,fetchDeletePerson:j,handleSelect:fe,fetchSuggestions:ge,addPerson:_e,handlePageChange:ve,get companyStore(){return B},set companyStore(s){B=s},ref:u,onMounted:H,watch:G,get formatDate(){return De},UserDialog:Fe,get deleteUserApi(){return te},get getUserListApi(){return V},get debounce(){return le},get useCompanyStore(){return D},get useRoute(){return Q}};return Object.defineProperty(K,"__isScriptSetup",{enumerable:!1,value:!0}),K}},Ie={class:"container"},Oe={class:"search-bar"},qe={class:"custom-suggestion-item"};function Ne(P,r,h,e,g,t){const c=xe,l=me,p=ke,m=Ve,f=Se,d=Ce,C=Pe,n=ie;return w(),q(ne,null,[A("div",Ie,[A("div",Oe,[o(c,{"trigger-on-focus":!1,style:{width:"200px"},clearable:"","hide-loading":!0,class:"search-input",modelValue:e.searchKeyword,"onUpdate:modelValue":r[0]||(r[0]=a=>e.searchKeyword=a),"fetch-suggestions":e.fetchSuggestions,placeholder:"搜索姓名、邮箱或电话",onSelect:e.handleSelect},{default:i(({item:a})=>[A("div",qe,[A("span",null,R(a.real_name)+" - ",1),A("span",null,R(a.email)+" - ",1),A("span",null,R(a.phone),1)])]),_:1},8,["modelValue","fetch-suggestions"]),o(l,{type:"primary",onClick:e.resetFields,class:"reset-button"},{default:i(()=>r[2]||(r[2]=[y("重置")])),_:1}),o(l,{type:"primary",onClick:e.addPerson,class:"add-button"},{default:i(()=>r[3]||(r[3]=[y("新增人员")])),_:1})]),!e.filteredPersonList.length&&!e.loading?(w(),T(p,{key:0,description:"暂无数据",style:{width:"100%",height:"80%"}})):F("",!0),e.filteredPersonList.length?se((w(),T(f,{key:1,ref:"tableRef",data:e.filteredPersonList,class:"person-table",style:{width:"100%"},onRowClick:e.handleRowClick,"highlight-current-row":!0,onCurrentChange:e.handleCurrentChange},{default:i(()=>[o(m,{label:"编号",width:"80",prop:"id",sortable:"",align:"center"}),o(m,{prop:"real_name",label:"姓名",align:"center"}),o(m,{prop:"phone",align:"center",label:"电话"}),o(m,{prop:"email",align:"center","show-overflow-tooltip":"",label:"邮箱"}),o(m,{sortable:"",prop:"created_at",label:"创建时间"},{default:i(a=>[y(R(e.formatDate(a.row.created_at)),1)]),_:1}),o(m,{sortable:"",prop:"updated_at",label:"修改时间"},{default:i(a=>[y(R(e.formatDate(a.row.updated_at)),1)]),_:1}),o(m,{fixed:"right",align:"center",label:"操作",width:"250"},{default:i(a=>[o(l,{onClick:I(S=>e.handleShowPermission(a.row),["stop"]),type:"success",size:"small"},{default:i(()=>r[4]||(r[4]=[y("查看权限")])),_:2},1032,["onClick"]),o(l,{type:"primary",icon:"Edit",onClick:I(S=>e.editPerson(a.row),["stop"]),size:"small"},{default:i(()=>r[5]||(r[5]=[y("编辑")])),_:2},1032,["onClick"]),o(l,{type:"danger",icon:"Delete",onClick:I(S=>e.deletePerson(a.row),["stop"]),size:"small"},{default:i(()=>r[6]||(r[6]=[y("删除")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[n,e.loading]]):F("",!0),e.totalItems>0?(w(),T(d,{key:2,onCurrentChange:e.handlePageChange,"current-page":e.currentPage,"page-size":e.pageSize,"hide-on-single-page":!0,background:"","pager-count":5,layout:"prev, pager, next",total:e.totalItems,class:"pagination"},null,8,["current-page","page-size","total"])):F("",!0)]),o(C,{"destroy-on-close":"",title:e.currentUser?"编辑人员":"新增人员",modelValue:e.dialogVisible,"onUpdate:modelValue":r[1]||(r[1]=a=>e.dialogVisible=a)},{default:i(()=>[o(e.UserDialog,{onFetchUser:e.getPersonList,id:e.currentUser},null,8,["id"])]),_:1},8,["title","modelValue"])],64)}const je=O(Be,[["render",Ne],["__scopeId","data-v-0d7b9e31"],["__file","D:/临时存放/green-carbon-1.0/src/views/SystemManagement/UserManagement/components/UserTable.vue"]]),Ke={__name:"index",setup(P,{expose:r}){r();const h=W(()=>ye(()=>import("./UserPermission-DQxhl28B.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44]))),e=u(null),g=u(!1),t=u(null);function c(m){t.value=m,g.value=!0}function l(){e.value.clearCurrentRow(),g.value=!1}const p={UserPermission:h,userTable:e,showPermissionComponent:g,permissionUserinfo:t,showPermission:c,closePermission:l,ref:u,get getAsyncComponent(){return W},UserTable:je};return Object.defineProperty(p,"__isScriptSetup",{enumerable:!1,value:!0}),p}},Je={class:"layout-wrapper"};function Xe(P,r,h,e,g,t){const c=we,l=he;return w(),q("div",Je,[o(c,{class:"table-wrapper"},{default:i(()=>[o(e.UserTable,{ref:"userTable",onShowPermission:e.showPermission},null,512)]),_:1}),o(l,{modelValue:e.showPermissionComponent,"onUpdate:modelValue":r[0]||(r[0]=p=>e.showPermissionComponent=p),title:"权限管理",size:"30%","show-close":!0,"before-close":e.closePermission,direction:"rtl","destroy-on-close":!0},{default:i(()=>[o(e.UserPermission,{userinfo:e.permissionUserinfo},null,8,["userinfo"])]),_:1},8,["modelValue"])])}const Nr=O(Ke,[["render",Xe],["__scopeId","data-v-b056bc5a"],["__file","D:/临时存放/green-carbon-1.0/src/views/SystemManagement/UserManagement/index.vue"]]);export{Nr as default};
