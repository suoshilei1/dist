import{_ as A,W as K,r as E,w as S,c as m,d as p,e as N,i as a,j as n,I as U,f as g,Y as z,J as D,ai as x,g as h,v as T}from"./index-Bx6Y8L80.js";import{E as M}from"./card-fNeABwz5.js";import{E as W,a as j}from"./table-column-DjUxz4le.js";import"./checkbox-LjaCbo-5.js";/* empty css                */import"./popper-DBn8ulUn.js";import"./scrollbar-DuXO1tWo.js";import{E as J}from"./input-CFaQgGx5.js";import{E as L}from"./input-number-APkjfsE3.js";/* empty css            */import{E as R}from"./button-8bviUT_H.js";import{a as Y,c as q,u as F,d as G}from"./price-BNLDcrLr.js";import{d as H}from"./DebounceAndThrottle-B_grFKK4.js";/* empty css             *//* empty css                 *//* empty css                   */import{E as s}from"./index-KJp6TXG9.js";import{E as O}from"./index-slq3sC_j.js";import"./plugin-vue_export-helper-CqGSI99y.js";import"./index-CuyxIfpa.js";import"./_baseIteratee-CkjM3wkz.js";import"./_Uint8Array-B6mJ0Xm4.js";import"./isEqual-BM-Gj-iT.js";import"./index-A4BGBRGh.js";import"./index-zrRcpBp4.js";import"./_initCloneObject-nnMrnZRY.js";import"./use-form-item-50hJ8Ppj.js";import"./index-AkNVqhGZ.js";import"./aria-BUADUvnR.js";import"./focus-trap-Ddg061Nm.js";import"./icon-6zrsquxY.js";import"./index-iw6eP590.js";import"./index-DLcTS03G.js";import"./index-DZY-cmUL.js";import"./scroll-BawlEUY1.js";import"./vnode-DK7gyQZj.js";import"./validator-ulZFuTQV.js";const Q={class:"water-price-container"},X={key:0},Z={key:1},ee={key:0},te={key:1},ie={__name:"index",setup(ae){const u=K(),r=E([]),o=E(!1),d=E("");async function c(){o.value=!0;try{let e=await Y({type:1,company_id:u.currentCompany.id,name:d.value?`%${d.value}%`:void 0});r.value=e.data}catch{s.error("获取价格失败")}finally{o.value=!1}}const P=H(c,500),V=()=>{const e={name:"",fixed_price:0,tempPrice:0,isNew:!0,company_id:u.currentCompany.id,price_mode:"固定价格",type:1};r.value.unshift(e)},b=e=>{!e.name&&e.isNew&&(r.value=r.value.filter(i=>i!==e))},k=e=>{e.isEditing=!0,e.tempPrice=e.fixed_price},_=async e=>{if(!e.name){s.warning("请输入用水类别");return}if(e.isNew)e.fixed_price=e.tempPrice||0;else if(e.tempPrice==e.fixed_price){s.info("价格未修改"),e.isEditing=!1;return}o.value=!0;let i={...e.isNew?{name:e.name,company_id:e.company_id,price_mode:e.price_mode,type:e.type,fixed_price:e.tempPrice||0}:{id:e.id,fixed_price:e.tempPrice}};try{e.isNew?await q(i):await F(i),await c(),s.success(e.isNew?"添加成功":"修改成功")}catch{s.error(e.isNew?"添加失败":"保存失败")}finally{e.isEditing=!1,e.isNew=!1,o.value=!1}},C=async e=>{if(e.isNew){r.value=r.value.filter(i=>i!==e);return}try{await O.confirm("确定要删除该价格方案吗？","提示",{type:"warning"}),o.value=!0,await G({id:""+e.id}),s.success("删除成功"),await c()}catch(i){i!=="cancel"&&s.error("删除失败")}finally{o.value=!1}};return S(()=>u.currentCompany,async()=>{await c()},{immediate:!0}),(e,i)=>{const f=J,y=R,v=W,w=L,B=j,I=M,$=T;return m(),p("div",Q,[i[3]||(i[3]=N("div",{class:"page-title"},[N("div",null,"水费定价管理")],-1)),a(I,{class:"system-card"},{header:n(()=>[a(f,{clearable:"",modelValue:d.value,"onUpdate:modelValue":i[0]||(i[0]=t=>d.value=t),style:{width:"150px"},placeholder:"搜索用水类别",onInput:U(P)},null,8,["modelValue","onInput"]),a(y,{icon:"plus",size:"small",type:"primary",onClick:V},{default:n(()=>i[1]||(i[1]=[g("添加定价方案")])),_:1})]),default:n(()=>[z((m(),D(B,{data:r.value,border:"",style:{width:"100%"}},{default:n(()=>[a(v,{align:"center",prop:"name",label:"用水类别"},{default:n(({row:t})=>[t.isEditing||t.isNew?(m(),p("div",X,[a(f,{modelValue:t.name,"onUpdate:modelValue":l=>t.name=l,placeholder:"请输入用水类别",onBlur:l=>b(t),onKeyup:x(l=>_(t),["enter"])},null,8,["modelValue","onUpdate:modelValue","onBlur","onKeyup"])])):(m(),p("div",Z,h(t.name),1))]),_:1}),a(v,{align:"center",label:"价格(元/吨)"},{default:n(({row:t})=>[t.isEditing||t.isNew?(m(),p("div",ee,[a(w,{modelValue:t.tempPrice,"onUpdate:modelValue":l=>t.tempPrice=l,precision:2,step:.1,min:0,max:999,style:{width:"100%"},onKeyup:x(l=>_(t),["enter"])},null,8,["modelValue","onUpdate:modelValue","onKeyup"])])):(m(),p("div",te,h(t.fixed_price),1))]),_:1}),a(v,{align:"center",label:"操作"},{default:n(t=>[a(y,{size:"small",type:t.row.isEditing||t.row.isNew?"success":"primary",onClick:l=>t.row.isEditing||t.row.isNew?_(t.row):k(t.row)},{default:n(()=>[g(h(t.row.isEditing||t.row.isNew?"保存":"编辑"),1)]),_:2},1032,["type","onClick"]),a(y,{size:"small",type:"danger",onClick:l=>C(t.row)},{default:n(()=>i[2]||(i[2]=[g(" 删除 ")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[$,o.value]])]),_:1})])}}},je=A(ie,[["__scopeId","data-v-0a550596"]]);export{je as default};
