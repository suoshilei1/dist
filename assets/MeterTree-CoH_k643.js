import{z as Q,ao as X,D as U,ap as Z,E as ee,r as _,F as M,H as te,c as m,J as w,j as s,e as o,N as b,I as n,n as oe,K as ne,h as S,f as x,g as C,M as V,i as a,al as se,O as le,_ as ae,s as re,l as ie,d as $,W as R,Y as ce,v as pe}from"./index-Bx6Y8L80.js";import{E as ue}from"./dialog-Dt2QUqOw.js";import"./overlay-04qnzRyj.js";import{_ as fe}from"./MeterDialog-C3DuWE-y.js";import{E as de}from"./tree-Bp6m8vKT.js";import"./checkbox-LjaCbo-5.js";import{u as A,E as j}from"./popper-DBn8ulUn.js";import{b as z,E as L}from"./button-8bviUT_H.js";/* empty css                */import{u as me,k as ve}from"./meter-5sbrBbgq.js";/* empty css             *//* empty css                 */import{E}from"./index-KJp6TXG9.js";import{E as ye}from"./index-A4BGBRGh.js";import{i as _e}from"./icon-6zrsquxY.js";import{_ as he}from"./plugin-vue_export-helper-CqGSI99y.js";const ge=Q({title:String,confirmButtonText:String,cancelButtonText:String,confirmButtonType:{type:String,values:z,default:"primary"},cancelButtonType:{type:String,values:z,default:"text"},icon:{type:_e,default:()=>X},iconColor:{type:String,default:"#f90"},hideIcon:{type:Boolean,default:!1},hideAfter:{type:Number,default:200},teleported:A.teleported,persistent:A.persistent,width:{type:[String,Number],default:150}}),ke={confirm:p=>p instanceof MouseEvent,cancel:p=>p instanceof MouseEvent},Ce=U({name:"ElPopconfirm"}),Te=U({...Ce,props:ge,emits:ke,setup(p,{emit:P}){const u=p,{t:T}=Z(),i=ee("popconfirm"),v=_(),c=()=>{var e,k;(k=(e=v.value)==null?void 0:e.onClose)==null||k.call(e)},f=M(()=>({width:te(u.width)})),y=e=>{P("confirm",e),c()},h=e=>{P("cancel",e),c()},N=M(()=>u.confirmButtonText||T("el.popconfirm.confirmButtonText")),g=M(()=>u.cancelButtonText||T("el.popconfirm.cancelButtonText"));return(e,k)=>(m(),w(n(j),se({ref_key:"tooltipRef",ref:v,trigger:"click",effect:"light"},e.$attrs,{"popper-class":`${n(i).namespace.value}-popover`,"popper-style":n(f),teleported:e.teleported,"fallback-placements":["bottom","top","right","left"],"hide-after":e.hideAfter,persistent:e.persistent}),{content:s(()=>[o("div",{class:b(n(i).b())},[o("div",{class:b(n(i).e("main"))},[!e.hideIcon&&e.icon?(m(),w(n(ye),{key:0,class:b(n(i).e("icon")),style:oe({color:e.iconColor})},{default:s(()=>[(m(),w(ne(e.icon)))]),_:1},8,["class","style"])):S("v-if",!0),x(" "+C(e.title),1)],2),o("div",{class:b(n(i).e("action"))},[V(e.$slots,"actions",{confirm:y,cancel:h},()=>[a(n(L),{size:"small",type:e.cancelButtonType==="text"?"":e.cancelButtonType,text:e.cancelButtonType==="text",onClick:h},{default:s(()=>[x(C(n(g)),1)]),_:1},8,["type","text"]),a(n(L),{size:"small",type:e.confirmButtonType==="text"?"":e.confirmButtonType,text:e.confirmButtonType==="text",onClick:y},{default:s(()=>[x(C(n(N)),1)]),_:1},8,["type","text"])])],2)],2)]),default:s(()=>[e.$slots.reference?V(e.$slots,"reference",{key:0}):S("v-if",!0)]),_:3},16,["popper-class","popper-style","teleported","hide-after","persistent"]))}});var Be=he(Te,[["__file","popconfirm.vue"]]);const be=le(Be),Ee={class:"tree-wrapper"},Me={class:"tree-container"},we={class:"header"},Se={class:"company-name"},Pe={key:0,class:"header-actions"},Ne={class:"custom-tree-node"},xe={class:"node-label"},$e={key:0,class:"node-actions"},Ie=["onClick"],De={__name:"MeterTree",props:{data:{type:Array,default:()=>[]}},setup(p){const u=re().hasPermission("manage_device"),T=ie(),i=M(()=>T.name==="DeviceInfo"),v=_(!1),c=_(!1),f=_(null),y=_(null),h=_(null),N={id:"id",children:"children",label:"label"};let g=me();function e(l){y.value=l,f.value=null,c.value=!0}function k(){y.value={id:0,label:"根节点",type:0},f.value=null,c.value=!0}function q(l){l&&g.setCurrentMeter(l)}function F(l,t){if(t&&t.id){let r=[t.id];I(r)}}const H=()=>{var r;const t=(((r=h.value)==null?void 0:r.getCheckedNodes(!1,!1))||[]).map(B=>B.id).filter(Boolean);t.length>0&&I(t)};function I(l){!Array.isArray(l)||l.length===0||ve(l).then(t=>{t.code===200?(E.success("删除成功"),g.fetchMeterList()):(console.error(t.message),E.error(t.message||"删除失败"))}).catch(t=>{console.error(t),E.error("删除失败")})}const J=async()=>{v.value=!0;try{await g.fetchMeterList()}catch(l){console.error("刷新失败:",l),E.error("刷新失败")}finally{v.value=!1}};return(l,t)=>{const r=j,B=be,K=de,O=fe,W=ue,Y=pe;return m(),$("div",Ee,[o("div",Me,[o("div",we,[a(r,{content:n(R)().currentCompany.name,placement:"top","show-after":500},{default:s(()=>[o("span",Se,C(n(R)().currentCompany.name),1)]),_:1},8,["content"]),i.value&&n(u)?(m(),$("div",Pe,[o("a",{type:"primary",onClick:k},[a(r,{content:"新增一级表计",placement:"top","show-after":500},{default:s(()=>t[2]||(t[2]=[o("i",{class:"fa fa-plus"},null,-1)])),_:1})]),a(B,{placement:"top",title:"确定删除勾选的表计吗？",onConfirm:H},{reference:s(()=>[o("a",null,[a(r,{content:"删除勾选的表计",placement:"top","show-after":500},{default:s(()=>t[3]||(t[3]=[o("i",{class:"fa fa-minus"},null,-1)])),_:1})])]),_:1}),o("a",{type:"primary",onClick:J},[a(r,{content:"刷新表计列表",placement:"top","show-after":500},{default:s(()=>t[4]||(t[4]=[o("i",{class:"fa fa-refresh"},null,-1)])),_:1})])])):S("",!0)]),ce((m(),w(K,{onNodeClick:q,style:{display:"inline-block",width:"100%"},"element-loading-text":"loading...","show-checkbox":i.value&&n(u),ref_key:"treeRef",ref:h,indent:10,class:"eye-tree",data:p.data,props:N,"node-key":"id","highlight-current":!0,"default-expand-all":!0,"expand-on-click-node":!1},{default:s(({node:d,data:D})=>[o("div",Ne,[a(r,{content:d.label,placement:"top","show-after":500},{default:s(()=>[o("span",xe,C(d.label),1)]),_:2},1032,["content"]),i.value&&n(u)?(m(),$("span",$e,[o("a",{onClick:G=>e(D)},t[5]||(t[5]=[o("i",{class:"fa fa-plus"},null,-1)]),8,Ie),a(B,{placement:"top",title:`确定删除${d.label}表计吗？`,onConfirm:G=>F(d,D)},{reference:s(()=>t[6]||(t[6]=[o("a",null,[o("i",{class:"fa fa-minus"})],-1)])),_:2},1032,["title","onConfirm"])])):S("",!0)])]),_:1},8,["show-checkbox","data"])),[[Y,v.value]]),a(W,{title:f.value?"编辑表计":"新增表计","destroy-on-close":"","align-center":"",modelValue:c.value,"onUpdate:modelValue":t[1]||(t[1]=d=>c.value=d)},{default:s(()=>[a(O,{"onUpdate:visible":t[0]||(t[0]=d=>c.value=!1),pMeter:y.value,id:f.value?+f.value.meter_id:null},null,8,["pMeter","id"])]),_:1},8,["title","modelValue"])])])}}},Qe=ae(De,[["__scopeId","data-v-cf3d2526"]]);export{Qe as M};
