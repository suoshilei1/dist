import{_ as K,V as q,r as g,w as M,c as y,d as h,e as v,X as U,I as i,J as j,j as r,i as o,cw as J,cq as P,f as m,ai as X,g as k,aY as Y,af as G,T as H,ab as O,v as Q}from"./index-oALI6hjD.js";import{E as W}from"./card-DUC90zSS.js";import{E as Z,a as ee}from"./table-column-B3vmHtxt.js";import"./checkbox-eAiA7KBF.js";/* empty css                */import"./popper-8tqvLSZz.js";import"./scrollbar-BwLVa3O8.js";/* empty css            */import{E as te}from"./button-CW4VZptJ.js";import{E as ne}from"./input-_j8YarB1.js";import{u as ae,c as oe,a as re,d as se}from"./energyUser-CLJ2J9ZR.js";import{h as C}from"./handleError-BVJ6YTlw.js";import{d as le}from"./DebounceAndThrottle-B_grFKK4.js";/* empty css             *//* empty css                 *//* empty css                   */import{E}from"./index-CV7ElbEQ.js";import{E as ie}from"./index-DKbZ_y2J.js";import{E as ue}from"./index-DXOgsKzf.js";import{E as de}from"./index-ClN0XSgQ.js";import"./plugin-vue_export-helper-CqGSI99y.js";import"./index-Ci2yyUHC.js";import"./_baseIteratee-_-ChXyeP.js";import"./_Uint8Array-Cyhry7Ym.js";import"./isEqual-DERyOhzh.js";import"./index-CPa7yTdP.js";import"./_initCloneObject-CeA08_Bb.js";import"./use-form-item-CJ5jT23N.js";import"./index-GdZBC0LW.js";import"./aria-BUADUvnR.js";import"./focus-trap-B9jhWFgs.js";import"./icon-DFUaFmZd.js";import"./index-BTnVmvBQ.js";/* empty css                        */import"./index-BFWR71cx.js";import"./index-JdeAZNwx.js";import"./scroll-BUhzRsoy.js";import"./vnode-DAFY4x8G.js";import"./validator-DaZaXEYL.js";const me={class:"energy-users-container"},ce={class:"header-operations"},pe={key:0},fe={key:1},_e={__name:"index",setup(ge){const x={mounted:t=>O(()=>t.querySelector("input").focus())},n=ae(),w=q(),u=g(null),d=g(""),s=g(!1),p=g(null);M(()=>w.currentCompany.id,()=>{n.fetchEnergyUsers()},{immediate:!0});const N=le(()=>{n.fetchEnergyUsers()},300),T=()=>{n.searchTerm="",n.sortConfig={prop:"unknown_ratio",order:"descending"},p.value&&(p.value.clearFilter(),p.value.sort("unknown_ratio","descending")),n.fetchEnergyUsers()},B=({prop:t,order:e})=>{n.sortConfig={prop:t||"unknown_ratio",order:e||"descending"}},S=(t,e)=>t===1?Number(e.unknown_ratio)>0:Number(e.unknown_ratio)===0,V=(t,e)=>n.energyUserList.some(l=>l.name===t&&l.id!==e),I=()=>{if(s.value)return;const t={id:"temp_"+Date.now(),name:"",unknown_ratio:"0"};n.energyUserList.unshift(t),u.value=t.id,d.value="",s.value=!0},z=t=>{u.value=t.id,d.value=t.name,s.value=!1},b=async t=>{const e=d.value.trim();if(!e){s.value&&(n.energyUserList=n.energyUserList.filter(l=>l.id!==t.id)),u.value=null,s.value=!1;return}if(V(e,t.id)){E.error("用能户名称不能重复"),s.value||(u.value=null),d.value=t.name;return}if(!s.value&&e===t.name){u.value=null;return}n.loading=!0;try{s.value?(await oe({company_id:w.currentCompany.id,name:e,unknown_ratio:"0"}),E.success("添加成功")):(await re({id:t.id,name:e}),E.success("保存成功")),await n.fetchEnergyUsers(),u.value=null,s.value=!1}catch(l){C(l,s.value?"添加用能户失败":"保存用能户失败")}finally{n.loading=!1}},D=async t=>{try{await ie.confirm("确认删除该用能户吗？","提示",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}),n.loading=!0;try{await se({id:""+t.id}),await n.fetchEnergyUsers(),E.success("删除成功")}catch(e){C(e,"删除用能户失败")}finally{n.loading=!1}}catch{}};return(t,e)=>{const l=ne,L=ue,f=te,_=Z,A=de,R=ee,$=W,F=Q;return y(),h(H,null,[e[6]||(e[6]=v("div",{class:"page-title"},[v("span",{class:"title"},"用能户管理")],-1)),v("div",me,[U((y(),j($,null,{header:r(()=>[v("div",ce,[o(l,{modelValue:i(n).searchTerm,"onUpdate:modelValue":e[0]||(e[0]=a=>i(n).searchTerm=a),placeholder:"搜索用能户...",class:"search-input","prefix-icon":i(J),size:"small",onInput:i(N)},null,8,["modelValue","prefix-icon","onInput"]),o(f,{type:"primary",size:"small",onClick:I},{default:r(()=>[o(L,null,{default:r(()=>[o(i(P))]),_:1}),e[2]||(e[2]=m("添加用能户 "))]),_:1}),o(f,{type:"info",size:"small",onClick:T},{default:r(()=>e[3]||(e[3]=[m("重置")])),_:1})])]),default:r(()=>[o(R,{data:i(n).filteredEnergyUsers,style:{width:"100%"},ref_key:"tableRef",ref:p},{default:r(()=>[o(_,{align:"center",label:"名称"},{default:r(({row:a})=>[u.value===a.id?(y(),h("div",pe,[U(o(l,{modelValue:d.value,"onUpdate:modelValue":e[1]||(e[1]=c=>d.value=c),size:"small",onBlur:c=>b(a),onKeyup:X(c=>b(a),["enter"])},null,8,["modelValue","onBlur","onKeyup"]),[[x]])])):(y(),h("span",fe,k(a.name),1))]),_:1}),o(_,{align:"center",label:"不明水分摊比例",sortable:"custom",prop:"unknown_ratio","default-sort":{prop:"unknown_ratio",order:"descending"},"sort-orders":["descending","ascending"],onSortChange:B},{default:r(({row:a})=>[m(k(a.unknown_ratio)+"% ",1)]),_:1}),o(_,{align:"center",label:"是否参与不明水分摊",filters:[{text:"参与",value:1},{text:"不参与",value:0}],"filter-method":S},{default:r(({row:a})=>[o(A,{type:Number(a.unknown_ratio)>0?"success":"info"},{default:r(()=>[m(k(Number(a.unknown_ratio)>0?"参与":"不参与"),1)]),_:2},1032,["type"])]),_:1}),o(_,{align:"center",label:"操作"},{default:r(({row:a})=>[o(f,{type:"primary",size:"small",icon:i(Y),onClick:c=>z(a)},{default:r(()=>e[4]||(e[4]=[m("编辑")])),_:2},1032,["icon","onClick"]),o(f,{type:"danger",size:"small",icon:i(G),onClick:c=>D(a)},{default:r(()=>e[5]||(e[5]=[m("删除")])),_:2},1032,["icon","onClick"])]),_:1})]),_:1},8,["data"])]),_:1})),[[F,i(n).loading]])])],64)}}},nt=K(_e,[["__scopeId","data-v-ed511962"]]);export{nt as default};
