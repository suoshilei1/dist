import{v as C,L as F,_ as q,r as b,a as S,o as M,b as D,w as j,t as H,c as I,d as k,e as f,n as W,f as w,g as y,h as G,u as P,i as z,j as L,k as a,l,m as J,p as x,q as R,s as V}from"./index-DU5BV6sj.js";import{E as K}from"./card-CrntnV6K.js";import{E as Q,a as X}from"./form-item-Da9sIxn1.js";import{E as Y}from"./button-C3fNXQ0E.js";import{E as Z}from"./checkbox-B_XNudq6.js";import{E as $}from"./input-Cag95VNY.js";import{s as U}from"./sha256-CZX8Myq4.js";import{h as B}from"./handleError-Dl3av5vd.js";import{_ as ee}from"./logo-rRFpfryy.js";/* empty css             *//* empty css                        */import{E}from"./index-BmwD9m8C.js";import{E as T}from"./index-B1KCpUhn.js";import{E as te}from"./index-BCql8Cu-.js";import{E as oe}from"./index-BjNTkPPk.js";import"./plugin-vue_export-helper-CqGSI99y.js";import"./use-form-item-Bwue1zaK.js";import"./castArray-C1OtMDCV.js";import"./index-imETKNmt.js";import"./_Uint8Array-ntTh0Oyk.js";import"./_initCloneObject-CWYxvHbU.js";import"./index-HfsxB2KS.js";import"./icon-Lrcg122U.js";import"./isEqual-Df5tNRy_.js";import"./index-DsemQHVw.js";import"./aria-BUADUvnR.js";import"./index-DspxDzgo.js";import"./scroll-b_nwKRMA.js";import"./vnode-CCieS0_D.js";import"./focus-trap-BFH-jL9N.js";import"./validator-BURDFhOy.js";const A={install(d){d.directive("loading",C),d.config.globalProperties.$loading=F},directive:C,service:F},N=["#1e3a8a","#1e40af","#3b82f6","#60a5fa","#93c5fd"];class re{constructor(e,t){this.x=Math.random()*e,this.y=Math.random()*t,this.z=Math.random()*1e3,this.size=Math.random()*20+10,this.speed=Math.random()+.2,this.rotation=Math.random()*Math.PI*2,this.rotationSpeed=(Math.random()-.5)*.01,this.color=N[Math.floor(Math.random()*N.length)],this.opacity=Math.random()*.2+.1}update(e,t){this.z-=this.speed,this.rotation+=this.rotationSpeed,this.z<1&&(this.z=1e3,this.x=Math.random()*e,this.y=Math.random()*t)}draw(e,t,o){const n=1e3/(1e3-this.z),c=(this.x-t/2)*n+t/2,i=(this.y-o/2)*n+o/2,r=this.size*n;e.save(),e.translate(c,i),e.rotate(this.rotation),e.globalAlpha=this.opacity,e.fillStyle=this.color,e.beginPath(),e.moveTo(-r/2,-r/4),e.lineTo(r/2,-r/4),e.lineTo(r/3,r/4),e.lineTo(-r/3,r/4),e.closePath(),e.fill(),e.restore()}}const ae={props:{particleCount:{type:Number,default:50},debug:{type:Boolean,default:!1}},setup(d){const e=b(null),t=S({width:window.innerWidth,height:window.innerHeight,particles:[]}),o={position:"fixed",top:0,left:0,width:"100%",height:"100%",zIndex:1};let n=null,c=null;const i=()=>{const m=e.value;m?(n=m.getContext("2d"),m.width=t.width,m.height=t.height):console.error("Canvas element not found")},r=()=>{t.particles=Array.from({length:d.particleCount},()=>new re(t.width,t.height))},u=()=>{if(!n){console.error("Canvas context not available");return}n.clearRect(0,0,t.width,t.height),n.fillStyle="#0f172a",n.fillRect(0,0,t.width,t.height),t.particles.forEach(m=>{m.update(t.width,t.height),m.draw(n,t.width,t.height)}),c=requestAnimationFrame(u)},g=()=>{t.width=window.innerWidth,t.height=window.innerHeight,e.value&&(e.value.width=t.width,e.value.height=t.height),r()};return M(()=>{i(),r(),u(),window.addEventListener("resize",g)}),D(()=>{c&&cancelAnimationFrame(c),window.removeEventListener("resize",g)}),j(()=>d.particleCount,m=>{r()}),{canvasRef:e,canvasStyle:o,...H(t)}}},ne={key:0,class:"debug-info"};function se(d,e,t,o,n,c){return I(),k("div",null,[f("canvas",{ref:"canvasRef",style:W(o.canvasStyle)},null,4),t.debug?(I(),k("div",ne,[w(" Canvas size: "+y(d.width)+"x"+y(d.height),1),e[0]||(e[0]=f("br",null,null,-1)),w(" Particle count: "+y(d.particles.length),1)])):G("",!0)])}const ie=q(ae,[["render",se],["__scopeId","data-v-31152945"],["__file","D:/临时存放/green-carbon-1.0/src/components/background/ParticleBackground.vue"]]),le={__name:"index",setup(d,{expose:e}){e();const t=P(),o=z(),n=b(null),c=b(!1),i=S({username:"",password:"",rememberMe:!1}),r={username:[{required:!0,message:"请输入用户名",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:6,message:"密码长度不能少于6位",trigger:"blur"}]};let u=null;const g=async()=>{if(n.value)try{await n.value.validate(),c.value=!0,u=A.service({text:"正在登录...",background:"rgba(0, 0, 0, 0.7)"});const s=await U(i.password),p=await x(i.username,s);p.code===200?(p.wechat_bind||await T.alert("你还没有绑定微信，绑定微信后获得更好的体验","未绑定微信"),await m(p)):(console.error(p.message),E.error(p.message))}catch(s){console.error(s),E.error(s.message||"登录失败")}finally{c.value=!1,u&&u.close()}},m=async s=>{var h;v(s);try{await V().getUserInfo(),await R().updateUserPermissions(),oe({title:"登录成功",message:"欢迎回来"+i.username,type:"success"})}catch(O){B(O,"登录成功后获取用户信息失败")}let p=((h=o==null?void 0:o.query)==null?void 0:h.redirect)||"/";t.push(p)},v=s=>{localStorage.setItem("token",s.access_token),localStorage.setItem("refresh_token",s.refresh_token),i.rememberMe?(localStorage.setItem("username",i.username),localStorage.setItem("rememberMe","true")):(localStorage.removeItem("username"),localStorage.removeItem("rememberMe"))};M(()=>{const s=localStorage.getItem("username");localStorage.getItem("permissions")&&localStorage.removeItem("permissions"),s&&(i.username=s,i.rememberMe=localStorage.getItem("rememberMe")==="true")});const _={router:t,route:o,loginFormRef:n,loading:c,loginForm:i,rules:r,get loadingInstance(){return u},set loadingInstance(s){u=s},handleLogin:g,handleLoginSuccess:m,setToken:v,ref:b,reactive:S,onMounted:M,get useRouter(){return P},get useRoute(){return z},get ElMessage(){return E},get ElMessageBox(){return T},get ElLoading(){return A},get loginApi(){return x},get sha256(){return U},Particle:ie,get usePermissionStore(){return R},get handleError(){return B},get useUserStore(){return V}};return Object.defineProperty(_,"__isScriptSetup",{enumerable:!1,value:!0}),_}},me={class:"page-container"},de={class:"login-container"};function ce(d,e,t,o,n,c){const i=L("User"),r=te,u=$,g=Q,m=L("Lock"),v=Z,_=Y,s=X,p=K;return I(),k("div",me,[a(o.Particle,{particleCount:100}),f("div",de,[a(p,{class:"login-card",shadow:"hover"},{default:l(()=>[e[7]||(e[7]=f("img",{class:"logo",src:ee,alt:"logo"},null,-1)),e[8]||(e[8]=f("h2",{class:"login-title"},"综合能源智慧管理系统",-1)),a(s,{ref:"loginFormRef",model:o.loginForm,rules:o.rules,size:"large",onSubmit:J(o.handleLogin,["prevent"])},{default:l(()=>[a(g,{prop:"username"},{default:l(()=>[a(u,{modelValue:o.loginForm.username,"onUpdate:modelValue":e[0]||(e[0]=h=>o.loginForm.username=h),placeholder:"用户名",clearable:""},{prefix:l(()=>[a(r,null,{default:l(()=>[a(i)]),_:1})]),_:1},8,["modelValue"])]),_:1}),a(g,{prop:"password"},{default:l(()=>[a(u,{modelValue:o.loginForm.password,"onUpdate:modelValue":e[1]||(e[1]=h=>o.loginForm.password=h),type:"password",placeholder:"密码","show-password":""},{prefix:l(()=>[a(r,null,{default:l(()=>[a(m)]),_:1})]),_:1},8,["modelValue"])]),_:1}),a(g,null,{default:l(()=>[a(v,{modelValue:o.loginForm.rememberMe,"onUpdate:modelValue":e[2]||(e[2]=h=>o.loginForm.rememberMe=h)},{default:l(()=>e[3]||(e[3]=[w("记住我")])),_:1},8,["modelValue"])]),_:1}),a(g,null,{default:l(()=>[a(_,{type:"primary","native-type":"submit",loading:o.loading},{default:l(()=>e[4]||(e[4]=[w("登录")])),_:1},8,["loading"])]),_:1}),e[6]||(e[6]=f("div",{class:"divider"},"其他登录方式",-1)),a(g,null,{default:l(()=>[a(_,{type:"success",class:"wechat-button"},{default:l(()=>e[5]||(e[5]=[f("i",{class:"iconfont icon-weixin"},null,-1),w("微信登录 ")])),_:1})]),_:1})]),_:1},8,["model"])]),_:1})])])}const je=q(le,[["render",ce],["__scopeId","data-v-374a0b31"],["__file","D:/临时存放/green-carbon-1.0/src/views/Login/index.vue"]]);export{je as default};
