import{_ as R,V as B,r as g,w as T,c as v,d as b,e as h,X as D,J as F,l as i,k as o,f,an as K,g as w,T as j,ai as V,cC as q,cw as J,b0 as O,am as X,v as G}from"./index-DU5BV6sj.js";import{E as H}from"./card-CrntnV6K.js";import{E as Q,a as W}from"./table-column-9ftaDh-i.js";import"./checkbox-B_XNudq6.js";/* empty css                */import"./popper-DmsXjoSL.js";import"./scrollbar-5YYltO8z.js";/* empty css            */import{E as Y}from"./button-C3fNXQ0E.js";import{E as Z}from"./input-Cag95VNY.js";import{u as A,c as I,d as z,a as L}from"./energyUser-D3h_uRCa.js";import{h as C}from"./handleError-Dl3av5vd.js";import{d as M}from"./DebounceAndThrottle-B_grFKK4.js";/* empty css             *//* empty css                 *//* empty css                   */import{E as $}from"./index-BCql8Cu-.js";import{E as ee}from"./index-DemxtX7w.js";import{E}from"./index-BmwD9m8C.js";import{E as te}from"./index-B1KCpUhn.js";import"./plugin-vue_export-helper-CqGSI99y.js";import"./index-imETKNmt.js";import"./_baseIteratee-B5KIseQu.js";import"./_Uint8Array-ntTh0Oyk.js";import"./isEqual-Df5tNRy_.js";import"./index-BRz9a87F.js";import"./_initCloneObject-CWYxvHbU.js";import"./use-form-item-Bwue1zaK.js";import"./index-HfsxB2KS.js";import"./aria-BUADUvnR.js";import"./focus-trap-BFH-jL9N.js";import"./icon-Lrcg122U.js";import"./index-DsemQHVw.js";/* empty css                        */import"./index-BjNTkPPk.js";import"./index-DspxDzgo.js";import"./scroll-b_nwKRMA.js";import"./vnode-CCieS0_D.js";import"./validator-BURDFhOy.js";const ne={__name:"index",setup(P,{expose:n}){n();const x={mounted:t=>V(()=>t.querySelector("input").focus())},e=A(),_=B(),d=g(null),u=g(""),l=g(!1),s=g(null);T(()=>_.currentCompany.id,()=>{e.fetchEnergyUsers()},{immediate:!0});const c=M(()=>{e.fetchEnergyUsers()},300),k=()=>{e.searchTerm="",e.sortConfig={prop:"unknown_ratio",order:"descending"},s.value&&(s.value.clearFilter(),s.value.sort("unknown_ratio","descending")),e.fetchEnergyUsers()},U=({prop:t,order:a})=>{e.sortConfig={prop:t||"unknown_ratio",order:a||"descending"}},S=(t,a)=>t===1?Number(a.unknown_ratio)>0:Number(a.unknown_ratio)===0,y=(t,a)=>e.energyUserList.some(p=>p.name===t&&p.id!==a),N={vFocus:x,energyUsersStore:e,companyStore:_,editingId:d,editingName:u,isNewRow:l,tableRef:s,handleSearch:c,handleReset:k,handleSortChange:U,filterParticipation:S,checkNameDuplicate:y,handleAdd:()=>{if(l.value)return;const t={id:"temp_"+Date.now(),name:"",unknown_ratio:"0"};e.energyUserList.unshift(t),d.value=t.id,u.value="",l.value=!0},handleEdit:t=>{d.value=t.id,u.value=t.name,l.value=!1},handleSave:async t=>{const a=u.value.trim();if(!a){l.value&&(e.energyUserList=e.energyUserList.filter(p=>p.id!==t.id)),d.value=null,l.value=!1;return}if(y(a,t.id)){E.error("用能户名称不能重复"),l.value||(d.value=null),u.value=t.name;return}if(!l.value&&a===t.name){d.value=null;return}e.loading=!0;try{l.value?(await I({company_id:_.currentCompany.id,name:a,unknown_ratio:"0"}),E.success("添加成功")):(await L({id:t.id,name:a}),E.success("保存成功")),await e.fetchEnergyUsers(),d.value=null,l.value=!1}catch(p){C(p,l.value?"添加用能户失败":"保存用能户失败")}finally{e.loading=!1}},handleDelete:async t=>{try{await te.confirm("确认删除该用能户吗？","提示",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}),e.loading=!0;try{await z({id:""+t.id}),await e.fetchEnergyUsers(),E.success("删除成功")}catch(a){C(a,"删除用能户失败")}finally{e.loading=!1}}catch{}},ref:g,nextTick:V,watch:T,get Search(){return q},get Plus(){return J},get Edit(){return O},get Delete(){return X},get useCompanyStore(){return B},get createEnergyUsersApi(){return I},get deleteEnergyUsersApi(){return z},get updateEnergyUsersApi(){return L},get handleError(){return C},get debounce(){return M},get useEnergyUsersStore(){return A}};return Object.defineProperty(N,"__isScriptSetup",{enumerable:!1,value:!0}),N}},re={class:"energy-users-container"},ae={class:"header-operations"},oe={key:0},le={key:1};function ie(P,n,x,e,_,d){const u=Z,l=$,s=Y,c=Q,k=ee,U=W,S=H,y=G;return v(),b(j,null,[n[6]||(n[6]=h("div",{class:"page-title"},[h("span",{class:"title"},"用能户管理")],-1)),h("div",re,[D((v(),F(S,null,{header:i(()=>[h("div",ae,[o(u,{modelValue:e.energyUsersStore.searchTerm,"onUpdate:modelValue":n[0]||(n[0]=r=>e.energyUsersStore.searchTerm=r),placeholder:"搜索用能户...",class:"search-input","prefix-icon":e.Search,size:"small",onInput:e.handleSearch},null,8,["modelValue","prefix-icon","onInput"]),o(s,{type:"primary",size:"small",onClick:e.handleAdd},{default:i(()=>[o(l,null,{default:i(()=>[o(e.Plus)]),_:1}),n[2]||(n[2]=f("添加用能户 "))]),_:1}),o(s,{type:"info",size:"small",onClick:e.handleReset},{default:i(()=>n[3]||(n[3]=[f("重置")])),_:1})])]),default:i(()=>[o(U,{data:e.energyUsersStore.filteredEnergyUsers,style:{width:"100%"},ref:"tableRef"},{default:i(()=>[o(c,{align:"center",label:"名称"},{default:i(({row:r})=>[e.editingId===r.id?(v(),b("div",oe,[D(o(u,{modelValue:e.editingName,"onUpdate:modelValue":n[1]||(n[1]=m=>e.editingName=m),size:"small",onBlur:m=>e.handleSave(r),onKeyup:K(m=>e.handleSave(r),["enter"])},null,8,["modelValue","onBlur","onKeyup"]),[[e.vFocus]])])):(v(),b("span",le,w(r.name),1))]),_:1}),o(c,{align:"center",label:"不明水分摊比例",sortable:"custom",prop:"unknown_ratio","default-sort":{prop:"unknown_ratio",order:"descending"},"sort-orders":["descending","ascending"],onSortChange:e.handleSortChange},{default:i(({row:r})=>[f(w(r.unknown_ratio)+"% ",1)]),_:1}),o(c,{align:"center",label:"是否参与不明水分摊",filters:[{text:"参与",value:1},{text:"不参与",value:0}],"filter-method":e.filterParticipation},{default:i(({row:r})=>[o(k,{type:Number(r.unknown_ratio)>0?"success":"info"},{default:i(()=>[f(w(Number(r.unknown_ratio)>0?"参与":"不参与"),1)]),_:2},1032,["type"])]),_:1}),o(c,{align:"center",label:"操作"},{default:i(({row:r})=>[o(s,{type:"primary",size:"small",icon:e.Edit,onClick:m=>e.handleEdit(r)},{default:i(()=>n[4]||(n[4]=[f("编辑")])),_:2},1032,["icon","onClick"]),o(s,{type:"danger",size:"small",icon:e.Delete,onClick:m=>e.handleDelete(r)},{default:i(()=>n[5]||(n[5]=[f("删除")])),_:2},1032,["icon","onClick"])]),_:1})]),_:1},8,["data"])]),_:1})),[[y,e.energyUsersStore.loading]])])],64)}const Qe=R(ne,[["render",ie],["__scopeId","data-v-2bc425b6"],["__file","D:/临时存放/green-carbon-1.0/src/views/SystemManagement/BlockManagement/energyUsersManagement/index.vue"]]);export{Qe as default};
