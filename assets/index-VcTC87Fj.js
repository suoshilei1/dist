import{aa as R,ab as T,r as w,F as g,_ as A,W as C,T as S,c as f,d as y,e as m,f as B,k as d,l as _,U as D,V as O,J as V,g as Y,N as j}from"./index-DWtISIBF.js";import{E as k,a as M}from"./col-Dnq3X4bl.js";import{E as F}from"./card-Cr9tAXzl.js";/* empty css            */import{E as q,a as H}from"./select-DYqyOwb9.js";import"./scrollbar-BMOxp_jN.js";import"./popper-BNb2tGl7.js";import{B as L}from"./BaseChart-BeO_gFFx.js";import{_ as U}from"./AnimatedNumber--zZLZDKs.js";import{d as p}from"./dayjs.min-t3tQ4ZJg.js";import{c as G}from"./calculateCompare-BbnJreb3.js";import{h as x}from"./handleError-BsBqXgSR.js";import"./plugin-vue_export-helper-CqGSI99y.js";import"./index-DibVzrKz.js";import"./index-CVAPKPs0.js";import"./index-0A8HTOTd.js";import"./index-CuP5NVML.js";import"./use-form-item-CuJrx89H.js";import"./castArray-6TPyo715.js";import"./icon-Cc3ZZocH.js";import"./aria-BUADUvnR.js";import"./scroll-DMdoCUCr.js";import"./isEqual-DqXByToB.js";import"./_Uint8Array-DaZSNKBQ.js";import"./_baseIteratee-FAqII4j1.js";import"./index-DfeXTFmx.js";import"./focus-trap-D8pg8SM_.js";import"./installCanvasRenderer-COQy7h5q.js";import"./DebounceAndThrottle-B_grFKK4.js";/* empty css                *//* empty css             *//* empty css                        */import"./index-CZh1RU_w.js";import"./index-DYLzNb0k.js";const E=l=>R.get("/algorithm/basic_carbon/",{params:l}),N=T("carbon",()=>{const l=w([]),s=w([]),n=(o,e)=>o.reduce((c,i)=>{const a=i.usage[e];return c+(a==null?0:Number(a))},0),t=o=>Object.values(o.usage).reduce((e,c)=>{const i=c==null?0:Number(c);return e+i},0),v=g(()=>{const o={water:n(l.value,"water"),elec:n(l.value,"elec"),gas:n(l.value,"gas"),oil:n(l.value,"oil"),heat:n(l.value,"heat")},e={water:n(s.value,"water"),elec:n(s.value,"elec"),gas:n(s.value,"gas"),oil:n(s.value,"oil"),heat:n(s.value,"heat")},c=Object.values(o).reduce((r,u)=>r+u,0),i=Object.values(e).reduce((r,u)=>r+u,0),a=(r,u)=>u===0?0:((r-u)/u*100).toFixed(2);return{currentYear:o,lastYear:e,yearlyTotal:c,lastYearTotal:i,growthRates:{water:a(o.water,e.water),elec:a(o.elec,e.elec),gas:a(o.gas,e.gas),oil:a(o.oil,e.oil),heat:a(o.heat,e.heat),total:a(c,i)},monthlyData:l.value.map((r,u)=>({startTime:r.start_time,endTime:r.end_time,usage:r.usage,total:t(r),lastYearTotal:s.value[u]?t(s.value[u]):0}))}});async function b(o){try{const e=await E(o);l.value=e.data}catch(e){throw console.error("Failed to fetch current year carbon data:",e),e}}async function h(o){try{const e=await E(o);s.value=e.data}catch(e){throw console.error("Failed to fetch last year carbon data:",e),e}}return{carbonData:l,lastCarbonData:s,carbonStatistics:v,fetchCarbonData:b,fetchLastCarbonData:h}}),P={__name:"index",setup(l,{expose:s}){s();const n=C(),t=N();console.log(p().startOf("year").format("YYYY-MM-DD HH:mm:ss"),p().endOf("year").format("YYYY-MM-DD HH:mm:ss"));async function v(){try{await Promise.all([t.fetchCarbonData({id:n.currentCompany.id,start_time:p().startOf("year").valueOf(),end_time:p().endOf("year").valueOf(),interval:"month"}),t.fetchLastCarbonData({id:n.currentCompany.id,start_time:p().subtract(1,"year").startOf("year").valueOf(),end_time:p().subtract(1,"year").endOf("year").valueOf(),interval:"month"})])}catch(a){x(a,"获取碳排放数据失败")}}S(v);const b=w("overview"),h=[{value:"overview",label:"总览"},{value:"area1",label:"区域一"},{value:"area2",label:"区域二"},{value:"area3",label:"区域三"}],o=g(()=>[{title:"本年总碳排放",value:t.carbonStatistics.yearlyTotal,rate:`${t.carbonStatistics.growthRates.total}%`,trend:Number(t.carbonStatistics.growthRates.total)>0?"up":"down"},{title:"电力碳排放",value:t.carbonStatistics.currentYear.elec,rate:`${t.carbonStatistics.growthRates.elec}%`,trend:Number(t.carbonStatistics.growthRates.elec)>0?"up":"down"},{title:"水资源碳排放",value:t.carbonStatistics.currentYear.water,rate:`${t.carbonStatistics.growthRates.water}%`,trend:Number(t.carbonStatistics.growthRates.water)>0?"up":"down"},{title:"天然气碳排放",value:t.carbonStatistics.currentYear.gas,rate:`${t.carbonStatistics.growthRates.gas}%`,trend:Number(t.carbonStatistics.growthRates.gas)>0?"up":"down"}]),e=g(()=>{const a=t.carbonStatistics.monthlyData;return{title:"碳排放趋势",xAxisData:a.map(r=>p(r.startTime).format("YYYY-MM")),series:[{name:"电力",type:"line",data:a.map(r=>r.usage.elec||0)},{name:"水资源",type:"line",data:a.map(r=>r.usage.water||0)},{name:"天然气",type:"line",data:a.map(r=>r.usage.gas||0)}]}}),i={companyStore:n,carbonStore:t,getCarbonData:v,selectedArea:b,areaOptions:h,overviewData:o,trendChartOptions:e,quotaChartOptions:{title:"设定定额",xAxisData:["2024"],series:[{name:"实际排放",type:"bar",data:[600]},{name:"定额值",type:"bar",data:[650]}]},BaseChart:L,AnimatedNumber:U,ref:w,watchEffect:S,computed:g,get useCompanyStore(){return C},get useCarbonStore(){return N},get dayjs(){return p},get calculateCompare(){return G},get handleError(){return x}};return Object.defineProperty(i,"__isScriptSetup",{enumerable:!1,value:!0}),i}},z={class:"main-container"},J={class:"page-title header"},W={class:"carbon-monitoring"},I={class:"overview-cards"},K={class:"card-content"},Q={class:"card-header"},X={class:"title"},Z={class:"value"};function $(l,s,n,t,v,b){const h=q,o=H,e=F,c=k,i=M;return f(),y("div",z,[m("div",J,[s[1]||(s[1]=B(" 能碳监控 ")),d(o,{style:{width:"150px"},modelValue:t.selectedArea,"onUpdate:modelValue":s[0]||(s[0]=a=>t.selectedArea=a),placeholder:"请选择区域"},{default:_(()=>[(f(),y(D,null,O(t.areaOptions,a=>d(h,{key:a.value,label:a.label,value:a.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),m("div",W,[m("div",I,[(f(!0),y(D,null,O(t.overviewData,(a,r)=>(f(),V(e,{key:r,class:"overview-card"},{default:_(()=>[m("div",K,[m("div",Q,[m("span",X,Y(a.title),1),m("span",{class:j(["rate",a.trend])},Y(a.rate),3)]),m("div",Z,[d(t.AnimatedNumber,{suffix:"吨",value:a.value},null,8,["value"])])])]),_:2},1024))),128))])]),d(i,{gutter:16,class:"charts-container"},{default:_(()=>[d(c,{span:16},{default:_(()=>[d(e,{header:"碳排放趋势"},{default:_(()=>[d(t.BaseChart,{height:"430px",options:t.trendChartOptions},null,8,["options"])]),_:1})]),_:1}),d(c,{span:8},{default:_(()=>[d(e,{header:"设定定额"},{default:_(()=>[d(t.BaseChart,{height:"430px",options:t.quotaChartOptions})]),_:1})]),_:1})]),_:1})])}const Vt=A(P,[["render",$],["__file","D:/临时存放/green-carbon-1.0/src/views/EnergyData/GreenCarbon/index.vue"]]);export{Vt as default};
