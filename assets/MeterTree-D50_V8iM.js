import{z as Q,at as W,D as j,au as Y,E as Z,r as g,F as b,H as $,c as h,J as E,l as i,e as r,N as T,I as a,n as ee,K as te,h as P,f as D,g as M,M as R,k as _,aq as oe,O as ne,_ as re,q as V,i as A,d as I,X as se,V as le,w as ae,ai as ie,v as ce}from"./index-DU5BV6sj.js";import{E as pe}from"./dialog-BqmwFatm.js";import"./overlay-CaKmC84a.js";import{_ as fe}from"./MeterDialog-CfKn1aHN.js";import{E as de}from"./tree-D0vh79S7.js";import"./checkbox-B_XNudq6.js";import{u as z,E as F}from"./popper-DmsXjoSL.js";import{b as L,E as q}from"./button-C3fNXQ0E.js";/* empty css                */import{u as U,k as O}from"./meter-CawyXifQ.js";/* empty css             *//* empty css                 */import{E as ue}from"./index-BCql8Cu-.js";import{i as me}from"./icon-Lrcg122U.js";import{_ as ye}from"./plugin-vue_export-helper-CqGSI99y.js";import{E as B}from"./index-BmwD9m8C.js";const _e=Q({title:String,confirmButtonText:String,cancelButtonText:String,confirmButtonType:{type:String,values:L,default:"primary"},cancelButtonType:{type:String,values:L,default:"text"},icon:{type:me,default:()=>W},iconColor:{type:String,default:"#f90"},hideIcon:{type:Boolean,default:!1},hideAfter:{type:Number,default:200},teleported:z.teleported,persistent:z.persistent,width:{type:[String,Number],default:150}}),ve={confirm:f=>f instanceof MouseEvent,cancel:f=>f instanceof MouseEvent},ge=j({name:"ElPopconfirm"}),he=j({...ge,props:_e,emits:ve,setup(f,{emit:o}){const c=f,{t}=Y(),p=Z("popconfirm"),k=g(),d=()=>{var e,s;(s=(e=k.value)==null?void 0:e.onClose)==null||s.call(e)},u=b(()=>({width:$(c.width)})),m=e=>{o("confirm",e),d()},y=e=>{o("cancel",e),d()},v=b(()=>c.confirmButtonText||t("el.popconfirm.confirmButtonText")),C=b(()=>c.cancelButtonText||t("el.popconfirm.cancelButtonText"));return(e,s)=>(h(),E(a(F),oe({ref_key:"tooltipRef",ref:k,trigger:"click",effect:"light"},e.$attrs,{"popper-class":`${a(p).namespace.value}-popover`,"popper-style":a(u),teleported:e.teleported,"fallback-placements":["bottom","top","right","left"],"hide-after":e.hideAfter,persistent:e.persistent}),{content:i(()=>[r("div",{class:T(a(p).b())},[r("div",{class:T(a(p).e("main"))},[!e.hideIcon&&e.icon?(h(),E(a(ue),{key:0,class:T(a(p).e("icon")),style:ee({color:e.iconColor})},{default:i(()=>[(h(),E(te(e.icon)))]),_:1},8,["class","style"])):P("v-if",!0),D(" "+M(e.title),1)],2),r("div",{class:T(a(p).e("action"))},[R(e.$slots,"actions",{confirm:m,cancel:y},()=>[_(a(q),{size:"small",type:e.cancelButtonType==="text"?"":e.cancelButtonType,text:e.cancelButtonType==="text",onClick:y},{default:i(()=>[D(M(a(C)),1)]),_:1},8,["type","text"]),_(a(q),{size:"small",type:e.confirmButtonType==="text"?"":e.confirmButtonType,text:e.confirmButtonType==="text",onClick:m},{default:i(()=>[D(M(a(v)),1)]),_:1},8,["type","text"])])],2)],2)]),default:i(()=>[e.$slots.reference?R(e.$slots,"reference",{key:0}):P("v-if",!0)]),_:3},16,["popper-class","popper-style","teleported","hide-after","persistent"]))}});var Ce=ye(he,[["__file","popconfirm.vue"]]);const ke=ne(Ce),be={__name:"MeterTree",props:{data:{type:Array,default:()=>[]}},setup(f,{expose:o}){o();let c=V();const t=c.hasPermission("manage_device"),p=A(),k=b(()=>p.name==="DeviceInfo");let d=f;const u=g(!1),m=g(!1),y=g(null),v=g(null),C=g(null),e={id:"id",children:"children",label:"label"};let s=U();function w(n){v.value=n,y.value=null,m.value=!0}function H(){v.value={id:0,label:"根节点",type:0},y.value=null,m.value=!0}function J(n){n&&s.setCurrentMeter(n)}function K(n,l){if(l&&l.id){let S=[l.id];x(S)}}const X=()=>{var S;const l=(((S=C.value)==null?void 0:S.getCheckedNodes(!1,!1))||[]).map(G=>G.id).filter(Boolean);l.length>0&&x(l)};function x(n){!Array.isArray(n)||n.length===0||O(n).then(l=>{l.code===200?(B.success("删除成功"),s.fetchMeterList()):(console.error(l.message),B.error(l.message||"删除失败"))}).catch(l=>{console.error(l),B.error("删除失败")})}const N={get permisstionStore(){return c},set permisstionStore(n){c=n},isEdit:t,route:p,isDeviceInfoRoute:k,get props(){return d},set props(n){d=n},loading:u,dialogVisible:m,currentMeter:y,parent_meter:v,treeRef:C,defaultProps:e,get meterStore(){return s},set meterStore(n){s=n},append:w,addRootMeter:H,handleClick:J,remove:K,removeMeters:X,deletePost:x,refresh:async()=>{u.value=!0;try{await s.fetchMeterList()}catch(n){console.error("刷新失败:",n),B.error("刷新失败")}finally{u.value=!1}},get deleteMeterApi(){return O},get useCompanyStore(){return le},get useMeterStore(){return U},ref:g,watch:ae,nextTick:ie,computed:b,get useRoute(){return A},get usePermissionStore(){return V}};return Object.defineProperty(N,"__isScriptSetup",{enumerable:!1,value:!0}),N}},Me={class:"tree-wrapper"},Se={class:"tree-container"},Te={class:"header"},Be={class:"company-name"},Ee={key:0,class:"header-actions"},Pe={class:"custom-tree-node"},we={class:"node-label"},xe={key:0,class:"node-actions"},De=["onClick"];function Ie(f,o,c,t,p,k){const d=F,u=ke,m=de,y=fe,v=pe,C=ce;return h(),I("div",Me,[r("div",Se,[r("div",Te,[_(d,{content:t.useCompanyStore().currentCompany.name,placement:"top","show-after":500},{default:i(()=>[r("span",Be,M(t.useCompanyStore().currentCompany.name),1)]),_:1},8,["content"]),t.isDeviceInfoRoute&&t.isEdit?(h(),I("div",Ee,[r("a",{type:"primary",onClick:t.addRootMeter},o[2]||(o[2]=[r("i",{class:"fa fa-plus"},null,-1)])),_(u,{placement:"top",title:"确定删除勾选的表计吗？",onConfirm:t.removeMeters},{reference:i(()=>o[3]||(o[3]=[r("a",null,[r("i",{class:"fa fa-minus"})],-1)])),_:1}),r("a",{type:"primary",onClick:t.refresh},o[4]||(o[4]=[r("i",{class:"fa fa-refresh"},null,-1)]))])):P("",!0)]),se((h(),E(m,{onNodeClick:t.handleClick,style:{display:"inline-block",width:"100%"},"element-loading-text":"loading...","show-checkbox":t.isDeviceInfoRoute&&t.isEdit,ref:"treeRef",indent:10,class:"eye-tree",data:c.data,props:t.defaultProps,"node-key":"id","highlight-current":!0,"default-expand-all":!0,"expand-on-click-node":!1},{default:i(({node:e,data:s})=>[r("div",Pe,[_(d,{content:e.label,placement:"top","show-after":500},{default:i(()=>[r("span",we,M(e.label),1)]),_:2},1032,["content"]),t.isDeviceInfoRoute&&t.isEdit?(h(),I("span",xe,[r("a",{onClick:w=>t.append(s)},o[5]||(o[5]=[r("i",{class:"fa fa-plus"},null,-1)]),8,De),_(u,{placement:"top",title:`确定删除${e.label}表计吗？`,onConfirm:w=>t.remove(e,s)},{reference:i(()=>o[6]||(o[6]=[r("a",null,[r("i",{class:"fa fa-minus"})],-1)])),_:2},1032,["title","onConfirm"])])):P("",!0)])]),_:1},8,["show-checkbox","data"])),[[C,t.loading]]),_(v,{title:t.currentMeter?"编辑表计":"新增表计","destroy-on-close":"","align-center":"",modelValue:t.dialogVisible,"onUpdate:modelValue":o[1]||(o[1]=e=>t.dialogVisible=e)},{default:i(()=>[_(y,{"onUpdate:visible":o[0]||(o[0]=e=>t.dialogVisible=!1),pMeter:t.parent_meter,id:t.currentMeter?+t.currentMeter.meter_id:null},null,8,["pMeter","id"])]),_:1},8,["title","modelValue"])])])}const We=re(be,[["render",Ie],["__scopeId","data-v-47879ef3"],["__file","D:/临时存放/green-carbon-1.0/src/components/meter/MeterTree.vue"]]);export{We as M};
