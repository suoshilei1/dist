import{_ as U,q as v,r as l,o as k,c as P,d as x,X as H,e as m,g as b,k as E,l as S,f as L,cG as w,cH as T,ai as V,y as C,v as j}from"./index-DU5BV6sj.js";import{E as q}from"./button-C3fNXQ0E.js";import{E as z}from"./tree-D0vh79S7.js";import"./checkbox-B_XNudq6.js";import{h as K}from"./handleError-Dl3av5vd.js";/* empty css             *//* empty css                   *//* empty css                 */import{E as G}from"./index-B1KCpUhn.js";import{E as B}from"./index-BmwD9m8C.js";import"./index-BCql8Cu-.js";import"./plugin-vue_export-helper-CqGSI99y.js";import"./index-HfsxB2KS.js";import"./use-form-item-Bwue1zaK.js";import"./icon-Lrcg122U.js";import"./select-CVxfSd-L.js";import"./popper-DmsXjoSL.js";import"./index-imETKNmt.js";import"./aria-BUADUvnR.js";import"./focus-trap-BFH-jL9N.js";import"./scrollbar-5YYltO8z.js";import"./index-DemxtX7w.js";import"./castArray-C1OtMDCV.js";import"./index-DsemQHVw.js";import"./scroll-b_nwKRMA.js";import"./isEqual-Df5tNRy_.js";import"./_Uint8Array-ntTh0Oyk.js";import"./_baseIteratee-B5KIseQu.js";import"./index-BRz9a87F.js";/* empty css                        */import"./index-BjNTkPPk.js";import"./input-Cag95VNY.js";import"./index-DspxDzgo.js";import"./vnode-CCieS0_D.js";import"./validator-BURDFhOy.js";const I={__name:"UserPermission",props:["userinfo"],setup(u,{expose:n}){n();const f=v(),e=l(null),_={children:"children",label:"label"};let s=u;const a=l(null),i=l(!1),c=async()=>{var t;try{i.value=!0;let r=await w({id:s.userinfo.id}),o=await T({username:s.userinfo.username});a.value=o.data[0];let d=r.data;(t=e.value)==null||t.setCheckedKeys(d)}catch(r){K(r)}finally{i.value=!1}},p=async()=>{var t,r;try{const o=((t=e.value)==null?void 0:t.getCheckedKeys())||[],d=((r=e.value)==null?void 0:r.getHalfCheckedKeys())||[],h=R=>R.filter(D=>{const y=e.value.getNode(D);return!y.childNodes||y.childNodes.length===0}),A=h(o),N=h(d),M=[...A,...N];await G.confirm("确定要保存权限更改吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await C({user_id:s.userinfo.id,permissions:M}),B.success("权限保存成功")}catch(o){o!=="cancel"&&B.error("保存失败："+o.message)}};k(()=>{c()});const g={permissionStore:f,permissionTreeRef:e,defaultProps:_,get props(){return s},set props(t){s=t},role:a,loading:i,initializePermissionTree:c,handleSave:p,ref:l,onMounted:k,nextTick:V,get usePermissionStore(){return v},get getPermissionApi(){return w},get getRoleApi(){return T},get updatePermissionApi(){return C},get handleError(){return K}};return Object.defineProperty(g,"__isScriptSetup",{enumerable:!1,value:!0}),g}},O={class:"permission-management"},X={class:"permission-tree-container"},F={style:{"margin-bottom":"1rem"}},J={class:"permission-node"},Q={class:"actions"};function W(u,n,f,e,_,s){const a=z,i=q,c=j;return P(),x("div",O,[H((P(),x("div",X,[m("span",F,"当前权限："+b(e.role),1),E(a,{ref:"permissionTreeRef",data:e.permissionStore.permissionTreeData,props:e.defaultProps,"show-checkbox":"","node-key":"code","default-expand-all":"","check-strictly":!1},{default:S(({node:p})=>[m("div",J,[m("span",null,b(p.label),1)])]),_:1},8,["data"])])),[[c,e.loading]]),m("div",Q,[E(i,{type:"primary",onClick:e.handleSave},{default:S(()=>n[0]||(n[0]=[L("保存权限设置")])),_:1})])])}const Ne=U(I,[["render",W],["__scopeId","data-v-ba40007b"],["__file","D:/临时存放/green-carbon-1.0/src/views/SystemManagement/UserManagement/components/UserPermission.vue"]]);export{Ne as default};
