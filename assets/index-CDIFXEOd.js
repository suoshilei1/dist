import{_ as G,r as _,F as O,o as Q,c as p,d as g,e as u,i as r,j as d,U as D,V as L,g as z,I as U,cq as W,f as b,Y as X,N as Z,k as ee,ag as te,h as A,ai as ae,J as j,ac as oe,v as le}from"./index-Bx6Y8L80.js";import{E as ne}from"./card-fNeABwz5.js";import{E as se}from"./empty-CF5nbTvc.js";import{E as re}from"./input-CFaQgGx5.js";/* empty css                */import{E as ie}from"./popper-DBn8ulUn.js";import{E as ce}from"./button-8bviUT_H.js";import{d as ue,g as k,c as de}from"./constant-Dm8qiNaG.js";import{h as V}from"./handleError-DD4JYoq7.js";import{E as pe}from"./index-slq3sC_j.js";import{E}from"./index-KJp6TXG9.js";import{E as me}from"./index-A4BGBRGh.js";import"./plugin-vue_export-helper-CqGSI99y.js";import"./use-form-item-50hJ8Ppj.js";import"./index-CuyxIfpa.js";import"./icon-6zrsquxY.js";import"./index-iw6eP590.js";import"./aria-BUADUvnR.js";import"./focus-trap-Ddg061Nm.js";import"./index-AkNVqhGZ.js";/* empty css             *//* empty css                        */import"./index-CWCMyxJA.js";import"./index-DZY-cmUL.js";import"./scroll-BawlEUY1.js";import"./vnode-DK7gyQZj.js";import"./validator-ulZFuTQV.js";const fe=C=>{const m=[C],f=y=>{categories.value.filter(n=>n.part_of===y).forEach(n=>{m.push(n),f(n.id)})};return f(C.id),m},ve={class:"category-management"},_e={class:"category-levels"},ge={class:"level-header"},ye={class:"category-list","element-loading-text":"加载中..."},he=["onClick"],Ce={class:"category-name"},ke={class:"category-actions"},Ee={key:1,class:"category-item adding"},we={style:{width:"100%",display:"flex","justify-content":"center","align-items":"center"}},xe={__name:"index",setup(C){const m=_(!1),f=_(!1),y=_([]),l=_({}),n=_(null),i=_(""),$=_(null),w=O(()=>{const t={};t[1]=y.value.filter(e=>e.level===1).sort((e,o)=>e.sort-o.sort);for(let e=2;e<=4;e++){const o=l.value[e-1];o?t[e]=y.value.filter(a=>a.part_of===o.id).sort((a,h)=>a.sort-h.sort):t[e]=[]}return t}),F=t=>t===1?!0:l.value[t-1]!==void 0,K=(t,e)=>{var o;if(((o=l.value[e])==null?void 0:o.id)===t.id){l.value[e]=null;for(let a=e+1;a<=4;a++)l.value[a]=null}else{l.value[e]=t;for(let a=e+1;a<=4;a++)l.value[a]=null}},M=t=>{n.value=t,i.value="",oe(()=>{$.value[0].focus()})},x=()=>{n.value=null,i.value=""},P=()=>{i.value||x()},R=async t=>{try{const e=fe(t),o=e.length,a=o>1?`确认删除分类"${t.value}"及其${o-1}个子分类吗？删除后将无法恢复！`:`确认删除分类"${t.value}"吗？删除后将无法恢复！`;await pe.confirm(a,"警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",dangerouslyUseHTMLString:!0}),await Promise.all(e.map(v=>ue({id:""+v.id}))),E.success("删除成功"),await B();const h=t.level;for(let v=h;v<=4;v++)l.value[v]=null}catch(e){e!=="cancel"&&V(e,"删除失败",!0)}},B=async()=>{m.value=!0;try{const[t,e,o,a]=await Promise.all([k({level:1}),k({level:2}),k({level:3}),k({level:4})]);y.value=[...t.data,...e.data,...o.data,...a.data]}catch(t){V(t,"获取分类数据失败",!0)}finally{m.value=!1}},N=async()=>{var t;if(!i.value){E.warning("请输入分类名称");return}if(i.value.length<2||i.value.length>50){E.warning("分类名称长度应在 2 到 50 个字符之间");return}try{f.value=!0;const e={value:i.value,part_of:n.value===1?null:(t=l.value[n.value-1])==null?void 0:t.id,sort:0,level:n.value};await de(e),E.success("添加成功"),x(),await B()}catch(e){V(e,"添加失败",!0)}finally{f.value=!1}};return Q(()=>{B()}),(t,e)=>{const o=me,a=ce,h=ie,v=re,q=se,H=ne,J=le;return p(),g("div",ve,[e[4]||(e[4]=u("div",{class:"page-title"}," 分类管理 ",-1)),r(H,{class:"mb-4",shadow:"hover"},{default:d(()=>[u("div",_e,[(p(),g(D,null,L(4,s=>{var T,I;return u("div",{key:s,class:"level-panel"},[u("div",ge,[u("h3",null,z(s)+"级分类",1),r(a,{type:"primary",size:"small",onClick:c=>M(s),disabled:!F(s)},{default:d(()=>[r(o,null,{default:d(()=>[r(U(W))]),_:1}),e[1]||(e[1]=b("添加 "))]),_:2},1032,["onClick","disabled"])]),X((p(),g("div",ye,[(T=w.value[s])!=null&&T.length?(p(!0),g(D,{key:0},L(w.value[s],c=>{var S;return p(),g("div",{onClick:Y=>K(c,s),key:c.id,class:Z(["category-item",{active:((S=l.value[s])==null?void 0:S.id)===c.id}])},[u("span",Ce,z(c.value),1),u("div",ke,[r(h,{content:"删除",placement:"top"},{default:d(()=>[r(o,{class:"action-icon delete",onClick:ee(Y=>R(c),["stop"])},{default:d(()=>[r(U(te))]),_:2},1032,["onClick"])]),_:2},1024)])],10,he)}),128)):A("",!0),n.value===s?(p(),g("div",Ee,[r(v,{ref_for:!0,ref_key:"inputRef",ref:$,modelValue:i.value,"onUpdate:modelValue":e[0]||(e[0]=c=>i.value=c),modelModifiers:{trim:!0},placeholder:"请输入分类名称",size:"small",maxlength:"50","validate-event":!1,onKeyup:ae(N,["enter"]),onBlur:P},{append:d(()=>[r(a,{style:{"margin-right":"1px"},onClick:N,loading:f.value},{default:d(()=>e[2]||(e[2]=[b(" 确定 ")])),_:1},8,["loading"]),r(a,{onClick:x},{default:d(()=>e[3]||(e[3]=[b(" 取消 ")])),_:1})]),_:1},8,["modelValue"])])):A("",!0),u("div",we,[r(a,{icon:"plus",type:"primary",onClick:c=>M(s),circle:""},null,8,["onClick"])]),(I=w.value[s])!=null&&I.length?A("",!0):(p(),j(q,{key:2,description:"暂无数据"}))])),[[J,m.value]])])}),64))])]),_:1})])}}},Be=G(xe,[["__scopeId","data-v-8a8871bd"]]),Ze={__name:"index",setup(C){return(m,f)=>(p(),j(Be))}};export{Ze as default};
