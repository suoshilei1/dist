import{_ as I,V as x,r as y,w as b,c,d as _,e as V,k as n,l as r,f as N,X as K,J as U,an as C,g as P,v as z}from"./index-DU5BV6sj.js";import{E as T}from"./card-CrntnV6K.js";import{E as W,a as M}from"./table-column-9ftaDh-i.js";import"./checkbox-B_XNudq6.js";/* empty css                */import"./popper-DmsXjoSL.js";import"./scrollbar-5YYltO8z.js";import{E as j}from"./input-Cag95VNY.js";import{E as J}from"./input-number-BQBJL8eX.js";/* empty css            */import{E as L}from"./button-C3fNXQ0E.js";import{a as k,c as S,u as w,d as A}from"./price-CHbb6f-c.js";import{d as B}from"./DebounceAndThrottle-B_grFKK4.js";/* empty css             *//* empty css                 *//* empty css                   */import{E as d}from"./index-BmwD9m8C.js";import{E as O}from"./index-B1KCpUhn.js";import"./plugin-vue_export-helper-CqGSI99y.js";import"./index-imETKNmt.js";import"./_baseIteratee-B5KIseQu.js";import"./_Uint8Array-ntTh0Oyk.js";import"./isEqual-Df5tNRy_.js";import"./index-BCql8Cu-.js";import"./index-BRz9a87F.js";import"./_initCloneObject-CWYxvHbU.js";import"./use-form-item-Bwue1zaK.js";import"./index-HfsxB2KS.js";import"./aria-BUADUvnR.js";import"./focus-trap-BFH-jL9N.js";import"./icon-Lrcg122U.js";import"./index-DsemQHVw.js";import"./index-BcLR6-Z9.js";import"./index-DspxDzgo.js";import"./scroll-b_nwKRMA.js";import"./vnode-CCieS0_D.js";import"./validator-BURDFhOy.js";const R={__name:"index",setup(D,{expose:i}){i();const m=x(),a=y([]),l=y(!1),f=y("");async function o(){l.value=!0;try{let e=await k({type:1,company_id:m.currentCompany.id,name:f.value?`%${f.value}%`:void 0});a.value=e.data}catch{d.error("获取价格失败")}finally{l.value=!1}}const p=B(o,500),u=()=>{const e={name:"",fixed_price:0,tempPrice:0,isNew:!0,company_id:m.currentCompany.id,price_mode:"固定价格",type:1};a.value.unshift(e)},v=e=>{!e.name&&e.isNew&&(a.value=a.value.filter(s=>s!==e))},g=e=>{e.isEditing=!0,e.tempPrice=e.fixed_price},h=async e=>{if(!e.name){d.warning("请输入用水类别");return}if(e.isNew)e.fixed_price=e.tempPrice||0;else if(e.tempPrice==e.fixed_price){d.info("价格未修改"),e.isEditing=!1;return}l.value=!0;let s={...e.isNew?{name:e.name,company_id:e.company_id,price_mode:e.price_mode,type:e.type,fixed_price:e.tempPrice||0}:{id:e.id,fixed_price:e.tempPrice}};try{e.isNew?await S(s):await w(s),await o(),d.success(e.isNew?"添加成功":"修改成功")}catch{d.error(e.isNew?"添加失败":"保存失败")}finally{e.isEditing=!1,e.isNew=!1,l.value=!1}},E=async e=>{if(e.isNew){a.value=a.value.filter(s=>s!==e);return}try{await O.confirm("确定要删除该价格方案吗？","提示",{type:"warning"}),l.value=!0,await A({id:""+e.id}),d.success("删除成功"),await o()}catch(s){s!=="cancel"&&d.error("删除失败")}finally{l.value=!1}};b(()=>m.currentCompany,async()=>{await o()},{immediate:!0});const t={companyStore:m,waterPrices:a,loading:l,searchName:f,fetchWaterPrice:o,handleSearch:p,handleAdd:u,handleNameBlur:v,handleEdit:g,handleSave:h,handleDelete:E,get getPricesApi(){return k},get createPriceApi(){return S},get updatePriceApi(){return w},get deletePriceApi(){return A},get useCompanyStore(){return x},get debounce(){return B},ref:y,watch:b};return Object.defineProperty(t,"__isScriptSetup",{enumerable:!1,value:!0}),t}},X={class:"water-price-container"},q={key:0},F={key:1},G={key:0},H={key:1};function Q(D,i,m,a,l,f){const o=j,p=L,u=W,v=J,g=M,h=T,E=z;return c(),_("div",X,[i[3]||(i[3]=V("div",{class:"page-title"},[V("div",null,"水费定价管理")],-1)),n(h,{class:"system-card"},{header:r(()=>[n(o,{clearable:"",modelValue:a.searchName,"onUpdate:modelValue":i[0]||(i[0]=t=>a.searchName=t),style:{width:"150px"},placeholder:"搜索用水类别",onInput:a.handleSearch},null,8,["modelValue","onInput"]),n(p,{icon:"plus",size:"small",type:"primary",onClick:a.handleAdd},{default:r(()=>i[1]||(i[1]=[N("添加定价方案")])),_:1})]),default:r(()=>[K((c(),U(g,{data:a.waterPrices,border:"",style:{width:"100%"}},{default:r(()=>[n(u,{align:"center",prop:"name",label:"用水类别"},{default:r(({row:t})=>[t.isEditing||t.isNew?(c(),_("div",q,[n(o,{modelValue:t.name,"onUpdate:modelValue":e=>t.name=e,placeholder:"请输入用水类别",onBlur:e=>a.handleNameBlur(t),onKeyup:C(e=>a.handleSave(t),["enter"])},null,8,["modelValue","onUpdate:modelValue","onBlur","onKeyup"])])):(c(),_("div",F,P(t.name),1))]),_:1}),n(u,{align:"center",label:"价格(元/吨)"},{default:r(({row:t})=>[t.isEditing||t.isNew?(c(),_("div",G,[n(v,{modelValue:t.tempPrice,"onUpdate:modelValue":e=>t.tempPrice=e,precision:2,step:.1,min:0,max:999,style:{width:"100%"},onKeyup:C(e=>a.handleSave(t),["enter"])},null,8,["modelValue","onUpdate:modelValue","onKeyup"])])):(c(),_("div",H,P(t.fixed_price),1))]),_:1}),n(u,{align:"center",label:"操作"},{default:r(t=>[n(p,{size:"small",type:t.row.isEditing||t.row.isNew?"success":"primary",onClick:e=>t.row.isEditing||t.row.isNew?a.handleSave(t.row):a.handleEdit(t.row)},{default:r(()=>[N(P(t.row.isEditing||t.row.isNew?"保存":"编辑"),1)]),_:2},1032,["type","onClick"]),n(p,{size:"small",type:"danger",onClick:e=>a.handleDelete(t.row)},{default:r(()=>i[2]||(i[2]=[N(" 删除 ")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[E,a.loading]])]),_:1})])}const Ue=I(R,[["render",Q],["__scopeId","data-v-c997e05c"],["__file","D:/临时存放/green-carbon-1.0/src/views/EnergyData/WaterData/WaterCost/PriceSetting/index.vue"]]);export{Ue as default};
