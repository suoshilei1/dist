import{a6 as we,r as D,_ as B,F as V,c as u,J as Y,j as n,d as f,U as P,V as A,i as o,e as l,g as h,N as z,h as F,n as ke,f as S,m as ae,I as G,ag as Ve,W as J,T as H,Y as ie,v as ue,w as xe,ah as Ce}from"./index-Bx6Y8L80.js";/* empty css             */import{c as Ue}from"./header-DL-7jVxr.js";import{E as de,a as ce}from"./col-TrHbeXFY.js";import{E as pe}from"./empty-CF5nbTvc.js";import{d as O}from"./dayjs.min-Cd48fqZ9.js";import{E as K}from"./card-fNeABwz5.js";/* empty css                */import{E as me}from"./popper-DBn8ulUn.js";import{_ as Ee}from"./AnimatedNumber-BnUE5Cda.js";import{g as le}from"./price-BNLDcrLr.js";import{u as Q,E as $e}from"./divider-DslenhMj.js";import{E as X}from"./button-8bviUT_H.js";import{u as ve}from"./area-COPnz-hV.js";import{_ as Re}from"./设置-D6o4v_fI.js";import{u as De,d as oe,p as re}from"./meter-5sbrBbgq.js";import{h as q}from"./handleError-DD4JYoq7.js";import{u as Z,a as se}from"./energyUser-DEVB5SRj.js";import{E as Se}from"./dialog-Dt2QUqOw.js";import"./overlay-04qnzRyj.js";import{E as Te,a as Fe}from"./form-item-CWYWsPGl.js";import"./input-CFaQgGx5.js";import{E as Pe}from"./input-number-APkjfsE3.js";/* empty css            */import{E as _e,a as fe}from"./select-BmMHn9PT.js";import"./scrollbar-DuXO1tWo.js";import{E as Me,a as Ye}from"./radio-group-i8YIvWc2.js";/* empty css              */import{E as Le}from"./index-A4BGBRGh.js";/* empty css             *//* empty css                 */import{E as Ae}from"./index-KJp6TXG9.js";import{C as Ie}from"./CustomDatePicker-CX6MdPmZ.js";import"./plugin-vue_export-helper-CqGSI99y.js";import"./index-iw6eP590.js";import"./index-CuyxIfpa.js";import"./use-form-item-50hJ8Ppj.js";import"./aria-BUADUvnR.js";import"./focus-trap-Ddg061Nm.js";import"./index-AkNVqhGZ.js";import"./icon-6zrsquxY.js";/* empty css                        */import"./index-CWCMyxJA.js";import"./index-DZY-cmUL.js";import"./scroll-BawlEUY1.js";import"./vnode-DK7gyQZj.js";import"./refs-Bp53MkJS.js";import"./castArray-CrUPC_Z8.js";import"./_Uint8Array-B6mJ0Xm4.js";import"./_initCloneObject-nnMrnZRY.js";import"./index-DLcTS03G.js";import"./index-aFn2MKle.js";import"./isEqual-BM-Gj-iT.js";import"./_baseIteratee-CkjM3wkz.js";import"./index-zrRcpBp4.js";import"./date-picker-CfUXe-Kp.js";const ne=(U,i,k={})=>{if(typeof U!="number"||typeof i!="number")throw new Error("参数必须为数字类型");const{precision:C=2,asPercent:m=!1,zeroStrategy:c="zero",zeroValue:e="-- --"}=k;if(i===0)switch(c){case"zero":return m?"0%":0;case"keep":return m?`${U}%`:U;case"custom":return e;default:throw new Error("无效的zeroStrategy值")}const s=(U-i)/Math.abs(i)*100,_=Number(s.toFixed(C));return m?`${_}%`:_},ee=we("waterPrice",()=>{const U=D([]),i=D([]);return{priceDetail:U,lastPriceDetail:i,getPriceDetail:async m=>{let c=await le(m);m.area_id&&(c.data={...c.data,areas:[c.data]}),console.log(c.data),U.value=c.data},getLastPriceDetail:async m=>{let c=await le(m);i.value=c.data}}}),Oe={class:"stat-header"},Be={class:"stat-title"},ze={key:1,class:"prices-grid"},We={class:"type-text"},Ne={class:"price-value"},je={key:2,class:"stat-compare"},qe={class:"compare-current"},Ge={class:"compare-last"},Je={__name:"StatisticsCard",setup(U){let i=ee(),k=Q(),C=V(()=>{var x,y;let _=((y=(x=i.priceDetail)==null?void 0:x.areas)==null?void 0:y.map(v=>v.rule_id))??[];return[...new Set(_)].map(v=>({type:k.getPriceRuleNameById(v),price:k.getPriceRulePriceById(v),color:"#409EFF"}))});const m=V(()=>{var _,E,x,y;return{waterUsage:{current:((_=i==null?void 0:i.priceDetail)==null?void 0:_.usage)??0,lastYear:((E=i==null?void 0:i.lastPriceDetail)==null?void 0:E.usage)??0},waterCost:{current:((x=i==null?void 0:i.priceDetail)==null?void 0:x.price)??0,lastYear:((y=i==null?void 0:i.lastPriceDetail)==null?void 0:y.price)??0},prices:C.value}}),c=_=>_>0?"compare-up":"compare-down",e=_=>_>0?"fa fa-arrow-up":"fa fa-arrow-down",s=V(()=>[{title:"用水单价",hasPrices:!0,icon:"fa fa-dollar",colorClass:"text-danger"},{title:"用水量",value:m.value.waterUsage.current,prefix:"",unit:"m³",icon:"fa fa-tint",colorClass:"text-success",compare:{value:ne(+m.value.waterUsage.current,+m.value.waterUsage.lastYear),lastYear:m.value.waterUsage.lastYear}},{title:"用水费用",value:m.value.waterCost.current,prefix:"¥",icon:"fa fa-money",colorClass:"text-primary",compare:{value:ne(+m.value.waterCost.current,+m.value.waterCost.lastYear),lastYear:m.value.waterCost.lastYear}}]);return(_,E)=>{const x=me,y=K,v=de,g=ce;return u(),Y(g,{gutter:20,class:"statistics"},{default:n(()=>[(u(!0),f(P,null,A(s.value,r=>(u(),Y(v,{span:8,key:r.title},{default:n(()=>[o(y,{shadow:"hover",class:"stat-card"},{default:n(()=>[l("div",Oe,[l("div",Be,h(r.title),1),l("div",{class:z(["stat-icon",r.colorClass])},[l("i",{class:z(r.icon)},null,2)],2)]),r.hasPrices?F("",!0):(u(),f("div",{key:0,class:z(["stat-value",r.colorClass])},[o(Ee,{value:r.value,prefix:r.prefix,suffix:r.unit},null,8,["value","prefix","suffix"])],2)),r.hasPrices?(u(),f("div",ze,[(u(!0),f(P,null,A(m.value.prices,d=>(u(),f("div",{key:d.type,class:"price-item"},[l("div",{class:"price-circle",style:ke({backgroundColor:d.color})},[o(x,{content:d.type,placement:"top"},{default:n(()=>[l("span",We,h(d.type.slice(0,2)),1)]),_:2},1032,["content"])],4),l("div",Ne,"¥"+h(d.price)+"/m³",1)]))),128))])):F("",!0),r.compare?(u(),f("div",je,[l("div",qe,[E[0]||(E[0]=l("span",{class:"compare-label"},"同比",-1)),l("span",{class:z(["compare-value",c(r.compare.value)])},[l("i",{class:z(e(r.compare.value))},null,2),S(" "+h(r.compare.value)+"% ",1)],2)]),l("div",Ge," 去年同期："+h(r.prefix)+h(r.compare.lastYear)+h(r.unit),1)])):F("",!0)]),_:2},1024)]),_:2},1024))),128))]),_:1})}}},He=B(Je,[["__scopeId","data-v-7625c744"]]),Ke={__name:"WaterUsageTable",props:{dateRange:{type:Array,default:[]}},setup(U){let i=ee(),k=Q(),C=ve(),m=U;const c=D(),e=V(()=>{var r;const v=((r=i==null?void 0:i.priceDetail)==null?void 0:r.areas)??[],g=m.dateRange;return v.map(d=>({date:`${O(g[0]).format("YYYY-MM-DD")}至${O(g[1]).format("YYYY-MM-DD")}`,area:C.getAreaNameById(d.area_id),waterType:k.getPriceRuleNameById(d.rule_id),price:+k.getPriceRulePriceById(d.rule_id),usage:+d.usage,fee:+d.price}))}),s=V(()=>e.value.length?[{row:0,col:0,rowspan:e.value.length,colspan:1}]:[]),_=()=>e.value.reduce((g,r)=>g+r.usage,0).toFixed(2),E=()=>e.value.reduce((g,r)=>g+r.fee,0).toFixed(2),x=D([{date:"合计",usage:V(()=>_()),fee:V(()=>E())}]),y=()=>{const v=c.value;v&&v.openExport({filename:"水费明细表",type:"xlsx",exportMethod:({options:g})=>v.exportData(Object.assign({},g,{original:!1,formatter:!0,footer:!0,columnFilterMethod:({column:r})=>r.property!=="seq"}))})};return(v,g)=>{const r=X,d=ae("vxe-column"),b=ae("vxe-table"),p=K;return u(),Y(p,null,{header:n(()=>[g[1]||(g[1]=l("div",{class:"title"},"水费明细表",-1)),o(r,{size:"small",type:"primary",icon:"download",onClick:y,class:"export-btn"},{default:n(()=>g[0]||(g[0]=[S(" 导出表格 ")])),_:1})]),default:n(()=>[o(b,{border:"","show-footer":"",ref_key:"tableRef",ref:c,"export-config":{type:"xlsx"},data:e.value,"merge-cells":s.value,"footer-data":x.value,height:"330","row-config":{height:50}},{default:n(()=>[o(d,{field:"date",title:"日期"}),o(d,{field:"area",title:"区域"}),o(d,{field:"waterType",title:"用水类型"}),o(d,{field:"price",title:"水单价"},{default:n(({row:R})=>[S(h(R.price.toFixed(2)),1)]),_:1}),o(d,{field:"usage",title:"用水量"},{default:n(({row:R})=>[S(h(R.usage.toFixed(2)),1)]),_:1}),o(d,{field:"fee",title:"水费"},{default:n(({row:R})=>[S(h(R.fee.toFixed(2)),1)]),_:1})]),_:1},8,["data","merge-cells","footer-data"])]),_:1})}}},Qe=B(Ke,[["__scopeId","data-v-f6ff6296"]]),Xe={key:0,class:"users-list"},Ze={class:"user-info"},et={class:"user-name"},tt={class:"ratio"},at={class:"ratio"},lt={class:"ratio"},ot={class:"total-info"},rt={key:0},st={key:1},nt={key:2},it={key:3,class:"error-text"},ut={class:"dialog-footer"},dt={__name:"UnknownWaterDialog",props:{modelValue:Boolean,currentMethod:{type:String,default:"water"}},emits:["update:modelValue","confirm"],setup(U,{emit:i}){const k=U,C=i,m=Z(),c=V({get:()=>k.modelValue,set:a=>C("update:modelValue",a)}),e=D({method:k.currentMethod,users:[]}),s=D(null),_=V(()=>{const a=e.value.users.map(t=>t.id);return m.energyUserList.filter(t=>!a.includes(t.id))}),E=V(()=>e.value.users.reduce((a,t)=>a+(t.area||0),0)),x=V(()=>e.value.users.reduce((a,t)=>a+(t.water||0),0)),y=V(()=>e.value.users.reduce((a,t)=>a+(t.persons||0),0)),v=V(()=>e.value.users.reduce((a,t)=>a+(t.ratio||0),0)),g=V(()=>{if(e.value.users.length===0)return!1;switch(e.value.method){case"area":return e.value.users.every(a=>a.area>0);case"water":return e.value.users.every(a=>a.water>0);case"person":return e.value.users.every(a=>a.persons>0);case"custom":return Math.abs(v.value-100)<.01;default:return!1}});function r(a){if(!a)return;const t=m.energyUserList.find(M=>M.id===a);t&&e.value.users.push({id:t.id,name:t.name,area:0,water:0,persons:0,ratio:0}),s.value=null}function d(){const a=e.value.users;if(a.length!==0)switch(e.value.method){case"area":E.value>0&&a.forEach(t=>{t.ratio=t.area/E.value*100});break;case"water":x.value>0&&a.forEach(t=>{t.ratio=t.water/x.value*100});break;case"person":y.value>0&&a.forEach(t=>{t.ratio=t.persons/y.value*100});break}}function b(a){if(e.value.method!=="custom")return;const t=e.value.users,M=t.reduce((I,T,N)=>N!==a?I+(T.ratio||0):I,0);M+t[a].ratio>100&&(t[a].ratio=100-M)}function p(a){e.value.users.splice(a,1),e.value.method!=="custom"&&d()}function R(){C("confirm",{method:e.value.method,users:e.value.users.map(a=>({id:a.id,name:a.name,ratio:a.ratio}))}),c.value=!1}function $(){e.value.users=[],c.value=!1}return(a,t)=>{const M=Me,I=Ye,T=Te,N=_e,ye=fe,W=Pe,ge=Le,j=X,he=Fe,be=Se;return u(),Y(be,{modelValue:c.value,"onUpdate:modelValue":t[2]||(t[2]=w=>c.value=w),title:"设置不明水分摊规则",width:"800px"},{footer:n(()=>[l("span",ut,[o(j,{onClick:$},{default:n(()=>t[8]||(t[8]=[S("取消")])),_:1}),o(j,{type:"primary",disabled:!g.value,onClick:R},{default:n(()=>t[9]||(t[9]=[S(" 确认 ")])),_:1},8,["disabled"])])]),default:n(()=>[o(he,{model:e.value,"label-width":"120px"},{default:n(()=>[o(T,{label:"分摊方式"},{default:n(()=>[o(I,{modelValue:e.value.method,"onUpdate:modelValue":t[0]||(t[0]=w=>e.value.method=w)},{default:n(()=>[o(M,{value:"water",label:"water"},{default:n(()=>t[3]||(t[3]=[S("用水量比例")])),_:1}),o(M,{value:"area",label:"area"},{default:n(()=>t[4]||(t[4]=[S("面积比例")])),_:1}),o(M,{value:"person",label:"person"},{default:n(()=>t[5]||(t[5]=[S("人数比例")])),_:1}),o(M,{value:"custom",label:"custom"},{default:n(()=>t[6]||(t[6]=[S("自定义比例")])),_:1})]),_:1},8,["modelValue"])]),_:1}),o(T,{label:"添加用能户"},{default:n(()=>[o(ye,{modelValue:s.value,"onUpdate:modelValue":t[1]||(t[1]=w=>s.value=w),filterable:"",clearable:"",placeholder:"请选择用能户",onChange:r},{default:n(()=>[(u(!0),f(P,null,A(_.value,w=>(u(),Y(N,{key:w.id,label:w.name,value:w.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e.value.users.length>0?(u(),f("div",Xe,[(u(!0),f(P,null,A(e.value.users,(w,te)=>(u(),f("div",{key:w.id,class:"user-item"},[l("div",Ze,[l("span",et,h(w.name),1),e.value.method==="area"?(u(),f(P,{key:0},[o(W,{modelValue:w.area,"onUpdate:modelValue":L=>w.area=L,min:0,precision:2,placeholder:"面积(m²)",onChange:d},null,8,["modelValue","onUpdate:modelValue"]),l("span",tt,h(w.ratio.toFixed(2))+"%",1)],64)):F("",!0),e.value.method==="water"?(u(),f(P,{key:1},[o(W,{modelValue:w.water,"onUpdate:modelValue":L=>w.water=L,min:0,precision:2,placeholder:"用水量(m³)",onChange:d},null,8,["modelValue","onUpdate:modelValue"]),l("span",at,h(w.ratio.toFixed(2))+"%",1)],64)):F("",!0),e.value.method==="person"?(u(),f(P,{key:2},[o(W,{modelValue:w.persons,"onUpdate:modelValue":L=>w.persons=L,min:0,precision:0,placeholder:"人数",onChange:d},null,8,["modelValue","onUpdate:modelValue"]),l("span",lt,h(w.ratio.toFixed(2))+"%",1)],64)):F("",!0),e.value.method==="custom"?(u(),Y(W,{key:3,modelValue:w.ratio,"onUpdate:modelValue":L=>w.ratio=L,min:0,max:100,precision:2,placeholder:"比例(%)",onChange:L=>b(te)},null,8,["modelValue","onUpdate:modelValue","onChange"])):F("",!0),o(j,{type:"danger",circle:"",size:"small",onClick:L=>p(te)},{default:n(()=>[o(ge,null,{default:n(()=>[o(G(Ve))]),_:1})]),_:2},1032,["onClick"])])]))),128)),l("div",ot,[t[7]||(t[7]=l("span",null,"总计:",-1)),e.value.method==="area"?(u(),f("span",rt,"面积: "+h(E.value)+"m² / ",1)):F("",!0),e.value.method==="water"?(u(),f("span",st,"用水量: "+h(x.value)+"m³ / ",1)):F("",!0),e.value.method==="person"?(u(),f("span",nt,"人数: "+h(y.value)+"人 / ",1)):F("",!0),l("span",null,"比例: "+h(v.value.toFixed(2))+"%",1),e.value.method==="custom"&&Math.abs(v.value-100)>.01?(u(),f("span",it," (请调整至100%)")):F("",!0)])])):F("",!0)]),_:1},8,["model"])]),_:1},8,["modelValue"])}}},ct=B(dt,[["__scopeId","data-v-cab23f98"]]),pt={class:"scrollbar-wrapper"},mt={class:"unknown-water-summary"},vt={class:"statistics-section"},_t={class:"summary-item"},ft={class:"value"},yt={class:"summary-item"},gt={class:"label"},ht={class:"value"},bt={class:"distribution-section"},wt={key:0,class:"distribution-list"},kt={class:"item-header"},Vt={class:"name"},xt={class:"ratio"},Ct={class:"item-details"},Ut={class:"detail-row"},Et={class:"value highlight"},$t={__name:"UnknownWaterAnalysisCard",props:{dateRange:{type:Array,default:()=>[]}},setup(U){let i=D(!1),k=U,C=De(),m=Z(),c=V(()=>C.meterLevels[0]),e=V(()=>C.meterLevels[1]),s=D(0),_=D(0),E=J();H(async()=>{k.dateRange.length&&E.currentCompany&&await x()});async function x(){try{i.value=!0;let b=await Promise.all(c.value.map(a=>oe({id:a.id,start_time:k.dateRange[0],end_time:k.dateRange[1],interval:"day"}))),p=await Promise.all(e.value.map(a=>oe({id:a.id,start_time:k.dateRange[0],end_time:k.dateRange[1],interval:"day"}))),R=re(b.map(a=>a.aggregated_data)).reduce((a,t)=>a+t.Value,0),$=re(p.map(a=>a.aggregated_data)).reduce((a,t)=>a+t.Value,0);_.value=R.toFixed(2),s.value=(R-$).toFixed(2)}catch(b){q(b,"获取不明水数据失败")}finally{i.value=!1}}const y=V(()=>({totalUsage:_.value,unknownUsage:s.value,distribution:m.energyUserList.filter(b=>+b.unknown_ratio).map(b=>({id:b.id,name:b.name,ratio:b.unknown_ratio*100,share:(b.unknown_ratio*s.value).toFixed(2)}))})),v=D(!1),g=D("water"),r=V(()=>(y.value.unknownUsage/y.value.totalUsage*100).toFixed(2)),d=async b=>{g.value=b.method;try{i.value=!0,await Promise.all(y.value.distribution.map(p=>se({id:p.id,unknown_ratio:"0"}))),await Promise.all(b.users.map(async p=>se({id:p.id,unknown_ratio:""+p.ratio/100}))),await m.fetchEnergyUsers(),Ae.success("设置分摊规则成功")}catch(p){q(p,"设置分摊规则失败")}finally{i.value=!1,v.value=!1}};return(b,p)=>{const R=X,$=me,a=$e,t=pe,M=K,I=ue;return u(),f(P,null,[ie((u(),Y(M,{class:"unknown-water-card"},{header:n(()=>[p[5]||(p[5]=l("span",null,"不明水分摊计算",-1)),o($,{content:"设置不明水分摊规则"},{default:n(()=>[o(R,{type:"primary",size:"small",onClick:p[0]||(p[0]=T=>v.value=!0)},{icon:n(()=>p[3]||(p[3]=[l("img",{src:Re,width:"12px",height:"auto",alt:""},null,-1)])),default:n(()=>[p[4]||(p[4]=S(" 设置分摊规则 "))]),_:1})]),_:1})]),default:n(()=>[l("div",pt,[l("div",mt,[l("div",vt,[l("div",_t,[p[6]||(p[6]=l("div",{class:"label"},"总用水量",-1)),l("div",ft,h(y.value.totalUsage)+"m³",1)]),l("div",yt,[l("div",gt,"不明水量 ("+h(r.value)+"%)",1),l("div",ht,h(y.value.unknownUsage)+"m³",1)])]),o(a),l("div",bt,[y.value.distribution.length?(u(),f("div",wt,[(u(!0),f(P,null,A(y.value.distribution,T=>(u(),f("div",{key:T.name,class:"distribution-item"},[l("div",kt,[l("span",Vt,h(T.name),1),l("span",xt,"占比: "+h(T.ratio)+"%",1)]),l("div",Ct,[l("div",Ut,[p[7]||(p[7]=l("span",{class:"label"},"分摊水量:",-1)),l("span",Et,h(T.share)+"m³",1)])])]))),128))])):(u(),Y(t,{key:1,description:"未设置分摊规则","image-size":100},{default:n(()=>[o(R,{type:"primary",onClick:p[1]||(p[1]=T=>v.value=!0)},{default:n(()=>p[8]||(p[8]=[S(" 设置规则 ")])),_:1})]),_:1}))])])])]),_:1})),[[I,G(i)]]),o(ct,{modelValue:v.value,"onUpdate:modelValue":p[2]||(p[2]=T=>v.value=T),"current-method":g.value,onConfirm:d},null,8,["modelValue","current-method"])],64)}}},Rt=B($t,[["__scopeId","data-v-99cddca6"]]),Dt={class:"filter-container"},St={__name:"WaterFilter",props:{modelValue:{type:Object,default:()=>({type:"overview",subType:""})}},emits:["update:modelValue","change"],setup(U,{emit:i}){let k=Z(),C=J(),m=ve();const c=U,e=i,s=D({type:c.modelValue.type,subType:c.modelValue.subType}),_=[{value:"overview",label:"总览"},{value:"byEnergyUser",label:"按用能户浏览"},{value:"byArea",label:"按区域浏览"}],E=D({byArea:V(()=>m.areas.map(d=>({value:d.id,label:d.name}))),byEnergyUser:V(()=>k.energyUserList.map(d=>({value:d.id,label:d.name})))}),x=V(()=>E.value[s.value.type]),y=V(()=>({byArea:"请选择区域",byType:"请选择用水类型",byEnergyUser:"请选择用能户"})[s.value.type]||"请选择"),v=()=>{s.value.subType="",r()},g=()=>{r()},r=()=>{e("update:modelValue",{...s.value}),e("change",{...s.value})};return xe(()=>c.modelValue,d=>{s.value={...d}},{deep:!0}),H(async()=>{await k.fetchEnergyUsers({company_id:C.currentCompany.id})}),(d,b)=>{const p=_e,R=fe;return u(),f("div",Dt,[o(R,{modelValue:s.value.type,"onUpdate:modelValue":b[0]||(b[0]=$=>s.value.type=$),class:"filter-item",placeholder:"请选择浏览方式",onChange:v},{default:n(()=>[(u(),f(P,null,A(_,$=>o(p,{key:$.value,label:$.label,value:$.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"]),s.value.type!=="overview"?(u(),Y(R,{key:0,modelValue:s.value.subType,"onUpdate:modelValue":b[1]||(b[1]=$=>s.value.subType=$),class:"filter-item",placeholder:y.value,onChange:g},{default:n(()=>[(u(!0),f(P,null,A(x.value,$=>(u(),Y(p,{key:$.value,label:$.label,value:$.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])):F("",!0)])}}},Tt=B(St,[["__scopeId","data-v-02ad00fe"]]),Ft={class:"app-container"},Pt={class:"header page-title"},Mt={class:"header-left"},Yt={style:{width:"100%"}},Lt={__name:"index",setup(U){let i=ee(),k=Q(),C=J();const m=D(!1),c=D([O().startOf("month").valueOf(),O().endOf("month").valueOf()]);let e=D({type:"overview",subType:null});return H(async()=>{try{let s={key:"company_id",value:C.currentCompany.id};switch(e.value.type){case"overview":s.key="company_id",s.value=C.currentCompany.id;break;case"byEnergyUser":if(e.value.subType)s.key="energy_user_id",s.value=e.value.subType;else return;break;case"byArea":if(e.value.subType)s.key="area_id",s.value=e.value.subType;else return;break;default:return}m.value=!0,await Promise.all([i.getPriceDetail({[s.key]:s.value,start_time:c.value[0],end_time:c.value[1]}),i.getLastPriceDetail({[s.key]:s.value,start_time:O(c.value[0]).subtract(1,"year").valueOf(),end_time:O(c.value[1]).subtract(1,"year").valueOf()}),k.fetchPriceRuleList({company_id:C.currentCompany.id})])}catch(s){q(s,"获取价格数据失败")}finally{m.value=!1}}),(s,_)=>{const E=pe,x=de,y=ce,v=Ue,g=ue;return ie((u(),f("div",Ft,[l("div",Pt,[l("div",Mt,[_[2]||(_[2]=S(" 用水费用概览 ")),o(Tt,{modelValue:G(e),"onUpdate:modelValue":_[0]||(_[0]=r=>Ce(e)?e.value=r:e=r)},null,8,["modelValue"])]),o(Ie,{modelValue:c.value,"onUpdate:modelValue":_[1]||(_[1]=r=>c.value=r)},null,8,["modelValue"])]),o(v,{class:"main-container"},{default:n(()=>[l("div",Yt,[(u(),f(P,{key:1},[o(He,{class:"mb-16"}),o(y,{gutter:20,class:"mb-4"},{default:n(()=>[o(x,{span:16,style:{display:"flex","flex-direction":"column"}},{default:n(()=>[o(Qe,{dateRange:c.value},null,8,["dateRange"])]),_:1}),o(x,{span:8},{default:n(()=>[o(Rt,{dateRange:c.value},null,8,["dateRange"])]),_:1})]),_:1})],64))])]),_:1})])),[[g,m.value]])}}},Oa=B(Lt,[["__scopeId","data-v-ade21d0c"]]);export{Oa as default};
