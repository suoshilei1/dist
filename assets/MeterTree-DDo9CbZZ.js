import{z as G,at as Q,D as j,au as X,E as Z,r as h,F as b,H as $,c as g,J as E,l as s,e as r,N as T,I as i,n as ee,K as te,h as w,f as D,g as M,M as R,k as p,aq as oe,O as ne,_ as re,q as V,i as A,d as I,Y as se,W as le,w as ae,ai as ie,v as ce}from"./index-DWtISIBF.js";import{E as pe}from"./dialog-DnmK2X7S.js";import"./overlay-BY0G5ok6.js";import{_ as fe}from"./MeterDialog-DLFqLZEh.js";import{E as de}from"./tree-CfWa2fVO.js";import"./checkbox-BzIrpOFw.js";import{u as z,E as F}from"./popper-BNb2tGl7.js";import{b as L,E as q}from"./button-DfREtLL_.js";/* empty css                */import{u as U,k as O}from"./meter-BWYCtTLu.js";/* empty css             *//* empty css                 */import{E as ue}from"./index-CuP5NVML.js";import{i as me}from"./icon-Cc3ZZocH.js";import{_ as _e}from"./plugin-vue_export-helper-CqGSI99y.js";import{E as B}from"./index-CZh1RU_w.js";const ye=G({title:String,confirmButtonText:String,cancelButtonText:String,confirmButtonType:{type:String,values:L,default:"primary"},cancelButtonType:{type:String,values:L,default:"text"},icon:{type:me,default:()=>Q},iconColor:{type:String,default:"#f90"},hideIcon:{type:Boolean,default:!1},hideAfter:{type:Number,default:200},teleported:z.teleported,persistent:z.persistent,width:{type:[String,Number],default:150}}),ve={confirm:u=>u instanceof MouseEvent,cancel:u=>u instanceof MouseEvent},he=j({name:"ElPopconfirm"}),ge=j({...he,props:ye,emits:ve,setup(u,{emit:o}){const f=u,{t}=X(),d=Z("popconfirm"),k=h(),c=()=>{var e,l;(l=(e=k.value)==null?void 0:e.onClose)==null||l.call(e)},m=b(()=>({width:$(f.width)})),_=e=>{o("confirm",e),c()},y=e=>{o("cancel",e),c()},v=b(()=>f.confirmButtonText||t("el.popconfirm.confirmButtonText")),C=b(()=>f.cancelButtonText||t("el.popconfirm.cancelButtonText"));return(e,l)=>(g(),E(i(F),oe({ref_key:"tooltipRef",ref:k,trigger:"click",effect:"light"},e.$attrs,{"popper-class":`${i(d).namespace.value}-popover`,"popper-style":i(m),teleported:e.teleported,"fallback-placements":["bottom","top","right","left"],"hide-after":e.hideAfter,persistent:e.persistent}),{content:s(()=>[r("div",{class:T(i(d).b())},[r("div",{class:T(i(d).e("main"))},[!e.hideIcon&&e.icon?(g(),E(i(ue),{key:0,class:T(i(d).e("icon")),style:ee({color:e.iconColor})},{default:s(()=>[(g(),E(te(e.icon)))]),_:1},8,["class","style"])):w("v-if",!0),D(" "+M(e.title),1)],2),r("div",{class:T(i(d).e("action"))},[R(e.$slots,"actions",{confirm:_,cancel:y},()=>[p(i(q),{size:"small",type:e.cancelButtonType==="text"?"":e.cancelButtonType,text:e.cancelButtonType==="text",onClick:y},{default:s(()=>[D(M(i(C)),1)]),_:1},8,["type","text"]),p(i(q),{size:"small",type:e.confirmButtonType==="text"?"":e.confirmButtonType,text:e.confirmButtonType==="text",onClick:_},{default:s(()=>[D(M(i(v)),1)]),_:1},8,["type","text"])])],2)],2)]),default:s(()=>[e.$slots.reference?R(e.$slots,"reference",{key:0}):w("v-if",!0)]),_:3},16,["popper-class","popper-style","teleported","hide-after","persistent"]))}});var Ce=_e(ge,[["__file","popconfirm.vue"]]);const ke=ne(Ce),be={__name:"MeterTree",props:{data:{type:Array,default:()=>[]}},setup(u,{expose:o}){o();let f=V();const t=f.hasPermission("manage_device"),d=A(),k=b(()=>d.name==="DeviceInfo");let c=u;const m=h(!1),_=h(!1),y=h(null),v=h(null),C=h(null),e={id:"id",children:"children",label:"label"};let l=U();function P(n){v.value=n,y.value=null,_.value=!0}function H(){v.value={id:0,label:"根节点",type:0},y.value=null,_.value=!0}function J(n){n&&l.setCurrentMeter(n)}function K(n,a){if(a&&a.id){let S=[a.id];x(S)}}const W=()=>{var S;const a=(((S=C.value)==null?void 0:S.getCheckedNodes(!1,!1))||[]).map(Y=>Y.id).filter(Boolean);a.length>0&&x(a)};function x(n){!Array.isArray(n)||n.length===0||O(n).then(a=>{a.code===200?(B.success("删除成功"),l.fetchMeterList()):(console.error(a.message),B.error(a.message||"删除失败"))}).catch(a=>{console.error(a),B.error("删除失败")})}const N={get permisstionStore(){return f},set permisstionStore(n){f=n},isEdit:t,route:d,isDeviceInfoRoute:k,get props(){return c},set props(n){c=n},loading:m,dialogVisible:_,currentMeter:y,parent_meter:v,treeRef:C,defaultProps:e,get meterStore(){return l},set meterStore(n){l=n},append:P,addRootMeter:H,handleClick:J,remove:K,removeMeters:W,deletePost:x,refresh:async()=>{m.value=!0;try{await l.fetchMeterList()}catch(n){console.error("刷新失败:",n),B.error("刷新失败")}finally{m.value=!1}},get deleteMeterApi(){return O},get useCompanyStore(){return le},get useMeterStore(){return U},ref:h,watch:ae,nextTick:ie,computed:b,get useRoute(){return A},get usePermissionStore(){return V}};return Object.defineProperty(N,"__isScriptSetup",{enumerable:!1,value:!0}),N}},Me={class:"tree-wrapper"},Se={class:"tree-container"},Te={class:"header"},Be={class:"company-name"},Ee={key:0,class:"header-actions"},we={class:"custom-tree-node"},Pe={class:"node-label"},xe={key:0,class:"node-actions"},De=["onClick"];function Ie(u,o,f,t,d,k){const c=F,m=ke,_=de,y=fe,v=pe,C=ce;return g(),I("div",Me,[r("div",Se,[r("div",Te,[p(c,{content:t.useCompanyStore().currentCompany.name,placement:"top","show-after":500},{default:s(()=>[r("span",Be,M(t.useCompanyStore().currentCompany.name),1)]),_:1},8,["content"]),t.isDeviceInfoRoute&&t.isEdit?(g(),I("div",Ee,[r("a",{type:"primary",onClick:t.addRootMeter},[p(c,{content:"新增一级表计",placement:"top","show-after":500},{default:s(()=>o[2]||(o[2]=[r("i",{class:"fa fa-plus"},null,-1)])),_:1})]),p(m,{placement:"top",title:"确定删除勾选的表计吗？",onConfirm:t.removeMeters},{reference:s(()=>[r("a",null,[p(c,{content:"删除勾选的表计",placement:"top","show-after":500},{default:s(()=>o[3]||(o[3]=[r("i",{class:"fa fa-minus"},null,-1)])),_:1})])]),_:1}),r("a",{type:"primary",onClick:t.refresh},[p(c,{content:"刷新表计列表",placement:"top","show-after":500},{default:s(()=>o[4]||(o[4]=[r("i",{class:"fa fa-refresh"},null,-1)])),_:1})])])):w("",!0)]),se((g(),E(_,{onNodeClick:t.handleClick,style:{display:"inline-block",width:"100%"},"element-loading-text":"loading...","show-checkbox":t.isDeviceInfoRoute&&t.isEdit,ref:"treeRef",indent:10,class:"eye-tree",data:f.data,props:t.defaultProps,"node-key":"id","highlight-current":!0,"default-expand-all":!0,"expand-on-click-node":!1},{default:s(({node:e,data:l})=>[r("div",we,[p(c,{content:e.label,placement:"top","show-after":500},{default:s(()=>[r("span",Pe,M(e.label),1)]),_:2},1032,["content"]),t.isDeviceInfoRoute&&t.isEdit?(g(),I("span",xe,[r("a",{onClick:P=>t.append(l)},o[5]||(o[5]=[r("i",{class:"fa fa-plus"},null,-1)]),8,De),p(m,{placement:"top",title:`确定删除${e.label}表计吗？`,onConfirm:P=>t.remove(e,l)},{reference:s(()=>o[6]||(o[6]=[r("a",null,[r("i",{class:"fa fa-minus"})],-1)])),_:2},1032,["title","onConfirm"])])):w("",!0)])]),_:1},8,["show-checkbox","data"])),[[C,t.loading]]),p(v,{title:t.currentMeter?"编辑表计":"新增表计","destroy-on-close":"","align-center":"",modelValue:t.dialogVisible,"onUpdate:modelValue":o[1]||(o[1]=e=>t.dialogVisible=e)},{default:s(()=>[p(y,{"onUpdate:visible":o[0]||(o[0]=e=>t.dialogVisible=!1),pMeter:t.parent_meter,id:t.currentMeter?+t.currentMeter.meter_id:null},null,8,["pMeter","id"])]),_:1},8,["title","modelValue"])])])}const Qe=re(be,[["render",Ie],["__scopeId","data-v-47879ef3"],["__file","D:/临时存放/green-carbon-1.0/src/components/meter/MeterTree.vue"]]);export{Qe as M};
