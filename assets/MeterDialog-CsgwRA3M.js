import{D as me,E as pe,aq as Pt,at as ot,au as rt,av as Ft,aw as it,F as $,m as Y,c as _,d as U,h as Q,J as z,k as ge,j as h,e as ee,i as g,N as B,T as re,ap as ut,r as M,U as ie,f as se,g as ue,M as Ve,ax as xt,ay as xe,az as We,aA as At,ar as je,z as dt,C as de,aB as Bt,aC as zt,a as Ze,w as oe,aD as Ut,o as Be,ab as ce,aE as ct,O as pt,a6 as qt,aF as Ot,a7 as Ht,aG as Kt,aH as Rt,aI as Wt,X as he,I as p,n as jt,aJ as Zt,aK as Gt,ai as Jt,aL as Xt,ah as Yt,a1 as Ge,_ as Qt,V as Je,v as ea}from"./index-oALI6hjD.js";import{b as ta,E as aa,a as la}from"./form-item-JkdAUXjO.js";import{E as na}from"./button-CW4VZptJ.js";import{E as ft}from"./input-_j8YarB1.js";import{a as sa,u as oa,E as Xe}from"./popper-8tqvLSZz.js";/* empty css            */import{E as ra}from"./checkbox-eAiA7KBF.js";/* empty css              */import{E as mt,d as ia}from"./scrollbar-BwLVa3O8.js";import{u as Ye,c as Qe,E as ua}from"./date-picker-DSsGajNu.js";import{E as vt,a as da}from"./radio-group-C10qSAbV.js";import{c as et,E as ca,a as pa}from"./select-B0JZ5Vmm.js";import{u as fa,e as ma,o as va,l as ha}from"./meter-GWsXRyue.js";import{u as ga}from"./area-DGez3_R7.js";import{g as ba}from"./formula-CvS6Q7AW.js";import{h as tt}from"./handleError-BVJ6YTlw.js";import{g as Ce}from"./constant-C7HzJNwk.js";/* empty css             *//* empty css                 */import{E as Ne}from"./index-CV7ElbEQ.js";import{c as ya,U as Se,C as we,d as _a,b as ka,e as Ca}from"./index-Ci2yyUHC.js";import{E as be}from"./index-DXOgsKzf.js";import{_ as $e}from"./plugin-vue_export-helper-CqGSI99y.js";import{u as Na,c as Ea,a as Va}from"./use-form-item-CJ5jT23N.js";import{i as ye}from"./isEqual-DERyOhzh.js";import{i as Sa,f as Ee,g as ht}from"./focus-trap-B9jhWFgs.js";import{s as wa}from"./scroll-BUhzRsoy.js";import{E as Z}from"./aria-BUADUvnR.js";import{t as at,E as lt}from"./index-ClN0XSgQ.js";import{u as $a}from"./index-BTnVmvBQ.js";import{C as Ta}from"./index-CPa7yTdP.js";var Ma=1,La=4;function gt(e){return ta(e,Ma|La)}var Ia=1/0;function Da(e){var l=e==null?0:e.length;return l?ya(e,Ia):[]}var Pa=me({name:"NodeContent",setup(){return{ns:pe("cascader-node")}},render(){const{ns:e}=this,{node:l,panel:a}=this.$parent,{data:n,label:s}=l,{renderLabelFn:v}=a;return Pt("span",{class:e.e("label")},v?v({node:l,data:n}):s)}});const ze=Symbol(),Fa=me({name:"ElCascaderNode",components:{ElCheckbox:ra,ElRadio:vt,NodeContent:Pa,ElIcon:be,Check:ot,Loading:rt,ArrowRight:Ft},props:{node:{type:Object,required:!0},menuId:String},emits:["expand"],setup(e,{emit:l}){const a=it(ze),n=pe("cascader-node"),s=$(()=>a.isHoverMenu),v=$(()=>a.config.multiple),c=$(()=>a.config.checkStrictly),k=$(()=>{var T;return(T=a.checkedNodes[0])==null?void 0:T.uid}),f=$(()=>e.node.isDisabled),V=$(()=>e.node.isLeaf),N=$(()=>c.value&&!V.value||!f.value),o=$(()=>te(a.expandingNode)),A=$(()=>c.value&&a.checkedNodes.some(te)),te=T=>{var F;const{level:b,uid:r}=e.node;return((F=T==null?void 0:T.pathNodes[b-1])==null?void 0:F.uid)===r},j=()=>{o.value||a.expandNode(e.node)},R=T=>{const{node:F}=e;T!==F.checked&&a.handleCheckChange(F,T)},H=()=>{a.lazyLoad(e.node,()=>{V.value||j()})},q=T=>{s.value&&(G(),!V.value&&l("expand",T))},G=()=>{const{node:T}=e;!N.value||T.loading||(T.loaded?j():H())},x=()=>{s.value&&!V.value||(V.value&&!f.value&&!c.value&&!v.value?P(!0):G())},J=T=>{c.value?(R(T),e.node.loaded&&j()):P(T)},P=T=>{e.node.loaded?(R(T),!c.value&&j()):H()};return{panel:a,isHoverMenu:s,multiple:v,checkStrictly:c,checkedNodeId:k,isDisabled:f,isLeaf:V,expandable:N,inExpandingPath:o,inCheckedPath:A,ns:n,handleHoverExpand:q,handleExpand:G,handleClick:x,handleCheck:P,handleSelectCheck:J}}});function xa(e,l,a,n,s,v){const c=Y("el-checkbox"),k=Y("el-radio"),f=Y("check"),V=Y("el-icon"),N=Y("node-content"),o=Y("loading"),A=Y("arrow-right");return _(),U("li",{id:`${e.menuId}-${e.node.uid}`,role:"menuitem","aria-haspopup":!e.isLeaf,"aria-owns":e.isLeaf?null:e.menuId,"aria-expanded":e.inExpandingPath,tabindex:e.expandable?-1:void 0,class:B([e.ns.b(),e.ns.is("selectable",e.checkStrictly),e.ns.is("active",e.node.checked),e.ns.is("disabled",!e.expandable),e.inExpandingPath&&"in-active-path",e.inCheckedPath&&"in-checked-path"]),onMouseenter:e.handleHoverExpand,onFocus:e.handleHoverExpand,onClick:e.handleClick},[Q(" prefix "),e.multiple?(_(),z(c,{key:0,"model-value":e.node.checked,indeterminate:e.node.indeterminate,disabled:e.isDisabled,onClick:ge(()=>{},["stop"]),"onUpdate:modelValue":e.handleSelectCheck},null,8,["model-value","indeterminate","disabled","onClick","onUpdate:modelValue"])):e.checkStrictly?(_(),z(k,{key:1,"model-value":e.checkedNodeId,label:e.node.uid,disabled:e.isDisabled,"onUpdate:modelValue":e.handleSelectCheck,onClick:ge(()=>{},["stop"])},{default:h(()=>[Q(`
        Add an empty element to avoid render label,
        do not use empty fragment here for https://github.com/vuejs/vue-next/pull/2485
      `),ee("span")]),_:1},8,["model-value","label","disabled","onUpdate:modelValue","onClick"])):e.isLeaf&&e.node.checked?(_(),z(V,{key:2,class:B(e.ns.e("prefix"))},{default:h(()=>[g(f)]),_:1},8,["class"])):Q("v-if",!0),Q(" content "),g(N),Q(" postfix "),e.isLeaf?Q("v-if",!0):(_(),U(re,{key:3},[e.node.loading?(_(),z(V,{key:0,class:B([e.ns.is("loading"),e.ns.e("postfix")])},{default:h(()=>[g(o)]),_:1},8,["class"])):(_(),z(V,{key:1,class:B(["arrow-right",e.ns.e("postfix")])},{default:h(()=>[g(A)]),_:1},8,["class"]))],64))],42,["id","aria-haspopup","aria-owns","aria-expanded","tabindex","onMouseenter","onFocus","onClick"])}var Aa=$e(Fa,[["render",xa],["__file","node.vue"]]);const Ba=me({name:"ElCascaderMenu",components:{Loading:rt,ElIcon:be,ElScrollbar:mt,ElCascaderNode:Aa},props:{nodes:{type:Array,required:!0},index:{type:Number,required:!0}},setup(e){const l=xt(),a=pe("cascader-menu"),{t:n}=ut(),s=Na();let v=null,c=null;const k=it(ze),f=M(null),V=$(()=>!e.nodes.length),N=$(()=>!k.initialLoaded),o=$(()=>`${s.value}-${e.index}`),A=H=>{v=H.target},te=H=>{if(!(!k.isHoverMenu||!v||!f.value))if(v.contains(H.target)){j();const q=l.vnode.el,{left:G}=q.getBoundingClientRect(),{offsetWidth:x,offsetHeight:J}=q,P=H.clientX-G,T=v.offsetTop,F=T+v.offsetHeight;f.value.innerHTML=`
          <path style="pointer-events: auto;" fill="transparent" d="M${P} ${T} L${x} 0 V${T} Z" />
          <path style="pointer-events: auto;" fill="transparent" d="M${P} ${F} L${x} ${J} V${F} Z" />
        `}else c||(c=window.setTimeout(R,k.config.hoverThreshold))},j=()=>{c&&(clearTimeout(c),c=null)},R=()=>{f.value&&(f.value.innerHTML="",j())};return{ns:a,panel:k,hoverZone:f,isEmpty:V,isLoading:N,menuId:o,t:n,handleExpand:A,handleMouseMove:te,clearHoverZone:R}}});function za(e,l,a,n,s,v){const c=Y("el-cascader-node"),k=Y("loading"),f=Y("el-icon"),V=Y("el-scrollbar");return _(),z(V,{key:e.menuId,tag:"ul",role:"menu",class:B(e.ns.b()),"wrap-class":e.ns.e("wrap"),"view-class":[e.ns.e("list"),e.ns.is("empty",e.isEmpty)],onMousemove:e.handleMouseMove,onMouseleave:e.clearHoverZone},{default:h(()=>{var N;return[(_(!0),U(re,null,ie(e.nodes,o=>(_(),z(c,{key:o.uid,node:o,"menu-id":e.menuId,onExpand:e.handleExpand},null,8,["node","menu-id","onExpand"]))),128)),e.isLoading?(_(),U("div",{key:0,class:B(e.ns.e("empty-text"))},[g(f,{size:"14",class:B(e.ns.is("loading"))},{default:h(()=>[g(k)]),_:1},8,["class"]),se(" "+ue(e.t("el.cascader.loading")),1)],2)):e.isEmpty?(_(),U("div",{key:1,class:B(e.ns.e("empty-text"))},[Ve(e.$slots,"empty",{},()=>[se(ue(e.t("el.cascader.noData")),1)])],2)):(N=e.panel)!=null&&N.isHoverMenu?(_(),U("svg",{key:2,ref:"hoverZone",class:B(e.ns.e("hover-zone"))},null,2)):Q("v-if",!0)]}),_:3},8,["class","wrap-class","view-class","onMousemove","onMouseleave"])}var Ua=$e(Ba,[["render",za],["__file","menu.vue"]]);let qa=0;const Oa=e=>{const l=[e];let{parent:a}=e;for(;a;)l.unshift(a),a=a.parent;return l};class fe{constructor(l,a,n,s=!1){this.data=l,this.config=a,this.parent=n,this.root=s,this.uid=qa++,this.checked=!1,this.indeterminate=!1,this.loading=!1;const{value:v,label:c,children:k}=a,f=l[k],V=Oa(this);this.level=s?0:n?n.level+1:1,this.value=l[v],this.label=l[c],this.pathNodes=V,this.pathValues=V.map(N=>N.value),this.pathLabels=V.map(N=>N.label),this.childrenData=f,this.children=(f||[]).map(N=>new fe(N,a,this)),this.loaded=!a.lazy||this.isLeaf||!xe(f)}get isDisabled(){const{data:l,parent:a,config:n}=this,{disabled:s,checkStrictly:v}=n;return(We(s)?s(l,this):!!l[s])||!v&&(a==null?void 0:a.isDisabled)}get isLeaf(){const{data:l,config:a,childrenData:n,loaded:s}=this,{lazy:v,leaf:c}=a,k=We(c)?c(l,this):l[c];return At(k)?v&&!s?!1:!(je(n)&&n.length):!!k}get valueByOption(){return this.config.emitPath?this.pathValues:this.value}appendChild(l){const{childrenData:a,children:n}=this,s=new fe(l,this.config,this);return je(a)?a.push(l):this.childrenData=[l],n.push(s),s}calcText(l,a){const n=l?this.pathLabels.join(a):this.label;return this.text=n,n}broadcast(l,...a){const n=`onParent${et(l)}`;this.children.forEach(s=>{s&&(s.broadcast(l,...a),s[n]&&s[n](...a))})}emit(l,...a){const{parent:n}=this,s=`onChild${et(l)}`;n&&(n[s]&&n[s](...a),n.emit(l,...a))}onParentCheck(l){this.isDisabled||this.setCheckState(l)}onChildCheck(){const{children:l}=this,a=l.filter(s=>!s.isDisabled),n=a.length?a.every(s=>s.checked):!1;this.setCheckState(n)}setCheckState(l){const a=this.children.length,n=this.children.reduce((s,v)=>{const c=v.checked?1:v.indeterminate?.5:0;return s+c},0);this.checked=this.loaded&&this.children.filter(s=>!s.isDisabled).every(s=>s.loaded&&s.checked)&&l,this.indeterminate=this.loaded&&n!==a&&n>0}doCheck(l){if(this.checked===l)return;const{checkStrictly:a,multiple:n}=this.config;a||!n?this.checked=l:(this.broadcast("check",l),this.setCheckState(l),this.emit("check"))}}const Ae=(e,l)=>e.reduce((a,n)=>(n.isLeaf?a.push(n):(!l&&a.push(n),a=a.concat(Ae(n.children,l))),a),[]);class nt{constructor(l,a){this.config=a;const n=(l||[]).map(s=>new fe(s,this.config));this.nodes=n,this.allNodes=Ae(n,!1),this.leafNodes=Ae(n,!0)}getNodes(){return this.nodes}getFlattedNodes(l){return l?this.leafNodes:this.allNodes}appendNode(l,a){const n=a?a.appendChild(l):new fe(l,this.config);a||this.nodes.push(n),this.allNodes.push(n),n.isLeaf&&this.leafNodes.push(n)}appendNodes(l,a){l.forEach(n=>this.appendNode(n,a))}getNodeByValue(l,a=!1){return!l&&l!==0?null:this.getFlattedNodes(a).find(s=>ye(s.value,l)||ye(s.pathValues,l))||null}getSameNode(l){return l&&this.getFlattedNodes(!1).find(({value:n,level:s})=>ye(l.value,n)&&l.level===s)||null}}const bt=dt({modelValue:{type:de([Number,String,Array])},options:{type:de(Array),default:()=>[]},props:{type:de(Object),default:()=>({})}}),Ha={expandTrigger:"click",multiple:!1,checkStrictly:!1,emitPath:!0,lazy:!1,lazyLoad:Bt,value:"value",label:"label",children:"children",leaf:"leaf",disabled:"disabled",hoverThreshold:500},Ka=e=>$(()=>({...Ha,...e.props})),st=e=>{if(!e)return 0;const l=e.id.split("-");return Number(l[l.length-2])},Ra=e=>{if(!e)return;const l=e.querySelector("input");l?l.click():Sa(e)&&e.click()},Wa=(e,l)=>{const a=l.slice(0),n=a.map(v=>v.uid),s=e.reduce((v,c)=>{const k=n.indexOf(c.uid);return k>-1&&(v.push(c),a.splice(k,1),n.splice(k,1)),v},[]);return s.push(...a),s},ja=me({name:"ElCascaderPanel",components:{ElCascaderMenu:Ua},props:{...bt,border:{type:Boolean,default:!0},renderLabel:Function},emits:[Se,we,"close","expand-change"],setup(e,{emit:l,slots:a}){let n=!1;const s=pe("cascader"),v=Ka(e);let c=null;const k=M(!0),f=M([]),V=M(null),N=M([]),o=M(null),A=M([]),te=$(()=>v.value.expandTrigger==="hover"),j=$(()=>e.renderLabel||a.default),R=()=>{const{options:i}=e,y=v.value;n=!1,c=new nt(i,y),N.value=[c.getNodes()],y.lazy&&xe(e.options)?(k.value=!1,H(void 0,E=>{E&&(c=new nt(E,y),N.value=[c.getNodes()]),k.value=!0,b(!1,!0)})):b(!1,!0)},H=(i,y)=>{const E=v.value;i=i||new fe({},E,void 0,!0),i.loading=!0;const w=L=>{const I=i,K=I.root?null:I;L&&(c==null||c.appendNodes(L,K)),I.loading=!1,I.loaded=!0,I.childrenData=I.childrenData||[],y&&y(L)};E.lazyLoad(i,w)},q=(i,y)=>{var E;const{level:w}=i,L=N.value.slice(0,w);let I;i.isLeaf?I=i.pathNodes[w-2]:(I=i,L.push(i.children)),((E=o.value)==null?void 0:E.uid)!==(I==null?void 0:I.uid)&&(o.value=i,N.value=L,!y&&l("expand-change",(i==null?void 0:i.pathValues)||[]))},G=(i,y,E=!0)=>{const{checkStrictly:w,multiple:L}=v.value,I=A.value[0];n=!0,!L&&(I==null||I.doCheck(!1)),i.doCheck(y),F(),E&&!L&&!w&&l("close"),!E&&!L&&!w&&x(i)},x=i=>{i&&(i=i.parent,x(i),i&&q(i))},J=i=>c==null?void 0:c.getFlattedNodes(i),P=i=>{var y;return(y=J(i))==null?void 0:y.filter(E=>E.checked!==!1)},T=()=>{A.value.forEach(i=>i.doCheck(!1)),F(),N.value=N.value.slice(0,1),o.value=null,l("expand-change",[])},F=()=>{var i;const{checkStrictly:y,multiple:E}=v.value,w=A.value,L=P(!y),I=Wa(w,L),K=I.map(O=>O.valueByOption);A.value=I,V.value=E?K:(i=K[0])!=null?i:null},b=(i=!1,y=!1)=>{const{modelValue:E}=e,{lazy:w,multiple:L,checkStrictly:I}=v.value,K=!I;if(!(!k.value||n||!y&&ye(E,V.value)))if(w&&!i){const W=Ye(Da(Qe(E))).map(m=>c==null?void 0:c.getNodeByValue(m)).filter(m=>!!m&&!m.loaded&&!m.loading);W.length?W.forEach(m=>{H(m,()=>b(!1,y))}):b(!0,y)}else{const O=L?Qe(E):[E],W=Ye(O.map(m=>c==null?void 0:c.getNodeByValue(m,K)));r(W,y),V.value=gt(E)}},r=(i,y=!0)=>{const{checkStrictly:E}=v.value,w=A.value,L=i.filter(O=>!!O&&(E||O.isLeaf)),I=c==null?void 0:c.getSameNode(o.value),K=y&&I||L[0];K?K.pathNodes.forEach(O=>q(O,!0)):o.value=null,w.forEach(O=>O.doCheck(!1)),Ze(L).forEach(O=>O.doCheck(!0)),A.value=L,ce(S)},S=()=>{ct&&f.value.forEach(i=>{const y=i==null?void 0:i.$el;if(y){const E=y.querySelector(`.${s.namespace.value}-scrollbar__wrap`),w=y.querySelector(`.${s.b("node")}.${s.is("active")}`)||y.querySelector(`.${s.b("node")}.in-active-path`);wa(E,w)}})},C=i=>{const y=i.target,{code:E}=i;switch(E){case Z.up:case Z.down:{i.preventDefault();const w=E===Z.up?-1:1;Ee(ht(y,w,`.${s.b("node")}[tabindex="-1"]`));break}case Z.left:{i.preventDefault();const w=f.value[st(y)-1],L=w==null?void 0:w.$el.querySelector(`.${s.b("node")}[aria-expanded="true"]`);Ee(L);break}case Z.right:{i.preventDefault();const w=f.value[st(y)+1],L=w==null?void 0:w.$el.querySelector(`.${s.b("node")}[tabindex="-1"]`);Ee(L);break}case Z.enter:Ra(y);break}};return zt(ze,Ze({config:v,expandingNode:o,checkedNodes:A,isHoverMenu:te,initialLoaded:k,renderLabelFn:j,lazyLoad:H,expandNode:q,handleCheckChange:G})),oe([v,()=>e.options],R,{deep:!0,immediate:!0}),oe(()=>e.modelValue,()=>{n=!1,b()},{deep:!0}),oe(()=>V.value,i=>{ye(i,e.modelValue)||(l(Se,i),l(we,i))}),Ut(()=>f.value=[]),Be(()=>!xe(e.modelValue)&&b()),{ns:s,menuList:f,menus:N,checkedNodes:A,handleKeyDown:C,handleCheckChange:G,getFlattedNodes:J,getCheckedNodes:P,clearCheckedNodes:T,calculateCheckedValue:F,scrollToExpandingNode:S}}});function Za(e,l,a,n,s,v){const c=Y("el-cascader-menu");return _(),U("div",{class:B([e.ns.b("panel"),e.ns.is("bordered",e.border)]),onKeydown:e.handleKeyDown},[(_(!0),U(re,null,ie(e.menus,(k,f)=>(_(),z(c,{key:f,ref_for:!0,ref:V=>e.menuList[f]=V,index:f,nodes:[...k]},{empty:h(()=>[Ve(e.$slots,"empty")]),_:2},1032,["index","nodes"]))),128))],42,["onKeydown"])}var Ga=$e(ja,[["render",Za],["__file","index.vue"]]);const Ja=pt(Ga),Xa=dt({...bt,size:qt,placeholder:String,disabled:Boolean,clearable:Boolean,filterable:Boolean,filterMethod:{type:de(Function),default:(e,l)=>e.text.includes(l)},separator:{type:String,default:" / "},showAllLevels:{type:Boolean,default:!0},collapseTags:Boolean,maxCollapseTags:{type:Number,default:1},collapseTagsTooltip:{type:Boolean,default:!1},debounce:{type:Number,default:300},beforeFilter:{type:de(Function),default:()=>!0},placement:{type:de(String),values:sa,default:"bottom-start"},fallbackPlacements:{type:de(Array),default:["bottom-start","bottom","top-start","top","right","left"]},popperClass:{type:String,default:""},teleported:oa.teleported,tagType:{...at.type,default:"info"},tagEffect:{...at.effect,default:"light"},validateEvent:{type:Boolean,default:!0},persistent:{type:Boolean,default:!0},...Ot}),Ya={[Se]:e=>!0,[we]:e=>!0,focus:e=>e instanceof FocusEvent,blur:e=>e instanceof FocusEvent,clear:()=>!0,visibleChange:e=>Ht(e),expandChange:e=>!!e,removeTag:e=>!!e},Qa="ElCascader",el=me({name:Qa}),tl=me({...el,props:Xa,emits:Ya,setup(e,{expose:l,emit:a}){const n=e,s={modifiers:[{name:"arrowPosition",enabled:!0,phase:"main",fn:({state:t})=>{const{modifiersData:u,placement:d}=t;["right","left","bottom","top"].includes(d)||(u.arrow.x=35)},requires:["arrow"]}]},v=Kt();let c=0,k=0;const f=pe("cascader"),V=pe("input"),{t:N}=ut(),{form:o,formItem:A}=Ea(),{valueOnClear:te}=Rt(n),{isComposing:j,handleComposition:R}=$a({afterComposition(t){var u;const d=(u=t.target)==null?void 0:u.value;Fe(d)}}),H=M(null),q=M(null),G=M(null),x=M(null),J=M(null),P=M(!1),T=M(!1),F=M(!1),b=M(!1),r=M(""),S=M(""),C=M([]),i=M([]),y=M([]),E=$(()=>v.style),w=$(()=>n.disabled||(o==null?void 0:o.disabled)),L=$(()=>n.placeholder||N("el.cascader.placeholder")),I=$(()=>S.value||C.value.length>0||j.value?"":L.value),K=Va(),O=$(()=>["small"].includes(K.value)?"small":"default"),W=$(()=>!!n.props.multiple),m=$(()=>!n.filterable||W.value),Ue=$(()=>W.value?S.value:r.value),_e=$(()=>{var t;return((t=x.value)==null?void 0:t.checkedNodes)||[]}),yt=$(()=>!n.clearable||w.value||F.value||!T.value?!1:!!_e.value.length),ke=$(()=>{const{showAllLevels:t,separator:u}=n,d=_e.value;return d.length?W.value?"":d[0].calcText(t,u):""}),_t=$(()=>(A==null?void 0:A.validateState)||""),Te=$({get(){return gt(n.modelValue)},set(t){const u=t??te.value;a(Se,u),a(we,u),n.validateEvent&&(A==null||A.validate("change").catch(d=>_a()))}}),kt=$(()=>[f.b(),f.m(K.value),f.is("disabled",w.value),v.class]),Ct=$(()=>[V.e("icon"),"icon-arrow-down",f.is("reverse",P.value)]),Nt=$(()=>f.is("focus",P.value||b.value)),qe=$(()=>{var t,u;return(u=(t=H.value)==null?void 0:t.popperRef)==null?void 0:u.contentRef}),X=t=>{var u,d,D;w.value||(t=t??!P.value,t!==P.value&&(P.value=t,(d=(u=q.value)==null?void 0:u.input)==null||d.setAttribute("aria-expanded",`${t}`),t?(ve(),ce((D=x.value)==null?void 0:D.scrollToExpandingNode)):n.filterable&&Pe(),a("visibleChange",t)))},ve=()=>{ce(()=>{var t;(t=H.value)==null||t.updatePopper()})},Me=()=>{F.value=!1},Le=t=>{const{showAllLevels:u,separator:d}=n;return{node:t,key:t.uid,text:t.calcText(u,d),hitState:!1,closable:!w.value&&!t.isDisabled,isCollapseTag:!1}},Ie=t=>{var u;const d=t.node;d.doCheck(!1),(u=x.value)==null||u.calculateCheckedValue(),a("removeTag",d.valueByOption)},Et=()=>{if(!W.value)return;const t=_e.value,u=[],d=[];if(t.forEach(D=>d.push(Le(D))),i.value=d,t.length){t.slice(0,n.maxCollapseTags).forEach(ae=>u.push(Le(ae)));const D=t.slice(n.maxCollapseTags),le=D.length;le&&(n.collapseTags?u.push({key:-1,text:`+ ${le}`,closable:!1,isCollapseTag:!0}):D.forEach(ae=>u.push(Le(ae))))}C.value=u},Oe=()=>{var t,u;const{filterMethod:d,showAllLevels:D,separator:le}=n,ae=(u=(t=x.value)==null?void 0:t.getFlattedNodes(!n.props.checkStrictly))==null?void 0:u.filter(ne=>ne.isDisabled?!1:(ne.calcText(D,le),d(ne,Ue.value)));W.value&&(C.value.forEach(ne=>{ne.hitState=!1}),i.value.forEach(ne=>{ne.hitState=!1})),F.value=!0,y.value=ae,ve()},Vt=()=>{var t;let u;F.value&&J.value?u=J.value.$el.querySelector(`.${f.e("suggestion-item")}`):u=(t=x.value)==null?void 0:t.$el.querySelector(`.${f.b("node")}[tabindex="-1"]`),u&&(u.focus(),!F.value&&u.click())},De=()=>{var t,u;const d=(t=q.value)==null?void 0:t.input,D=G.value,le=(u=J.value)==null?void 0:u.$el;if(!(!ct||!d)){if(le){const ae=le.querySelector(`.${f.e("suggestion-list")}`);ae.style.minWidth=`${d.offsetWidth}px`}if(D){const{offsetHeight:ae}=D,ne=C.value.length>0?`${Math.max(ae+6,c)}px`:`${c}px`;d.style.height=ne,ve()}}},St=t=>{var u;return(u=x.value)==null?void 0:u.getCheckedNodes(t)},wt=t=>{ve(),a("expandChange",t)},$t=t=>{if(!j.value)switch(t.code){case Z.enter:X();break;case Z.down:X(!0),ce(Vt),t.preventDefault();break;case Z.esc:P.value===!0&&(t.preventDefault(),t.stopPropagation(),X(!1));break;case Z.tab:X(!1);break}},Tt=()=>{var t;(t=x.value)==null||t.clearCheckedNodes(),!P.value&&n.filterable&&Pe(),X(!1),a("clear")},Pe=()=>{const{value:t}=ke;r.value=t,S.value=t},Mt=t=>{var u,d;const{checked:D}=t;W.value?(u=x.value)==null||u.handleCheckChange(t,!D,!1):(!D&&((d=x.value)==null||d.handleCheckChange(t,!0,!1)),X(!1))},Lt=t=>{const u=t.target,{code:d}=t;switch(d){case Z.up:case Z.down:{const D=d===Z.up?-1:1;Ee(ht(u,D,`.${f.e("suggestion-item")}[tabindex="-1"]`));break}case Z.enter:u.click();break}},It=()=>{const t=C.value,u=t[t.length-1];k=S.value?0:k+1,!(!u||!k||n.collapseTags&&t.length>1)&&(u.hitState?Ie(u):u.hitState=!0)},He=t=>{const u=t.target,d=f.e("search-input");u.className===d&&(b.value=!0),a("focus",t)},Ke=t=>{b.value=!1,a("blur",t)},Dt=ia(()=>{const{value:t}=Ue;if(!t)return;const u=n.beforeFilter(t);Wt(u)?u.then(Oe).catch(()=>{}):u!==!1?Oe():Me()},n.debounce),Fe=(t,u)=>{!P.value&&X(!0),!(u!=null&&u.isComposing)&&(t?Dt():Me())},Re=t=>Number.parseFloat(Ca(V.cssVarName("input-height"),t).value)-2;return oe(F,ve),oe([_e,w,()=>n.collapseTags],Et),oe(C,()=>{ce(()=>De())}),oe(K,async()=>{await ce();const t=q.value.input;c=Re(t)||c,De()}),oe(ke,Pe,{immediate:!0}),Be(()=>{const t=q.value.input,u=Re(t);c=t.offsetHeight||u,ka(t,De)}),l({getCheckedNodes:St,cascaderPanelRef:x,togglePopperVisible:X,contentRef:qe,presentText:ke}),(t,u)=>(_(),z(p(Xe),{ref_key:"tooltipRef",ref:H,visible:P.value,teleported:t.teleported,"popper-class":[p(f).e("dropdown"),t.popperClass],"popper-options":s,"fallback-placements":t.fallbackPlacements,"stop-popper-mouse-event":!1,"gpu-acceleration":!1,placement:t.placement,transition:`${p(f).namespace.value}-zoom-in-top`,effect:"light",pure:"",persistent:t.persistent,onHide:Me},{default:h(()=>[he((_(),U("div",{class:B(p(kt)),style:jt(p(E)),onClick:()=>X(p(m)?void 0:!0),onKeydown:$t,onMouseenter:d=>T.value=!0,onMouseleave:d=>T.value=!1},[g(p(ft),{ref_key:"input",ref:q,modelValue:r.value,"onUpdate:modelValue":d=>r.value=d,placeholder:p(I),readonly:p(m),disabled:p(w),"validate-event":!1,size:p(K),class:B(p(Nt)),tabindex:p(W)&&t.filterable&&!p(w)?-1:void 0,onCompositionstart:p(R),onCompositionupdate:p(R),onCompositionend:p(R),onFocus:He,onBlur:Ke,onInput:Fe},{suffix:h(()=>[p(yt)?(_(),z(p(be),{key:"clear",class:B([p(V).e("icon"),"icon-circle-close"]),onClick:ge(Tt,["stop"])},{default:h(()=>[g(p(Zt))]),_:1},8,["class","onClick"])):(_(),z(p(be),{key:"arrow-down",class:B(p(Ct)),onClick:ge(d=>X(),["stop"])},{default:h(()=>[g(p(Gt))]),_:1},8,["class","onClick"]))]),_:1},8,["modelValue","onUpdate:modelValue","placeholder","readonly","disabled","size","class","tabindex","onCompositionstart","onCompositionupdate","onCompositionend"]),p(W)?(_(),U("div",{key:0,ref_key:"tagWrapper",ref:G,class:B([p(f).e("tags"),p(f).is("validate",!!p(_t))])},[(_(!0),U(re,null,ie(C.value,d=>(_(),z(p(lt),{key:d.key,type:t.tagType,size:p(O),effect:t.tagEffect,hit:d.hitState,closable:d.closable,"disable-transitions":"",onClose:D=>Ie(d)},{default:h(()=>[d.isCollapseTag===!1?(_(),U("span",{key:0},ue(d.text),1)):(_(),z(p(Xe),{key:1,disabled:P.value||!t.collapseTagsTooltip,"fallback-placements":["bottom","top","right","left"],placement:"bottom",effect:"light"},{default:h(()=>[ee("span",null,ue(d.text),1)]),content:h(()=>[ee("div",{class:B(p(f).e("collapse-tags"))},[(_(!0),U(re,null,ie(i.value.slice(t.maxCollapseTags),(D,le)=>(_(),U("div",{key:le,class:B(p(f).e("collapse-tag"))},[(_(),z(p(lt),{key:D.key,class:"in-tooltip",type:t.tagType,size:p(O),effect:t.tagEffect,hit:D.hitState,closable:D.closable,"disable-transitions":"",onClose:ae=>Ie(D)},{default:h(()=>[ee("span",null,ue(D.text),1)]),_:2},1032,["type","size","effect","hit","closable","onClose"]))],2))),128))],2)]),_:2},1032,["disabled"]))]),_:2},1032,["type","size","effect","hit","closable","onClose"]))),128)),t.filterable&&!p(w)?he((_(),U("input",{key:0,"onUpdate:modelValue":d=>S.value=d,type:"text",class:B(p(f).e("search-input")),placeholder:p(ke)?"":p(L),onInput:d=>Fe(S.value,d),onClick:ge(d=>X(!0),["stop"]),onKeydown:Jt(It,["delete"]),onCompositionstart:p(R),onCompositionupdate:p(R),onCompositionend:p(R),onFocus:He,onBlur:Ke},null,42,["onUpdate:modelValue","placeholder","onInput","onClick","onKeydown","onCompositionstart","onCompositionupdate","onCompositionend"])),[[Xt,S.value]]):Q("v-if",!0)],2)):Q("v-if",!0)],46,["onClick","onMouseenter","onMouseleave"])),[[p(Ta),()=>X(!1),p(qe)]])]),content:h(()=>[he(g(p(Ja),{ref_key:"cascaderPanelRef",ref:x,modelValue:p(Te),"onUpdate:modelValue":d=>Yt(Te)?Te.value=d:null,options:t.options,props:n.props,border:!1,"render-label":t.$slots.default,onExpandChange:wt,onClose:d=>t.$nextTick(()=>X(!1))},{empty:h(()=>[Ve(t.$slots,"empty")]),_:3},8,["modelValue","onUpdate:modelValue","options","props","render-label","onClose"]),[[Ge,!F.value]]),t.filterable?he((_(),z(p(mt),{key:0,ref_key:"suggestionPanel",ref:J,tag:"ul",class:B(p(f).e("suggestion-panel")),"view-class":p(f).e("suggestion-list"),onKeydown:Lt},{default:h(()=>[y.value.length?(_(!0),U(re,{key:0},ie(y.value,d=>(_(),U("li",{key:d.uid,class:B([p(f).e("suggestion-item"),p(f).is("checked",d.checked)]),tabindex:-1,onClick:D=>Mt(d)},[ee("span",null,ue(d.text),1),d.checked?(_(),z(p(be),{key:0},{default:h(()=>[g(p(ot))]),_:1})):Q("v-if",!0)],10,["onClick"]))),128)):Ve(t.$slots,"empty",{key:1},()=>[ee("li",{class:B(p(f).e("empty-text"))},ue(p(N)("el.cascader.noMatch")),3)])]),_:3},8,["class","view-class"])),[[Ge,F.value]]):Q("v-if",!0)]),_:3},8,["visible","teleported","popper-class","fallback-placements","placement","transition","persistent"]))}});var al=$e(tl,[["__file","cascader.vue"]]);const ll=pt(al);function nl(e,l){if(!e){if(!l||l.length===0)return"I-01";const a=l.filter(s=>s.startsWith("I-")),n=Math.max(...a.map(s=>parseInt(s.split("-")[1])));return`I-${String(n+1).padStart(2,"0")}`}if(!Array.isArray(l))return"";try{const[a,...n]=e.split("-"),s=sl(a),v=ol(s);if(!v)return"";const c=a.replace(s,v),k=l.filter(N=>N.startsWith(`${c}-`));if(k.length===0)return`${c}-01`;const f=Math.max(...k.map(N=>parseInt(N.split("-")[1]))),V=String(f+1).padStart(2,"0");return`${c}-${V}`}catch{return""}}function sl(e){const l=e.match(/(I|Ⅰ|Ⅱ|Ⅲ|Ⅳ|Ⅴ|Ⅵ|Ⅶ|Ⅷ|Ⅸ|Ⅹ|Ⅺ|Ⅻ)+/);return l?l[0]:e}function ol(e){return{I:"Ⅱ","Ⅰ":"Ⅱ","Ⅱ":"Ⅲ","Ⅲ":"Ⅳ","Ⅳ":"Ⅴ","Ⅴ":"Ⅵ","Ⅵ":"Ⅶ","Ⅶ":"Ⅷ","Ⅷ":"Ⅸ","Ⅸ":"Ⅹ","Ⅹ":"Ⅺ","Ⅺ":"Ⅻ"}[e]||""}const rl={class:"form-item-split"},il={class:"form-item-split"},ul={class:"form-item-split"},dl={class:"form-item-split"},cl={class:"form-item-split"},pl={__name:"MeterDialog",props:{pMeter:{type:Object,default:()=>({})},id:{type:Number,default:null}},emits:["update:visible"],setup(e,{emit:l}){const a=e;let n=M([]);const s=M([]),v=M([]),c=l,k=fa(),f=Je(),V=ga(),N=M(!1),o=M({parent_id:0,company_id:f.currentCompany.id,engine_id:null,type:k.currentSelectedType,meter_code:"",meter_id:"",installation_date:"",manufacturer:"",specification:"",area_id:null,status:1,remarks:"",bottom_value:0,multiple:1,sub_category1:"",sub_category2:"",sub_category3:"",sub_category4:""}),A=[{value:1,label:"虚拟表"},{value:2,label:"大连思捷"},{value:3,label:"迈德电子"},{value:4,label:"千汇01"},{value:5,label:"1号平台"},{value:6,label:"千汇中电建"}],te=b=>{const r=[],S={};return b.forEach(C=>{S[C.id]={...C,children:[]}}),b.forEach(C=>{C.part_of===null?r.push(S[C.id]):S[C.part_of]&&S[C.part_of].children.push(S[C.id])}),r},j=b=>{console.log(b),b&&b.length>0?(o.value.sub_category1=b[0],o.value.sub_category2=b[1]||"",o.value.sub_category3=b[2]||"",o.value.sub_category4=b[3]||""):(o.value.sub_category1="",o.value.sub_category2="",o.value.sub_category3="",o.value.sub_category4="")},R=async b=>{N.value=!0;try{const r=await ma({id:b});if(r.code!==200)console.error(r.message),Ne.error(r.message);else{const S=r.data[0];o.value={...S,parent_id:Number(S.parent_id),company_id:Number(S.company_id),engine_id:Number(S.engine_id),type:Number(S.type),status:Number(S.status),installation_date:S.installation_date?new Date(S.installation_date):""};const C=[];for(let i=1;i<=4;i++){const y=o.value[`sub_category${i}`];y&&C.push(y)}s.value=C}}catch(r){console.error(r),Ne.error(r.message||"获取表计信息失败")}finally{N.value=!1}},H={company_id:[{required:!0,message:"请输入公司ID",trigger:"blur"}],engine_id:[{required:!0,message:"请选择引擎",trigger:"change"},{type:"number",message:"引擎ID必须为数字",trigger:["change","blur"]}],meter_code:[{required:!0,message:"请输入表计编码",trigger:"blur"}],meter_id:[{required:!0,message:"请输入表计ID",trigger:"blur"}],installation_date:[{required:!0,message:"请选择安装日期",trigger:"change"}],area_id:[{required:!0,message:"请选择供应地区",trigger:"change"}],status:[{required:!0,message:"请选择状态",trigger:"change"}],remarks:[{required:!1}],type:[{required:!0,message:"请选择类型",trigger:"change"}],bottom_value:[{required:!1},{type:"number",message:"启表底数必须为数字",trigger:["change","blur"]}],multiple:[{required:!1},{type:"number",message:"倍率必须为数字",trigger:["change","blur"]}]},q=M(null),G=()=>{q.value.validate(async b=>{if(b)await J();else return Ne.error("请正确填写表单。"),!1})},x=()=>{if(q.value){q.value.resetFields();let b=nl(a.pMeter.meter_code,k.meterList.map(r=>r.meter_code))||"";o.value={id:null,parent_id:a.pMeter.id?Number(a.pMeter.id):0,company_id:f.currentCompany.id,engine_id:a.pMeter.engine_id?Number(a.pMeter.engine_id):null,type:a.pMeter.type?Number(a.pMeter.type):k.currentSelectedType,meter_code:b,meter_id:"",bottom_value:0,multiple:1,installation_date:"",manufacturer:"",specification:"",area_id:null,status:1,remarks:"",sub_category1:"",sub_category2:"",sub_category3:"",sub_category4:""},s.value=[]}},J=async()=>{N.value=!0;try{o.value.engine_id=Number(o.value.engine_id);let b={};a.id?b=await ha(o.value):b=await va(o.value),Ne.success("操作成功"),k.fetchMeterList({type:k.currentSelectedType}),c("update:visible")}catch(b){tt(b,"操作失败",!0)}finally{N.value=!1}},P=M([]),T=async()=>{try{const[b,r,S,C]=await Promise.all([Ce({level:1}),Ce({level:2}),Ce({level:3}),Ce({level:4})]);P.value=[...b.data,...r.data,...S.data,...C.data]}catch(b){tt(b,"获取分类数据失败",!0)}};oe(()=>a.pMeter,b=>{o.value.parent_id=b.id?Number(b.id):0,o.value.type=b.type!==void 0?Number(b.type):k.currentSelectedType},{deep:!0});let F=o.value.type===1?"水虚拟表":o.value.type===2?"电虚拟表":"气虚拟表";return Be(async()=>{V.areas.length||await V.fetchAreas(),n.value=await ba(Je().currentCompany.id,F),await T(),v.value=te(P.value),a.id?await R(a.id):x()}),(b,r)=>{const S=ft,C=aa,i=ca,y=pa,E=vt,w=da,L=ua,I=ll,K=na,O=la,W=ea;return he((_(),z(O,{model:o.value,rules:H,ref_key:"meterFormRef",ref:q,"label-width":"120px"},{default:h(()=>[g(C,{label:"表计编码",prop:"meter_code"},{default:h(()=>[g(S,{modelValue:o.value.meter_code,"onUpdate:modelValue":r[0]||(r[0]=m=>o.value.meter_code=m)},null,8,["modelValue"])]),_:1}),ee("div",rl,[g(C,{label:"引擎",prop:"engine_id"},{default:h(()=>[g(y,{modelValue:o.value.engine_id,"onUpdate:modelValue":r[1]||(r[1]=m=>o.value.engine_id=m),modelModifiers:{number:!0},placeholder:"请选择引擎",clearable:""},{default:h(()=>[(_(),U(re,null,ie(A,m=>g(i,{key:m.value,label:m.label,value:m.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),g(C,{label:o.value.engine_id===1?"表计公式":"外部表计id",prop:"meter_id"},{default:h(()=>[o.value.engine_id===2?(_(),z(S,{key:0,modelValue:o.value.meter_id,"onUpdate:modelValue":r[2]||(r[2]=m=>o.value.meter_id=m)},null,8,["modelValue"])):(_(),z(y,{key:1,modelValue:o.value.meter_id,"onUpdate:modelValue":r[3]||(r[3]=m=>o.value.meter_id=m),placeholder:"请选择表计公式",clearable:""},{default:h(()=>[(_(!0),U(re,null,ie(p(n),m=>(_(),z(i,{key:m.id,label:m.name,value:""+m.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]))]),_:1},8,["label"])]),ee("div",il,[g(C,{label:"启表底数",prop:"bottom_value"},{default:h(()=>[g(S,{modelValue:o.value.bottom_value,"onUpdate:modelValue":r[4]||(r[4]=m=>o.value.bottom_value=m),modelModifiers:{number:!0},type:"number",placeholder:"请输入启表底数"},null,8,["modelValue"])]),_:1}),g(C,{label:"倍率",prop:"multiple"},{default:h(()=>[g(S,{modelValue:o.value.multiple,"onUpdate:modelValue":r[5]||(r[5]=m=>o.value.multiple=m),modelModifiers:{number:!0},type:"number",placeholder:"请输入倍率"},null,8,["modelValue"])]),_:1})]),ee("div",ul,[g(C,{label:"状态",prop:"status"},{default:h(()=>[g(w,{modelValue:o.value.status,"onUpdate:modelValue":r[6]||(r[6]=m=>o.value.status=m),modelModifiers:{number:!0}},{default:h(()=>[g(E,{value:1},{default:h(()=>r[14]||(r[14]=[se("启用")])),_:1}),g(E,{value:2},{default:h(()=>r[15]||(r[15]=[se("停用")])),_:1})]),_:1},8,["modelValue"])]),_:1}),g(C,{label:"类型",prop:"type"},{default:h(()=>[g(w,{modelValue:o.value.type,"onUpdate:modelValue":r[7]||(r[7]=m=>o.value.type=m),modelModifiers:{number:!0},disabled:""},{default:h(()=>[g(E,{value:1},{default:h(()=>r[16]||(r[16]=[se("水表")])),_:1}),g(E,{value:2},{default:h(()=>r[17]||(r[17]=[se("电表")])),_:1}),g(E,{value:3},{default:h(()=>r[18]||(r[18]=[se("气表")])),_:1})]),_:1},8,["modelValue"])]),_:1})]),ee("div",dl,[g(C,{label:"安装日期",prop:"installation_date"},{default:h(()=>[g(L,{modelValue:o.value.installation_date,"onUpdate:modelValue":r[8]||(r[8]=m=>o.value.installation_date=m),type:"date",placeholder:"请选择安装日期"},null,8,["modelValue"])]),_:1}),g(C,{label:"分类"},{default:h(()=>[g(I,{modelValue:s.value,"onUpdate:modelValue":r[9]||(r[9]=m=>s.value=m),options:v.value,props:{checkStrictly:!0,value:"value",label:"value"},clearable:"",placeholder:"请选择分类",onChange:j},null,8,["modelValue","options"])]),_:1})]),ee("div",cl,[g(C,{label:"制造商",prop:"manufacturer"},{default:h(()=>[g(S,{modelValue:o.value.manufacturer,"onUpdate:modelValue":r[10]||(r[10]=m=>o.value.manufacturer=m)},null,8,["modelValue"])]),_:1}),g(C,{label:"规格",prop:"specification"},{default:h(()=>[g(S,{modelValue:o.value.specification,"onUpdate:modelValue":r[11]||(r[11]=m=>o.value.specification=m)},null,8,["modelValue"])]),_:1})]),g(C,{label:"供应地区",prop:"area_id"},{default:h(()=>[g(y,{modelValue:o.value.area_id,"onUpdate:modelValue":r[12]||(r[12]=m=>o.value.area_id=m),modelModifiers:{number:!0},clearable:"",placeholder:"请选择供应地区"},{default:h(()=>[(_(!0),U(re,null,ie(p(V).areas,m=>(_(),z(i,{key:m.id,label:m.name,value:m.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),g(C,{label:"备注",prop:"remarks"},{default:h(()=>[g(S,{modelValue:o.value.remarks,"onUpdate:modelValue":r[13]||(r[13]=m=>o.value.remarks=m)},null,8,["modelValue"])]),_:1}),g(C,null,{default:h(()=>[g(K,{type:"primary",onClick:G},{default:h(()=>r[19]||(r[19]=[se("提交")])),_:1}),g(K,{onClick:x},{default:h(()=>r[20]||(r[20]=[se("重置")])),_:1})]),_:1})]),_:1},8,["model"])),[[W,N.value]])}}},Kl=Qt(pl,[["__scopeId","data-v-54fafa4c"]]);export{Kl as _};
