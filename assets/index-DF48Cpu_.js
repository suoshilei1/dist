const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/UserPermission-BmUVR_oZ.js","assets/index-oALI6hjD.js","assets/index-CKGHOdoA.css","assets/button-CW4VZptJ.js","assets/index-DXOgsKzf.js","assets/plugin-vue_export-helper-CqGSI99y.js","assets/index-GdZBC0LW.js","assets/use-form-item-CJ5jT23N.js","assets/icon-DFUaFmZd.js","assets/button-CzpQr9Wb.css","assets/tree-DFq1abUa.js","assets/select-B0JZ5Vmm.js","assets/popper-8tqvLSZz.js","assets/index-Ci2yyUHC.js","assets/aria-BUADUvnR.js","assets/focus-trap-B9jhWFgs.js","assets/popper-CLIXM2zs.css","assets/scrollbar-BwLVa3O8.js","assets/scrollbar-C4q0Zfda.css","assets/index-ClN0XSgQ.js","assets/castArray-DuUCQlE9.js","assets/index-BTnVmvBQ.js","assets/scroll-BUhzRsoy.js","assets/isEqual-DERyOhzh.js","assets/_Uint8Array-Cyhry7Ym.js","assets/_baseIteratee-_-ChXyeP.js","assets/index-CPa7yTdP.js","assets/select-BgyzP3al.css","assets/checkbox-eAiA7KBF.js","assets/checkbox-DD4l_ypT.css","assets/tree-Dov2ACS9.css","assets/handleError-BVJ6YTlw.js","assets/index-CV7ElbEQ.js","assets/index-BFWR71cx.js","assets/base-CMRK1q-d.css","assets/el-notification-BWnt3bt7.css","assets/index-DKbZ_y2J.js","assets/input-_j8YarB1.js","assets/input-CvX03x0l.css","assets/index-JdeAZNwx.js","assets/vnode-DAFY4x8G.js","assets/validator-DaZaXEYL.js","assets/UserPermission-DsF0mPC9.css","assets/el-overlay-adAJ4NaI.css","assets/el-badge-BWN_0xb6.css"])))=>i.map(i=>d[i]);
import{r as n,a as ie,V as N,ag as ue,X as G,I as B,c as A,J as F,j as r,i as l,d as K,T as H,U as me,h as M,f as U,v as Q,_ as W,w as pe,o as de,e as T,g as D,k as J,l as ce,a2 as fe,a3 as _e}from"./index-oALI6hjD.js";import{U as ge,C as ve,P as ye,E as be}from"./constants-Be6xblX4.js";import"./overlay-WqKCga-H.js";import{E as we}from"./card-DUC90zSS.js";import{E as he}from"./dialog-B_GDP7gC.js";import{E as Ee}from"./pagination-DXEjFwoH.js";/* empty css            */import{E as Ce,a as Ve}from"./select-B0JZ5Vmm.js";import"./scrollbar-BwLVa3O8.js";import"./popper-8tqvLSZz.js";import{E as Pe,a as Ue}from"./table-column-B3vmHtxt.js";import"./checkbox-eAiA7KBF.js";/* empty css                */import{E as ke}from"./empty-BnW6BhO3.js";import{E as Y}from"./button-CW4VZptJ.js";import{E as xe}from"./autocomplete-N5BG9fbW.js";import{E as Re}from"./input-_j8YarB1.js";import{f as Z}from"./date-LkHkg0he.js";import{E as Ae,a as Se}from"./form-item-JkdAUXjO.js";import{g as z,u as Te,a as $e,d as De}from"./user-DEGSMhkJ.js";import{s as ze}from"./sha256-DcrFp9Dj.js";/* empty css             *//* empty css                 */import{E as g}from"./index-CV7ElbEQ.js";import{d as Be}from"./DebounceAndThrottle-B_grFKK4.js";/* empty css                   */import{E as Fe}from"./index-DKbZ_y2J.js";import"./index-JdeAZNwx.js";import"./index-Ci2yyUHC.js";import"./scroll-BUhzRsoy.js";import"./vnode-DAFY4x8G.js";import"./index-DXOgsKzf.js";import"./plugin-vue_export-helper-CqGSI99y.js";import"./index-GdZBC0LW.js";import"./focus-trap-B9jhWFgs.js";import"./aria-BUADUvnR.js";import"./icon-DFUaFmZd.js";import"./use-form-item-CJ5jT23N.js";import"./refs-sNzFHjPI.js";import"./index-BTnVmvBQ.js";import"./isEqual-DERyOhzh.js";import"./_Uint8Array-Cyhry7Ym.js";import"./index-ClN0XSgQ.js";import"./castArray-DuUCQlE9.js";import"./_baseIteratee-_-ChXyeP.js";import"./index-CPa7yTdP.js";import"./_initCloneObject-CeA08_Bb.js";import"./dayjs.min-VPOC9PSa.js";import"./validator-DaZaXEYL.js";const Ie={__name:"UserDialog",props:["id"],emits:["fetchUser"],setup(I,{emit:$}){let c=n(!1);const w=[{label:"用户权限",value:""+ge},{label:"公司管理员",value:""+ve},{label:"平台管理员",value:""+ye}],e=ie({id:null,phone:"",email:"",username:"",permission:"",company_id:N().currentCompany.id,real_name:"",password:""}),k={phone:[{required:!0,message:"请输入手机号",trigger:"blur"},{pattern:/^1[3-9]\d{9}$/,message:"请输入有效的手机号",trigger:"blur"}],email:[{required:!0,message:"请输入邮箱",trigger:"blur"},{type:"email",message:"请输入有效的邮箱地址",trigger:["blur","change"]}],username:[{required:!0,message:"请输入账号",trigger:"blur"},{min:3,max:20,message:"账号长度在 3 到 20 个字符",trigger:"blur"},{pattern:/^[a-zA-Z0-9]+$/,message:"账号只能包含字母和数字",trigger:"blur"}],permission:[{required:!0,message:"请选择权限",trigger:"change"}],real_name:[{required:!0,message:"请输入真实姓名",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:6,message:"密码长度不能少于6位",trigger:"blur"}]},v=n(null),p=n(!1),h=$,f=I,_=()=>{e.id=null,e.permission="",e.company_id=N().currentCompany.id,e.real_name="",e.password="",e.phone="",e.email="",e.username=""};ue(async()=>{if(f.id){p.value=!0,e.id=f.id;try{c.value=!0;const y=await z({id:f.id});Object.assign(e,y.results[0])}catch(y){console.log(y),g.error("获取用户信息失败")}finally{c.value=!1}}else p.value=!1,_()});const u=async()=>{v.value.validate(async y=>{if(y){c.value=!0,e.password&&(e.password=await ze(e.password)),console.log(e);try{e.id?(await Te(e),g.success("更新成功！")):(await $e(e),g.success("添加成功！"))}catch(t){g.error(t.message||"提交失败！")}finally{c.value=!1,h("fetchUser"),v.value.resetFields()}}else return g.error("请检查表单填写是否正确"),c.value=!1,!1})};return(y,t)=>{const E=Re,C=Ae,O=Ce,q=Ve,x=Y,V=Se,j=Q;return G((A(),F(V,{model:e,rules:k,ref_key:"userForm",ref:v,"label-width":"120px"},{default:r(()=>[l(C,{label:"真实姓名",prop:"real_name"},{default:r(()=>[l(E,{modelValue:e.real_name,"onUpdate:modelValue":t[0]||(t[0]=s=>e.real_name=s),placeholder:"请输入真实姓名"},null,8,["modelValue"])]),_:1}),l(C,{label:"手机号",prop:"phone"},{default:r(()=>[l(E,{modelValue:e.phone,"onUpdate:modelValue":t[1]||(t[1]=s=>e.phone=s),placeholder:"请输入手机号"},null,8,["modelValue"])]),_:1}),l(C,{label:"邮箱",prop:"email"},{default:r(()=>[l(E,{modelValue:e.email,"onUpdate:modelValue":t[2]||(t[2]=s=>e.email=s),placeholder:"请输入邮箱"},null,8,["modelValue"])]),_:1}),l(C,{label:"账号",prop:"username"},{default:r(()=>[l(E,{modelValue:e.username,"onUpdate:modelValue":t[3]||(t[3]=s=>e.username=s),placeholder:"请输入账号"},null,8,["modelValue"])]),_:1}),l(C,{label:"权限",prop:"permission"},{default:r(()=>[l(q,{modelValue:e.permission,"onUpdate:modelValue":t[4]||(t[4]=s=>e.permission=s),placeholder:"请选择权限"},{default:r(()=>[(A(),K(H,null,me(w,s=>l(O,{key:s.value,label:s.label,value:s.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),p.value?M("",!0):(A(),F(C,{key:0,label:"密码",prop:"password"},{default:r(()=>[l(E,{type:"password",modelValue:e.password,"onUpdate:modelValue":t[5]||(t[5]=s=>e.password=s),placeholder:"请输入密码"},null,8,["modelValue"])]),_:1})),l(C,{style:{"margin-top":"1rem"}},{default:r(()=>[l(x,{type:"primary",onClick:u},{default:r(()=>t[6]||(t[6]=[U("提交")])),_:1}),l(x,{onClick:_},{default:r(()=>t[7]||(t[7]=[U("重置")])),_:1})]),_:1})]),_:1},8,["model"])),[[j,B(c)]])}}},qe={class:"container"},Le={class:"search-bar"},Me={class:"custom-suggestion-item"},Ne={__name:"UserTable",props:{company_id:{type:[Number,String],default:null}},emits:["showPermission"],setup(I,{expose:$,emit:c}){const w=I,e=c,k=n(!1),v=n([]),p=n(),h=n(null),f=n(!1),_=n(1),u=n(12),y=n(0),t=n(""),E=n(null),C=o=>{E.value=o,q(o)},O=o=>{o||e("showPermission",null)},q=o=>{p.value&&p.value.setCurrentRow(o),e("showPermission",o)},x=()=>{p.value&&p.value.setCurrentRow(null)},V=async(o=0,a=u.value)=>{f.value=!1;try{k.value=!0;const m={offset:o,limit:a,real_name:t.value?`%${t.value}%`:"%"};let b=ce().query;b.id?m.company_id=b.id:m.company_id=N().currentCompany.id;const R=await z(m);if(R.code===200){const{results:d,total:S}=R;v.value=d,y.value=S,E.value&&(d.some(P=>P.id===E.value.id)||(x(),e("showPermission",null)))}else console.error(R.message),g.error(R.message)}catch(m){console.error(m),g.error("获取用户信息失败")}finally{k.value=!1}},j=()=>{t.value="",_.value=1,x(),e("showPermission",null),V(0,u.value)},s=o=>{f.value=!0,h.value=o.id},ee=o=>{Fe.confirm(`确认删除用户 ${o.real_name} 吗？`,"警告",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then(async()=>{await le(o.username),V((_.value-1)*u.value,u.value)}).catch(()=>{})};async function le(o){try{let a=await De({username:o});a.code===200?g.success("删除成功"):(console.error(a.message),g.error(a.message||"删除失败请稍后重试"))}catch(a){console.error(a),g.error(a.message||"删除失败请稍后重试")}}const ae=o=>{t.value=o.real_name,_.value=1,x(),V(0,u.value)},oe=Be(async(o,a)=>{if(!o){a([]);return}try{const m={offset:0,limit:5};w.company_id&&(m.company_id=w.company_id);const[b,R,d]=await Promise.all([z({...m,real_name:"%"+o+"%"}),z({...m,email:"%"+o+"%"}),z({...m,phone:"%"+o+"%"})]),S=[];[b,R,d].forEach(P=>{P.code===200&&S.push(...P.results)});const L=Array.from(new Map(S.map(P=>[P.id,P])).values());a(L)}catch(m){console.error(m),g.error("获取用户信息失败"),a([])}},500),te=()=>{h.value=null,f.value=!0},re=o=>{_.value=o,x(),V((_.value-1)*u.value,u.value)};let se=N();return pe(()=>se.currentCompany,()=>{V(0,u.value)}),de(()=>{V(0,u.value)}),$({clearCurrentRow:x}),(o,a)=>{const m=xe,b=Y,R=ke,d=Pe,S=Ue,L=Ee,P=he,ne=Q;return A(),K(H,null,[T("div",qe,[T("div",Le,[l(m,{"trigger-on-focus":!1,style:{width:"200px"},clearable:"","hide-loading":!0,class:"search-input",modelValue:t.value,"onUpdate:modelValue":a[0]||(a[0]=i=>t.value=i),"fetch-suggestions":B(oe),placeholder:"搜索姓名、邮箱或电话",onSelect:ae},{default:r(({item:i})=>[T("div",Me,[T("span",null,D(i.real_name)+" - ",1),T("span",null,D(i.email)+" - ",1),T("span",null,D(i.phone),1)])]),_:1},8,["modelValue","fetch-suggestions"]),l(b,{type:"primary",onClick:j,class:"reset-button"},{default:r(()=>a[2]||(a[2]=[U("重置")])),_:1}),l(b,{type:"primary",onClick:te,class:"add-button"},{default:r(()=>a[3]||(a[3]=[U("新增人员")])),_:1})]),!v.value.length&&!k.value?(A(),F(R,{key:0,description:"暂无数据",style:{width:"100%",height:"80%"}})):M("",!0),v.value.length?G((A(),F(S,{key:1,ref_key:"tableRef",ref:p,data:v.value,class:"person-table",style:{width:"100%"},onRowClick:C,"highlight-current-row":!0,onCurrentChange:O},{default:r(()=>[l(d,{label:"编号",width:"80",prop:"id",sortable:"",align:"center"}),l(d,{prop:"real_name",label:"姓名",align:"center"}),l(d,{prop:"phone",align:"center",label:"电话"}),l(d,{prop:"email",align:"center","show-overflow-tooltip":"",label:"邮箱"}),l(d,{sortable:"",prop:"created_at",label:"创建时间"},{default:r(i=>[U(D(B(Z)(i.row.created_at)),1)]),_:1}),l(d,{sortable:"",prop:"updated_at",label:"修改时间"},{default:r(i=>[U(D(B(Z)(i.row.updated_at)),1)]),_:1}),l(d,{fixed:"right",align:"center",label:"操作",width:"250"},{default:r(i=>[l(b,{onClick:J(X=>q(i.row),["stop"]),type:"success",size:"small"},{default:r(()=>a[4]||(a[4]=[U("查看权限")])),_:2},1032,["onClick"]),l(b,{type:"primary",icon:"Edit",onClick:J(X=>s(i.row),["stop"]),size:"small"},{default:r(()=>a[5]||(a[5]=[U("编辑")])),_:2},1032,["onClick"]),l(b,{type:"danger",icon:"Delete",onClick:J(X=>ee(i.row),["stop"]),size:"small"},{default:r(()=>a[6]||(a[6]=[U("删除")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[ne,k.value]]):M("",!0),y.value>0?(A(),F(L,{key:2,onCurrentChange:re,"current-page":_.value,"page-size":u.value,"hide-on-single-page":!0,background:"","pager-count":5,layout:"prev, pager, next",total:y.value,class:"pagination"},null,8,["current-page","page-size","total"])):M("",!0)]),l(P,{"destroy-on-close":"",title:h.value?"编辑人员":"新增人员",modelValue:f.value,"onUpdate:modelValue":a[1]||(a[1]=i=>f.value=i)},{default:r(()=>[l(Ie,{onFetchUser:V,id:h.value},null,8,["id"])]),_:1},8,["title","modelValue"])],64)}}},Oe=W(Ne,[["__scopeId","data-v-0eb190ba"]]),je={class:"layout-wrapper"},Je={__name:"index",setup(I){const $=fe(()=>_e(()=>import("./UserPermission-BmUVR_oZ.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44]))),c=n(null),w=n(!1),e=n(null);function k(p){e.value=p,w.value=!0}function v(){c.value.clearCurrentRow(),w.value=!1}return(p,h)=>{const f=we,_=be;return A(),K("div",je,[l(f,{class:"table-wrapper"},{default:r(()=>[l(Oe,{ref_key:"userTable",ref:c,onShowPermission:k},null,512)]),_:1}),l(_,{modelValue:w.value,"onUpdate:modelValue":h[0]||(h[0]=u=>w.value=u),title:"权限管理",size:"30%","show-close":!0,"before-close":v,direction:"rtl","destroy-on-close":!0},{default:r(()=>[l(B($),{userinfo:e.value},null,8,["userinfo"])]),_:1},8,["modelValue"])])}}},Ml=W(Je,[["__scopeId","data-v-cf7f8a3d"]]);export{Ml as default};
