import{_ as z,r as v,F as C,o as S,W as B,X as U,c as _,d as g,J as Q,Y as I,k as t,l as r,e as E,f as o,g as n,U as T,v as W}from"./index-DWtISIBF.js";import{E as j}from"./dialog-DnmK2X7S.js";import"./overlay-BY0G5ok6.js";import{E as G}from"./card-Cr9tAXzl.js";import{E as J,a as K}from"./descriptions-item--XR7Cf6R.js";/* empty css            *//* empty css                */import{E as O}from"./popper-BNb2tGl7.js";import{E as P}from"./button-DfREtLL_.js";import{E as X}from"./empty-CAh1XabF.js";import{u as w,k as x,e as F}from"./meter-BWYCtTLu.js";import{f as Y}from"./date-C99jBCbl.js";import{_ as Z}from"./MeterDialog-DLFqLZEh.js";import{u as q}from"./area-CDc72icr.js";import{g as V}from"./formula-BoDYiet4.js";import{h as A}from"./handleError-BsBqXgSR.js";import{E as f}from"./index-CZh1RU_w.js";import{s as H}from"./index.vue-cqg6ZM2y.js";import{E as R}from"./index-0A8HTOTd.js";import{s as $}from"./useParentComponentEffect-DPTUSRTe.js";const ee={__name:"DeviceInfo",setup(N,{expose:i}){i();const M=v([]);function e(l){const s=M.value.find(L=>L.id==l);return s?s.name:""}const u=v(!1),c=w(),d=C(()=>c.currentMeter),m=v(!1),D=C(()=>({id:d.value.parent_id,type:d.value.type}));async function a(){c.currentMeter||c.treeDataForChart||(await c.fetchMeterList(),c.setCurrentMeter(c.treeDataForChart[0]))}a();const h={1:"虚拟设备",2:"大连思捷",3:"迈德",4:"千汇-未知公司token",5:"一个没有名字的智慧管理平台",6:"欧锐德电子"};function p(){m.value=!0}async function b(){m.value=!1,u.value=!0;try{const l=await F({id:d.value.id});l.code!==200?(console.error(l.message),f.error(l.message)):(console.log(l),c.setCurrentMeter(l.data[0]))}catch(l){console.error(l),f.error(l.message||"获取表计信息失败")}finally{u.value=!1}}function k(){u.value=!0;const l=[d.value.id];x(l).then(s=>{s.code===200?(f.success("删除成功"),c.fetchMeterList()):(console.error(s.message),f.error(s.message||"删除失败"))}).catch(s=>{console.error(s),f.error("删除失败")}).finally(()=>{u.value=!1})}S(async()=>{try{M.value=await V(B().currentCompany.id)}catch(l){A(l,"获取表计公式名称失败")}});const y={formulaList:M,getFormulaNameById:e,loading:u,meterStore:c,currentMeter:d,dialogVisible:m,parent_meter:D,initCurrentMeter:a,engineMap:h,handleEdit:p,handleUpdate:b,handleDelete:k,ref:v,computed:C,onMounted:S,get useMeterStore(){return w},get formatDate(){return Y},MeterDialog:Z,get deleteMeterApi(){return x},get getMeterInfoApi(){return F},get ElMessage(){return f},get BMap(){return $},get BMarker(){return H},get useCompanyStore(){return B},get useAreaStore(){return q},get getFormulaList(){return V},get handleError(){return A}};return Object.defineProperty(y,"__isScriptSetup",{enumerable:!1,value:!0}),y}},te={key:1,"element-loading-text":"loading...",class:"meter-detail"},re={class:"actions"},ae={key:0},oe={key:1},ne={style:{width:"100%"}};function le(N,i,M,e,u,c){const d=X,m=P,D=O,a=J,h=R,p=K,b=G,k=j,y=U("permission"),l=W;return _(),g(T,null,[e.currentMeter?I((_(),g("div",te,[t(b,{class:"box-card"},{header:r(()=>[i[3]||(i[3]=E("span",null,"基本信息",-1)),I((_(),g("div",re,[t(m,{type:"primary",onClick:e.handleEdit,size:"small"},{default:r(()=>i[1]||(i[1]=[o("编辑")])),_:1}),t(D,{class:"item",effect:"dark",content:"删除表计后，相关数据将被删除，请谨慎操作！",placement:"top"},{default:r(()=>[t(m,{type:"danger",onClick:e.handleDelete,size:"small"},{default:r(()=>i[2]||(i[2]=[o("删除")])),_:1})]),_:1})])),[[y,"manage_device"]])]),default:r(()=>[t(p,{column:2,border:""},{default:r(()=>[t(a,{label:"表计编码"},{default:r(()=>[o(n(e.currentMeter.meter_code),1)]),_:1}),t(a,{label:"折标煤系数"},{default:r(()=>[o(n(e.currentMeter.standard_coal_factor),1)]),_:1}),t(a,{label:"引擎"},{default:r(()=>[o(n(e.engineMap[e.currentMeter.engine_id]||"未知"),1)]),_:1}),t(a,{label:e.currentMeter.engine_id===1?"表计公式":"表计外部ID"},{default:r(()=>[e.currentMeter.engine_id!==1?(_(),g("span",ae,n(e.currentMeter.meter_id),1)):(_(),g("span",oe,n(e.getFormulaNameById(e.currentMeter.meter_id)||"未知"),1))]),_:1},8,["label"]),t(a,{label:"状态"},{default:r(()=>[t(h,{type:e.currentMeter.status===1?"success":"danger",effect:"light"},{default:r(()=>[o(n(e.currentMeter.status===1?"可用":"不可用"),1)]),_:1},8,["type"])]),_:1}),t(a,{label:"类型"},{default:r(()=>[o(n(e.currentMeter.type===1?"水表":e.currentMeter.type===2?"电表":"气表"),1)]),_:1}),t(a,{label:"规格"},{default:r(()=>[o(n(e.currentMeter.specification||"未知"),1)]),_:1}),t(a,{label:"制造商"},{default:r(()=>[o(n(e.currentMeter.manufacturer||"未知"),1)]),_:1}),t(a,{label:"一级分类"},{default:r(()=>[o(n(e.currentMeter.sub_category1||"未知"),1)]),_:1}),t(a,{label:"二级分类"},{default:r(()=>[o(n(e.currentMeter.sub_category2||"未知"),1)]),_:1}),t(a,{label:"三级分类"},{default:r(()=>[o(n(e.currentMeter.sub_category3||"未知"),1)]),_:1}),t(a,{label:"四级分类"},{default:r(()=>[o(n(e.currentMeter.sub_category4||"未知"),1)]),_:1})]),_:1})]),_:1}),t(b,{class:"box-card"},{header:r(()=>i[4]||(i[4]=[E("div",{class:"card-header"},[E("span",null,"安装信息")],-1)])),default:r(()=>[t(p,{column:2,border:""},{default:r(()=>[t(a,{label:"安装位置"},{default:r(()=>[o(n(e.currentMeter.installation_location||"未知"),1)]),_:1}),t(a,{label:"安装日期"},{default:r(()=>[o(n(e.formatDate(e.currentMeter.installation_date)),1)]),_:1}),t(a,{label:"所供区域"},{default:r(()=>[o(n(e.useAreaStore().getAreaNameById(e.currentMeter.area_id)||"未知"),1)]),_:1}),t(a,{label:"信号强度"},{default:r(()=>[o(n(e.currentMeter.CSQ),1)]),_:1}),t(a,{label:"经度"},{default:r(()=>[o(n(e.currentMeter.longitude||"未知"),1)]),_:1}),t(a,{label:"纬度"},{default:r(()=>[o(n(e.currentMeter.latitude||"未知"),1)]),_:1}),t(a,{label:"备注",span:2},{default:r(()=>[o(n(e.currentMeter.remarks||"无"),1)]),_:1})]),_:1})]),_:1}),E("div",ne,[t(e.BMap,{enableScrollWheelZoom:!0,ak:"Kwc6trl7dmb2Go3SM6S5QueuW0Foa0QN",center:{lng:e.currentMeter.longitude||108.94682,lat:e.currentMeter.latitude||34.26316},zoom:e.useCompanyStore().currentCompany.zoom-1||12},{default:r(()=>[t(e.BMarker,{position:{lng:e.currentMeter.longitude,lat:e.currentMeter.latitude}},null,8,["position"])]),_:1},8,["center","zoom"])])])),[[l,e.loading]]):(_(),Q(d,{key:0,description:"请先选择表计"})),t(k,{"destroy-on-close":"",title:e.currentMeter?"编辑表计":"新增表计","align-center":"",modelValue:e.dialogVisible,"onUpdate:modelValue":i[0]||(i[0]=s=>e.dialogVisible=s),width:"50%"},{default:r(()=>[t(e.MeterDialog,{"onUpdate:visible":e.handleUpdate,pMeter:e.parent_meter,id:e.currentMeter?e.currentMeter.id:null},null,8,["pMeter","id"])]),_:1},8,["title","modelValue"])],64)}const Be=z(ee,[["render",le],["__scopeId","data-v-769559d4"],["__file","D:/临时存放/green-carbon-1.0/src/views/DeviceCenter/DeviceInfo/components/DeviceInfo.vue"]]);export{Be as D};
