import{_ as Y,r as g,F as L,o as j,c as f,d as C,e as p,k as u,l as _,U as z,V as U,g as F,f as T,Y as G,N as Q,m as W,h as I,an as X,J as q,ai as K,cw as Z,am as $,v as ee}from"./index-DWtISIBF.js";import{E as te}from"./card-Cr9tAXzl.js";import{E as ae}from"./empty-CAh1XabF.js";import{E as ne}from"./input-B0bTKLmJ.js";/* empty css                */import{E as oe}from"./popper-BNb2tGl7.js";import{E as re}from"./button-DfREtLL_.js";import{g as k,c as O,d as R}from"./constant-C2yHPMd2.js";import{h as S}from"./handleError-BsBqXgSR.js";import{E}from"./index-CZh1RU_w.js";import{E as H}from"./index-BTG_XGfc.js";import{E as le}from"./index-CuP5NVML.js";import"./plugin-vue_export-helper-CqGSI99y.js";import"./use-form-item-CuJrx89H.js";import"./index-CVAPKPs0.js";import"./icon-Cc3ZZocH.js";import"./index-DibVzrKz.js";import"./aria-BUADUvnR.js";import"./focus-trap-D8pg8SM_.js";import"./index-DjvbDGpK.js";/* empty css             *//* empty css                        */import"./index-DYLzNb0k.js";import"./index-DxRU3L2W.js";import"./scroll-DMdoCUCr.js";import"./vnode-BIvhTfyw.js";import"./validator-CunO4hgy.js";const J=y=>{const n=[y],d=e=>{categories.value.filter(o=>o.part_of===e).forEach(o=>{n.push(o),d(o.id)})};return d(y.id),n},se={__name:"index",setup(y,{expose:n}){n();const d=g(!1),e=g(!1),v=g([]),o=g({}),m=g(null),i=g(""),x=g(null),B=L(()=>{const a={};a[1]=v.value.filter(t=>t.level===1).sort((t,c)=>t.sort-c.sort);for(let t=2;t<=4;t++){const c=o.value[t-1];c?a[t]=v.value.filter(l=>l.part_of===c.id).sort((l,P)=>l.sort-P.sort):a[t]=[]}return a}),D=a=>a===1?!0:o.value[a-1]!==void 0,N=(a,t)=>{var c;if(((c=o.value[t])==null?void 0:c.id)===a.id){o.value[t]=null;for(let l=t+1;l<=4;l++)o.value[l]=null}else{o.value[t]=a;for(let l=t+1;l<=4;l++)o.value[l]=null}},V=a=>{m.value=a,i.value="",K(()=>{x.value[0].focus()})},r=()=>{m.value=null,i.value=""},w=()=>{i.value||r()},b=async a=>{try{const t=J(a),c=t.length,l=c>1?`确认删除分类"${a.value}"及其${c-1}个子分类吗？删除后将无法恢复！`:`确认删除分类"${a.value}"吗？删除后将无法恢复！`;await H.confirm(l,"警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",dangerouslyUseHTMLString:!0}),await Promise.all(t.map(h=>R({id:""+h.id}))),E.success("删除成功"),await s();const P=a.level;for(let h=P;h<=4;h++)o.value[h]=null}catch(t){t!=="cancel"&&S(t,"删除失败",!0)}},s=async()=>{d.value=!0;try{const[a,t,c,l]=await Promise.all([k({level:1}),k({level:2}),k({level:3}),k({level:4})]);v.value=[...a.data,...t.data,...c.data,...l.data]}catch(a){S(a,"获取分类数据失败",!0)}finally{d.value=!1}},A=async()=>{var a;if(!i.value){E.warning("请输入分类名称");return}if(i.value.length<2||i.value.length>50){E.warning("分类名称长度应在 2 到 50 个字符之间");return}try{e.value=!0;const t={value:i.value,part_of:m.value===1?null:(a=o.value[m.value-1])==null?void 0:a.id,sort:0,level:m.value};await O(t),E.success("添加成功"),r(),await s()}catch(t){S(t,"添加失败",!0)}finally{e.value=!1}};j(()=>{s()});const M={loading:d,submitting:e,categories:v,selectedCategories:o,addingLevel:m,newCategoryName:i,inputRef:x,levelCategories:B,canAddSubCategory:D,handleCategoryClick:N,handleAddClick:V,cancelAdd:r,handleInputBlur:w,handleDelete:b,fetchAllCategories:s,handleSubmit:A,ref:g,computed:L,onMounted:j,nextTick:K,get ElMessage(){return E},get ElMessageBox(){return H},get Plus(){return Z},get Delete(){return $},get createCategoryApi(){return O},get deleteCategoryApi(){return R},get getCategoryApi(){return k},get handleError(){return S},get findAllSubCategories(){return J}};return Object.defineProperty(M,"__isScriptSetup",{enumerable:!1,value:!0}),M}},ie={class:"category-management"},ce={class:"category-levels"},de={class:"level-header"},ue={class:"category-list","element-loading-text":"加载中..."},me=["onClick"],ge={class:"category-name"},pe={class:"category-actions"},_e={key:1,class:"category-item adding"},fe={style:{width:"100%",display:"flex","justify-content":"center","align-items":"center"}};function ve(y,n,d,e,v,o){const m=le,i=re,x=oe,B=ne,D=ae,N=te,V=ee;return f(),C("div",ie,[n[4]||(n[4]=p("div",{class:"page-title"}," 分类管理 ",-1)),u(N,{class:"mb-4",shadow:"hover"},{default:_(()=>[p("div",ce,[(f(),C(z,null,U(4,r=>{var w,b;return p("div",{key:r,class:"level-panel"},[p("div",de,[p("h3",null,F(r)+"级分类",1),u(i,{type:"primary",size:"small",onClick:s=>e.handleAddClick(r),disabled:!e.canAddSubCategory(r)},{default:_(()=>[u(m,null,{default:_(()=>[u(e.Plus)]),_:1}),n[1]||(n[1]=T("添加 "))]),_:2},1032,["onClick","disabled"])]),G((f(),C("div",ue,[(w=e.levelCategories[r])!=null&&w.length?(f(!0),C(z,{key:0},U(e.levelCategories[r],s=>{var A;return f(),C("div",{onClick:M=>e.handleCategoryClick(s,r),key:s.id,class:Q(["category-item",{active:((A=e.selectedCategories[r])==null?void 0:A.id)===s.id}])},[p("span",ge,F(s.value),1),p("div",pe,[u(x,{content:"删除",placement:"top"},{default:_(()=>[u(m,{class:"action-icon delete",onClick:W(M=>e.handleDelete(s),["stop"])},{default:_(()=>[u(e.Delete)]),_:2},1032,["onClick"])]),_:2},1024)])],10,me)}),128)):I("",!0),e.addingLevel===r?(f(),C("div",_e,[u(B,{ref_for:!0,ref:"inputRef",modelValue:e.newCategoryName,"onUpdate:modelValue":n[0]||(n[0]=s=>e.newCategoryName=s),modelModifiers:{trim:!0},placeholder:"请输入分类名称",size:"small",maxlength:"50","validate-event":!1,onKeyup:X(e.handleSubmit,["enter"]),onBlur:e.handleInputBlur},{append:_(()=>[u(i,{style:{"margin-right":"1px"},onClick:e.handleSubmit,loading:e.submitting},{default:_(()=>[...n[2]||(n[2]=[T(" 确定 ")])]),_:1},8,["loading"]),u(i,{onClick:e.cancelAdd},{default:_(()=>[...n[3]||(n[3]=[T(" 取消 ")])]),_:1})]),_:1},8,["modelValue"])])):I("",!0),p("div",fe,[u(i,{icon:"plus",type:"primary",onClick:s=>e.handleAddClick(r),circle:""},null,8,["onClick"])]),(b=e.levelCategories[r])!=null&&b.length?I("",!0):(f(),q(D,{key:2,description:"暂无数据"}))])),[[V,e.loading]])])}),64))])]),_:1})])}const ye=Y(se,[["render",ve],["__scopeId","data-v-48347781"],["__file","D:/临时存放/green-carbon-1.0/src/views/SystemManagement/ConstantManagement/CategoryManagement/index.vue"]]),Ce={__name:"index",setup(y,{expose:n}){n();const d={CategoryManagement:ye};return Object.defineProperty(d,"__isScriptSetup",{enumerable:!1,value:!0}),d}};function he(y,n,d,e,v,o){return f(),q(e.CategoryManagement)}const Ge=Y(Ce,[["render",he],["__file","D:/临时存放/green-carbon-1.0/src/views/SystemManagement/ConstantManagement/index.vue"]]);export{Ge as default};
