import{z as W,ao as Y,D as U,ap as Z,E as ee,r as _,F as M,H as te,c as m,J as S,j as l,e as o,N as b,I as n,n as oe,K as ne,h as w,f as x,g as C,M as D,i,al as se,O as le,_ as ae,s as re,l as ie,d as $,V as R,X as ce,v as pe}from"./index-oALI6hjD.js";import{E as ue}from"./dialog-B_GDP7gC.js";import"./overlay-WqKCga-H.js";import{_ as fe}from"./MeterDialog-CsgwRA3M.js";import{E as de}from"./tree-DFq1abUa.js";import"./checkbox-eAiA7KBF.js";import{u as A,E as j}from"./popper-8tqvLSZz.js";import{b as z,E as L}from"./button-CW4VZptJ.js";/* empty css                */import{u as me,k as ve}from"./meter-GWsXRyue.js";/* empty css             *//* empty css                 */import{E}from"./index-CV7ElbEQ.js";import{E as ye}from"./index-DXOgsKzf.js";import{i as _e}from"./icon-DFUaFmZd.js";import{_ as he}from"./plugin-vue_export-helper-CqGSI99y.js";const ge=W({title:String,confirmButtonText:String,cancelButtonText:String,confirmButtonType:{type:String,values:z,default:"primary"},cancelButtonType:{type:String,values:z,default:"text"},icon:{type:_e,default:()=>Y},iconColor:{type:String,default:"#f90"},hideIcon:{type:Boolean,default:!1},hideAfter:{type:Number,default:200},teleported:A.teleported,persistent:A.persistent,width:{type:[String,Number],default:150}}),ke={confirm:c=>c instanceof MouseEvent,cancel:c=>c instanceof MouseEvent},Ce=U({name:"ElPopconfirm"}),Te=U({...Ce,props:ge,emits:ke,setup(c,{emit:P}){const p=c,{t:T}=Z(),a=ee("popconfirm"),v=_(),r=()=>{var e,k;(k=(e=v.value)==null?void 0:e.onClose)==null||k.call(e)},u=M(()=>({width:te(p.width)})),y=e=>{P("confirm",e),r()},h=e=>{P("cancel",e),r()},N=M(()=>p.confirmButtonText||T("el.popconfirm.confirmButtonText")),g=M(()=>p.cancelButtonText||T("el.popconfirm.cancelButtonText"));return(e,k)=>(m(),S(n(j),se({ref_key:"tooltipRef",ref:v,trigger:"click",effect:"light"},e.$attrs,{"popper-class":`${n(a).namespace.value}-popover`,"popper-style":n(u),teleported:e.teleported,"fallback-placements":["bottom","top","right","left"],"hide-after":e.hideAfter,persistent:e.persistent}),{content:l(()=>[o("div",{class:b(n(a).b())},[o("div",{class:b(n(a).e("main"))},[!e.hideIcon&&e.icon?(m(),S(n(ye),{key:0,class:b(n(a).e("icon")),style:oe({color:e.iconColor})},{default:l(()=>[(m(),S(ne(e.icon)))]),_:1},8,["class","style"])):w("v-if",!0),x(" "+C(e.title),1)],2),o("div",{class:b(n(a).e("action"))},[D(e.$slots,"actions",{confirm:y,cancel:h},()=>[i(n(L),{size:"small",type:e.cancelButtonType==="text"?"":e.cancelButtonType,text:e.cancelButtonType==="text",onClick:h},{default:l(()=>[x(C(n(g)),1)]),_:1},8,["type","text"]),i(n(L),{size:"small",type:e.confirmButtonType==="text"?"":e.confirmButtonType,text:e.confirmButtonType==="text",onClick:y},{default:l(()=>[x(C(n(N)),1)]),_:1},8,["type","text"])])],2)],2)]),default:l(()=>[e.$slots.reference?D(e.$slots,"reference",{key:0}):w("v-if",!0)]),_:3},16,["popper-class","popper-style","teleported","hide-after","persistent"]))}});var Be=he(Te,[["__file","popconfirm.vue"]]);const be=le(Be),Ee={class:"tree-wrapper"},Me={class:"tree-container"},Se={class:"header"},we={class:"company-name"},Pe={key:0,class:"header-actions"},Ne={class:"custom-tree-node"},xe={class:"node-label"},$e={key:0,class:"node-actions"},Ie=["onClick"],Ve={__name:"MeterTree",props:{data:{type:Array,default:()=>[]}},setup(c){const p=re().hasPermission("manage_device"),T=ie(),a=M(()=>T.name==="DeviceInfo"),v=_(!1),r=_(!1),u=_(null),y=_(null),h=_(null),N={id:"id",children:"children",label:"label"};let g=me();function e(s){y.value=s,u.value=null,r.value=!0}function k(){y.value={id:0,label:"根节点",type:0},u.value=null,r.value=!0}function q(s){s&&g.setCurrentMeter(s)}function F(s,t){if(t&&t.id){let f=[t.id];I(f)}}const H=()=>{var f;const t=(((f=h.value)==null?void 0:f.getCheckedNodes(!1,!1))||[]).map(B=>B.id).filter(Boolean);t.length>0&&I(t)};function I(s){!Array.isArray(s)||s.length===0||ve(s).then(t=>{t.code===200?(E.success("删除成功"),g.fetchMeterList()):(console.error(t.message),E.error(t.message||"删除失败"))}).catch(t=>{console.error(t),E.error("删除失败")})}const J=async()=>{v.value=!0;try{await g.fetchMeterList()}catch(s){console.error("刷新失败:",s),E.error("刷新失败")}finally{v.value=!1}};return(s,t)=>{const f=j,B=be,K=de,O=fe,X=ue,G=pe;return m(),$("div",Ee,[o("div",Me,[o("div",Se,[i(f,{content:n(R)().currentCompany.name,placement:"top","show-after":500},{default:l(()=>[o("span",we,C(n(R)().currentCompany.name),1)]),_:1},8,["content"]),a.value&&n(p)?(m(),$("div",Pe,[o("a",{type:"primary",onClick:k},t[2]||(t[2]=[o("i",{class:"fa fa-plus"},null,-1)])),i(B,{placement:"top",title:"确定删除勾选的表计吗？",onConfirm:H},{reference:l(()=>t[3]||(t[3]=[o("a",null,[o("i",{class:"fa fa-minus"})],-1)])),_:1}),o("a",{type:"primary",onClick:J},t[4]||(t[4]=[o("i",{class:"fa fa-refresh"},null,-1)]))])):w("",!0)]),ce((m(),S(K,{onNodeClick:q,style:{display:"inline-block",width:"100%"},"element-loading-text":"loading...","show-checkbox":a.value&&n(p),ref_key:"treeRef",ref:h,indent:10,class:"eye-tree",data:c.data,props:N,"node-key":"id","highlight-current":!0,"default-expand-all":!0,"expand-on-click-node":!1},{default:l(({node:d,data:V})=>[o("div",Ne,[i(f,{content:d.label,placement:"top","show-after":500},{default:l(()=>[o("span",xe,C(d.label),1)]),_:2},1032,["content"]),a.value&&n(p)?(m(),$("span",$e,[o("a",{onClick:Q=>e(V)},t[5]||(t[5]=[o("i",{class:"fa fa-plus"},null,-1)]),8,Ie),i(B,{placement:"top",title:`确定删除${d.label}表计吗？`,onConfirm:Q=>F(d,V)},{reference:l(()=>t[6]||(t[6]=[o("a",null,[o("i",{class:"fa fa-minus"})],-1)])),_:2},1032,["title","onConfirm"])])):w("",!0)])]),_:1},8,["show-checkbox","data"])),[[G,v.value]]),i(X,{title:u.value?"编辑表计":"新增表计","destroy-on-close":"","align-center":"",modelValue:r.value,"onUpdate:modelValue":t[1]||(t[1]=d=>r.value=d)},{default:l(()=>[i(O,{"onUpdate:visible":t[0]||(t[0]=d=>r.value=!1),pMeter:y.value,id:u.value?+u.value.meter_id:null},null,8,["pMeter","id"])]),_:1},8,["title","modelValue"])])])}}},We=ae(Ve,[["__scopeId","data-v-ffbf6333"]]);export{We as M};
