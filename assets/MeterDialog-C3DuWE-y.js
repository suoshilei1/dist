import{D as ve,E as fe,aq as Pa,at as oa,au as ra,av as Fa,aw as ia,F as V,m as ee,c as b,d as U,h as te,J as A,k as be,j as m,e as ae,i as h,N as B,U as ne,ap as ua,r as T,V as ue,f as re,g as de,M as Se,ax as Aa,ay as xe,az as We,aA as xa,ar as je,z as da,C as ce,aB as Ba,aC as Ua,a as Ze,w as ie,aD as za,o as Ue,ac as pe,aE as ca,O as pa,a7 as qa,aF as Oa,a8 as Ha,aG as Ka,aH as Ra,aI as Wa,Y as ge,I as p,n as ja,aJ as Za,aK as Ga,ai as Ya,aL as Ja,ah as Xa,a2 as Ge,_ as Qa,W as Ye,v as et}from"./index-Bx6Y8L80.js";import{b as at,E as tt,a as lt}from"./form-item-CWYWsPGl.js";import{E as nt}from"./button-8bviUT_H.js";import{E as fa}from"./input-CFaQgGx5.js";import{a as st,u as ot,E as Je}from"./popper-DBn8ulUn.js";/* empty css            */import{E as rt}from"./checkbox-LjaCbo-5.js";/* empty css              */import{E as ma,d as it}from"./scrollbar-DuXO1tWo.js";import{u as Xe,c as Qe,E as ut}from"./date-picker-CfUXe-Kp.js";import{E as va,a as dt}from"./radio-group-i8YIvWc2.js";import{c as ea,E as ct,a as pt}from"./select-BmMHn9PT.js";import{u as ft,e as mt,o as vt,l as ht}from"./meter-5sbrBbgq.js";import{u as gt}from"./area-COPnz-hV.js";import{g as bt}from"./formula-ClsumsYI.js";import{h as aa}from"./handleError-DD4JYoq7.js";import{g as Ne}from"./constant-Dm8qiNaG.js";import{S as yt}from"./constants-NVab_QuI.js";/* empty css             *//* empty css                 */import{E as Ee}from"./index-KJp6TXG9.js";import{c as _t,U as we,C as $e,d as kt,b as Ct,e as Nt}from"./index-CuyxIfpa.js";import{E as ye}from"./index-A4BGBRGh.js";import{_ as Te}from"./plugin-vue_export-helper-CqGSI99y.js";import{u as Et,c as Vt,a as St}from"./use-form-item-50hJ8Ppj.js";import{i as _e}from"./isEqual-BM-Gj-iT.js";import{i as wt,f as Ve,g as ha}from"./focus-trap-Ddg061Nm.js";import{s as $t}from"./scroll-BawlEUY1.js";import{E as G}from"./aria-BUADUvnR.js";import{t as ta,E as la}from"./index-aFn2MKle.js";import{u as Tt}from"./index-iw6eP590.js";import{C as Mt}from"./index-zrRcpBp4.js";var Lt=1,It=4;function ga(e){return at(e,Lt|It)}var Dt=1/0;function Pt(e){var n=e==null?0:e.length;return n?_t(e,Dt):[]}var Ft=ve({name:"NodeContent",setup(){return{ns:fe("cascader-node")}},render(){const{ns:e}=this,{node:n,panel:l}=this.$parent,{data:s,label:r}=n,{renderLabelFn:v}=l;return Pa("span",{class:e.e("label")},v?v({node:n,data:s}):r)}});const ze=Symbol(),At=ve({name:"ElCascaderNode",components:{ElCheckbox:rt,ElRadio:va,NodeContent:Ft,ElIcon:ye,Check:oa,Loading:ra,ArrowRight:Fa},props:{node:{type:Object,required:!0},menuId:String},emits:["expand"],setup(e,{emit:n}){const l=ia(ze),s=fe("cascader-node"),r=V(()=>l.isHoverMenu),v=V(()=>l.config.multiple),d=V(()=>l.config.checkStrictly),_=V(()=>{var w;return(w=l.checkedNodes[0])==null?void 0:w.uid}),t=V(()=>e.node.isDisabled),E=V(()=>e.node.isLeaf),S=V(()=>d.value&&!E.value||!t.value),x=V(()=>Y(l.expandingNode)),F=V(()=>d.value&&l.checkedNodes.some(Y)),Y=w=>{var P;const{level:j,uid:y}=e.node;return((P=w==null?void 0:w.pathNodes[j-1])==null?void 0:P.uid)===y},R=()=>{x.value||l.expandNode(e.node)},q=w=>{const{node:P}=e;w!==P.checked&&l.handleCheckChange(P,w)},O=()=>{l.lazyLoad(e.node,()=>{E.value||R()})},H=w=>{r.value&&(J(),!E.value&&n("expand",w))},J=()=>{const{node:w}=e;!S.value||w.loading||(w.loaded?R():O())},I=()=>{r.value&&!E.value||(E.value&&!t.value&&!d.value&&!v.value?D(!0):J())},X=w=>{d.value?(q(w),e.node.loaded&&R()):D(w)},D=w=>{e.node.loaded?(q(w),!d.value&&R()):O()};return{panel:l,isHoverMenu:r,multiple:v,checkStrictly:d,checkedNodeId:_,isDisabled:t,isLeaf:E,expandable:S,inExpandingPath:x,inCheckedPath:F,ns:s,handleHoverExpand:H,handleExpand:J,handleClick:I,handleCheck:D,handleSelectCheck:X}}});function xt(e,n,l,s,r,v){const d=ee("el-checkbox"),_=ee("el-radio"),t=ee("check"),E=ee("el-icon"),S=ee("node-content"),x=ee("loading"),F=ee("arrow-right");return b(),U("li",{id:`${e.menuId}-${e.node.uid}`,role:"menuitem","aria-haspopup":!e.isLeaf,"aria-owns":e.isLeaf?null:e.menuId,"aria-expanded":e.inExpandingPath,tabindex:e.expandable?-1:void 0,class:B([e.ns.b(),e.ns.is("selectable",e.checkStrictly),e.ns.is("active",e.node.checked),e.ns.is("disabled",!e.expandable),e.inExpandingPath&&"in-active-path",e.inCheckedPath&&"in-checked-path"]),onMouseenter:e.handleHoverExpand,onFocus:e.handleHoverExpand,onClick:e.handleClick},[te(" prefix "),e.multiple?(b(),A(d,{key:0,"model-value":e.node.checked,indeterminate:e.node.indeterminate,disabled:e.isDisabled,onClick:be(()=>{},["stop"]),"onUpdate:modelValue":e.handleSelectCheck},null,8,["model-value","indeterminate","disabled","onClick","onUpdate:modelValue"])):e.checkStrictly?(b(),A(_,{key:1,"model-value":e.checkedNodeId,label:e.node.uid,disabled:e.isDisabled,"onUpdate:modelValue":e.handleSelectCheck,onClick:be(()=>{},["stop"])},{default:m(()=>[te(`
        Add an empty element to avoid render label,
        do not use empty fragment here for https://github.com/vuejs/vue-next/pull/2485
      `),ae("span")]),_:1},8,["model-value","label","disabled","onUpdate:modelValue","onClick"])):e.isLeaf&&e.node.checked?(b(),A(E,{key:2,class:B(e.ns.e("prefix"))},{default:m(()=>[h(t)]),_:1},8,["class"])):te("v-if",!0),te(" content "),h(S),te(" postfix "),e.isLeaf?te("v-if",!0):(b(),U(ne,{key:3},[e.node.loading?(b(),A(E,{key:0,class:B([e.ns.is("loading"),e.ns.e("postfix")])},{default:m(()=>[h(x)]),_:1},8,["class"])):(b(),A(E,{key:1,class:B(["arrow-right",e.ns.e("postfix")])},{default:m(()=>[h(F)]),_:1},8,["class"]))],64))],42,["id","aria-haspopup","aria-owns","aria-expanded","tabindex","onMouseenter","onFocus","onClick"])}var Bt=Te(At,[["render",xt],["__file","node.vue"]]);const Ut=ve({name:"ElCascaderMenu",components:{Loading:ra,ElIcon:ye,ElScrollbar:ma,ElCascaderNode:Bt},props:{nodes:{type:Array,required:!0},index:{type:Number,required:!0}},setup(e){const n=Aa(),l=fe("cascader-menu"),{t:s}=ua(),r=Et();let v=null,d=null;const _=ia(ze),t=T(null),E=V(()=>!e.nodes.length),S=V(()=>!_.initialLoaded),x=V(()=>`${r.value}-${e.index}`),F=O=>{v=O.target},Y=O=>{if(!(!_.isHoverMenu||!v||!t.value))if(v.contains(O.target)){R();const H=n.vnode.el,{left:J}=H.getBoundingClientRect(),{offsetWidth:I,offsetHeight:X}=H,D=O.clientX-J,w=v.offsetTop,P=w+v.offsetHeight;t.value.innerHTML=`
          <path style="pointer-events: auto;" fill="transparent" d="M${D} ${w} L${I} 0 V${w} Z" />
          <path style="pointer-events: auto;" fill="transparent" d="M${D} ${P} L${I} ${X} V${P} Z" />
        `}else d||(d=window.setTimeout(q,_.config.hoverThreshold))},R=()=>{d&&(clearTimeout(d),d=null)},q=()=>{t.value&&(t.value.innerHTML="",R())};return{ns:l,panel:_,hoverZone:t,isEmpty:E,isLoading:S,menuId:x,t:s,handleExpand:F,handleMouseMove:Y,clearHoverZone:q}}});function zt(e,n,l,s,r,v){const d=ee("el-cascader-node"),_=ee("loading"),t=ee("el-icon"),E=ee("el-scrollbar");return b(),A(E,{key:e.menuId,tag:"ul",role:"menu",class:B(e.ns.b()),"wrap-class":e.ns.e("wrap"),"view-class":[e.ns.e("list"),e.ns.is("empty",e.isEmpty)],onMousemove:e.handleMouseMove,onMouseleave:e.clearHoverZone},{default:m(()=>{var S;return[(b(!0),U(ne,null,ue(e.nodes,x=>(b(),A(d,{key:x.uid,node:x,"menu-id":e.menuId,onExpand:e.handleExpand},null,8,["node","menu-id","onExpand"]))),128)),e.isLoading?(b(),U("div",{key:0,class:B(e.ns.e("empty-text"))},[h(t,{size:"14",class:B(e.ns.is("loading"))},{default:m(()=>[h(_)]),_:1},8,["class"]),re(" "+de(e.t("el.cascader.loading")),1)],2)):e.isEmpty?(b(),U("div",{key:1,class:B(e.ns.e("empty-text"))},[Se(e.$slots,"empty",{},()=>[re(de(e.t("el.cascader.noData")),1)])],2)):(S=e.panel)!=null&&S.isHoverMenu?(b(),U("svg",{key:2,ref:"hoverZone",class:B(e.ns.e("hover-zone"))},null,2)):te("v-if",!0)]}),_:3},8,["class","wrap-class","view-class","onMousemove","onMouseleave"])}var qt=Te(Ut,[["render",zt],["__file","menu.vue"]]);let Ot=0;const Ht=e=>{const n=[e];let{parent:l}=e;for(;l;)n.unshift(l),l=l.parent;return n};class me{constructor(n,l,s,r=!1){this.data=n,this.config=l,this.parent=s,this.root=r,this.uid=Ot++,this.checked=!1,this.indeterminate=!1,this.loading=!1;const{value:v,label:d,children:_}=l,t=n[_],E=Ht(this);this.level=r?0:s?s.level+1:1,this.value=n[v],this.label=n[d],this.pathNodes=E,this.pathValues=E.map(S=>S.value),this.pathLabels=E.map(S=>S.label),this.childrenData=t,this.children=(t||[]).map(S=>new me(S,l,this)),this.loaded=!l.lazy||this.isLeaf||!xe(t)}get isDisabled(){const{data:n,parent:l,config:s}=this,{disabled:r,checkStrictly:v}=s;return(We(r)?r(n,this):!!n[r])||!v&&(l==null?void 0:l.isDisabled)}get isLeaf(){const{data:n,config:l,childrenData:s,loaded:r}=this,{lazy:v,leaf:d}=l,_=We(d)?d(n,this):n[d];return xa(_)?v&&!r?!1:!(je(s)&&s.length):!!_}get valueByOption(){return this.config.emitPath?this.pathValues:this.value}appendChild(n){const{childrenData:l,children:s}=this,r=new me(n,this.config,this);return je(l)?l.push(n):this.childrenData=[n],s.push(r),r}calcText(n,l){const s=n?this.pathLabels.join(l):this.label;return this.text=s,s}broadcast(n,...l){const s=`onParent${ea(n)}`;this.children.forEach(r=>{r&&(r.broadcast(n,...l),r[s]&&r[s](...l))})}emit(n,...l){const{parent:s}=this,r=`onChild${ea(n)}`;s&&(s[r]&&s[r](...l),s.emit(n,...l))}onParentCheck(n){this.isDisabled||this.setCheckState(n)}onChildCheck(){const{children:n}=this,l=n.filter(r=>!r.isDisabled),s=l.length?l.every(r=>r.checked):!1;this.setCheckState(s)}setCheckState(n){const l=this.children.length,s=this.children.reduce((r,v)=>{const d=v.checked?1:v.indeterminate?.5:0;return r+d},0);this.checked=this.loaded&&this.children.filter(r=>!r.isDisabled).every(r=>r.loaded&&r.checked)&&n,this.indeterminate=this.loaded&&s!==l&&s>0}doCheck(n){if(this.checked===n)return;const{checkStrictly:l,multiple:s}=this.config;l||!s?this.checked=n:(this.broadcast("check",n),this.setCheckState(n),this.emit("check"))}}const Be=(e,n)=>e.reduce((l,s)=>(s.isLeaf?l.push(s):(!n&&l.push(s),l=l.concat(Be(s.children,n))),l),[]);class na{constructor(n,l){this.config=l;const s=(n||[]).map(r=>new me(r,this.config));this.nodes=s,this.allNodes=Be(s,!1),this.leafNodes=Be(s,!0)}getNodes(){return this.nodes}getFlattedNodes(n){return n?this.leafNodes:this.allNodes}appendNode(n,l){const s=l?l.appendChild(n):new me(n,this.config);l||this.nodes.push(s),this.allNodes.push(s),s.isLeaf&&this.leafNodes.push(s)}appendNodes(n,l){n.forEach(s=>this.appendNode(s,l))}getNodeByValue(n,l=!1){return!n&&n!==0?null:this.getFlattedNodes(l).find(r=>_e(r.value,n)||_e(r.pathValues,n))||null}getSameNode(n){return n&&this.getFlattedNodes(!1).find(({value:s,level:r})=>_e(n.value,s)&&n.level===r)||null}}const ba=da({modelValue:{type:ce([Number,String,Array])},options:{type:ce(Array),default:()=>[]},props:{type:ce(Object),default:()=>({})}}),Kt={expandTrigger:"click",multiple:!1,checkStrictly:!1,emitPath:!0,lazy:!1,lazyLoad:Ba,value:"value",label:"label",children:"children",leaf:"leaf",disabled:"disabled",hoverThreshold:500},Rt=e=>V(()=>({...Kt,...e.props})),sa=e=>{if(!e)return 0;const n=e.id.split("-");return Number(n[n.length-2])},Wt=e=>{if(!e)return;const n=e.querySelector("input");n?n.click():wt(e)&&e.click()},jt=(e,n)=>{const l=n.slice(0),s=l.map(v=>v.uid),r=e.reduce((v,d)=>{const _=s.indexOf(d.uid);return _>-1&&(v.push(d),l.splice(_,1),s.splice(_,1)),v},[]);return r.push(...l),r},Zt=ve({name:"ElCascaderPanel",components:{ElCascaderMenu:qt},props:{...ba,border:{type:Boolean,default:!0},renderLabel:Function},emits:[we,$e,"close","expand-change"],setup(e,{emit:n,slots:l}){let s=!1;const r=fe("cascader"),v=Rt(e);let d=null;const _=T(!0),t=T([]),E=T(null),S=T([]),x=T(null),F=T([]),Y=V(()=>v.value.expandTrigger==="hover"),R=V(()=>e.renderLabel||l.default),q=()=>{const{options:o}=e,g=v.value;s=!1,d=new na(o,g),S.value=[d.getNodes()],g.lazy&&xe(e.options)?(_.value=!1,O(void 0,k=>{k&&(d=new na(k,g),S.value=[d.getNodes()]),_.value=!0,j(!1,!0)})):j(!1,!0)},O=(o,g)=>{const k=v.value;o=o||new me({},k,void 0,!0),o.loading=!0;const C=$=>{const M=o,K=M.root?null:M;$&&(d==null||d.appendNodes($,K)),M.loading=!1,M.loaded=!0,M.childrenData=M.childrenData||[],g&&g($)};k.lazyLoad(o,C)},H=(o,g)=>{var k;const{level:C}=o,$=S.value.slice(0,C);let M;o.isLeaf?M=o.pathNodes[C-2]:(M=o,$.push(o.children)),((k=x.value)==null?void 0:k.uid)!==(M==null?void 0:M.uid)&&(x.value=o,S.value=$,!g&&n("expand-change",(o==null?void 0:o.pathValues)||[]))},J=(o,g,k=!0)=>{const{checkStrictly:C,multiple:$}=v.value,M=F.value[0];s=!0,!$&&(M==null||M.doCheck(!1)),o.doCheck(g),P(),k&&!$&&!C&&n("close"),!k&&!$&&!C&&I(o)},I=o=>{o&&(o=o.parent,I(o),o&&H(o))},X=o=>d==null?void 0:d.getFlattedNodes(o),D=o=>{var g;return(g=X(o))==null?void 0:g.filter(k=>k.checked!==!1)},w=()=>{F.value.forEach(o=>o.doCheck(!1)),P(),S.value=S.value.slice(0,1),x.value=null,n("expand-change",[])},P=()=>{var o;const{checkStrictly:g,multiple:k}=v.value,C=F.value,$=D(!g),M=jt(C,$),K=M.map(z=>z.valueByOption);F.value=M,E.value=k?K:(o=K[0])!=null?o:null},j=(o=!1,g=!1)=>{const{modelValue:k}=e,{lazy:C,multiple:$,checkStrictly:M}=v.value,K=!M;if(!(!_.value||s||!g&&_e(k,E.value)))if(C&&!o){const W=Xe(Pt(Qe(k))).map(Z=>d==null?void 0:d.getNodeByValue(Z)).filter(Z=>!!Z&&!Z.loaded&&!Z.loading);W.length?W.forEach(Z=>{O(Z,()=>j(!1,g))}):j(!0,g)}else{const z=$?Qe(k):[k],W=Xe(z.map(Z=>d==null?void 0:d.getNodeByValue(Z,K)));y(W,g),E.value=ga(k)}},y=(o,g=!0)=>{const{checkStrictly:k}=v.value,C=F.value,$=o.filter(z=>!!z&&(k||z.isLeaf)),M=d==null?void 0:d.getSameNode(x.value),K=g&&M||$[0];K?K.pathNodes.forEach(z=>H(z,!0)):x.value=null,C.forEach(z=>z.doCheck(!1)),Ze($).forEach(z=>z.doCheck(!0)),F.value=$,pe(i)},i=()=>{ca&&t.value.forEach(o=>{const g=o==null?void 0:o.$el;if(g){const k=g.querySelector(`.${r.namespace.value}-scrollbar__wrap`),C=g.querySelector(`.${r.b("node")}.${r.is("active")}`)||g.querySelector(`.${r.b("node")}.in-active-path`);$t(k,C)}})},N=o=>{const g=o.target,{code:k}=o;switch(k){case G.up:case G.down:{o.preventDefault();const C=k===G.up?-1:1;Ve(ha(g,C,`.${r.b("node")}[tabindex="-1"]`));break}case G.left:{o.preventDefault();const C=t.value[sa(g)-1],$=C==null?void 0:C.$el.querySelector(`.${r.b("node")}[aria-expanded="true"]`);Ve($);break}case G.right:{o.preventDefault();const C=t.value[sa(g)+1],$=C==null?void 0:C.$el.querySelector(`.${r.b("node")}[tabindex="-1"]`);Ve($);break}case G.enter:Wt(g);break}};return Ua(ze,Ze({config:v,expandingNode:x,checkedNodes:F,isHoverMenu:Y,initialLoaded:_,renderLabelFn:R,lazyLoad:O,expandNode:H,handleCheckChange:J})),ie([v,()=>e.options],q,{deep:!0,immediate:!0}),ie(()=>e.modelValue,()=>{s=!1,j()},{deep:!0}),ie(()=>E.value,o=>{_e(o,e.modelValue)||(n(we,o),n($e,o))}),za(()=>t.value=[]),Ue(()=>!xe(e.modelValue)&&j()),{ns:r,menuList:t,menus:S,checkedNodes:F,handleKeyDown:N,handleCheckChange:J,getFlattedNodes:X,getCheckedNodes:D,clearCheckedNodes:w,calculateCheckedValue:P,scrollToExpandingNode:i}}});function Gt(e,n,l,s,r,v){const d=ee("el-cascader-menu");return b(),U("div",{class:B([e.ns.b("panel"),e.ns.is("bordered",e.border)]),onKeydown:e.handleKeyDown},[(b(!0),U(ne,null,ue(e.menus,(_,t)=>(b(),A(d,{key:t,ref_for:!0,ref:E=>e.menuList[t]=E,index:t,nodes:[..._]},{empty:m(()=>[Se(e.$slots,"empty")]),_:2},1032,["index","nodes"]))),128))],42,["onKeydown"])}var Yt=Te(Zt,[["render",Gt],["__file","index.vue"]]);const Jt=pa(Yt),Xt=da({...ba,size:qa,placeholder:String,disabled:Boolean,clearable:Boolean,filterable:Boolean,filterMethod:{type:ce(Function),default:(e,n)=>e.text.includes(n)},separator:{type:String,default:" / "},showAllLevels:{type:Boolean,default:!0},collapseTags:Boolean,maxCollapseTags:{type:Number,default:1},collapseTagsTooltip:{type:Boolean,default:!1},debounce:{type:Number,default:300},beforeFilter:{type:ce(Function),default:()=>!0},placement:{type:ce(String),values:st,default:"bottom-start"},fallbackPlacements:{type:ce(Array),default:["bottom-start","bottom","top-start","top","right","left"]},popperClass:{type:String,default:""},teleported:ot.teleported,tagType:{...ta.type,default:"info"},tagEffect:{...ta.effect,default:"light"},validateEvent:{type:Boolean,default:!0},persistent:{type:Boolean,default:!0},...Oa}),Qt={[we]:e=>!0,[$e]:e=>!0,focus:e=>e instanceof FocusEvent,blur:e=>e instanceof FocusEvent,clear:()=>!0,visibleChange:e=>Ha(e),expandChange:e=>!!e,removeTag:e=>!!e},el="ElCascader",al=ve({name:el}),tl=ve({...al,props:Xt,emits:Qt,setup(e,{expose:n,emit:l}){const s=e,r={modifiers:[{name:"arrowPosition",enabled:!0,phase:"main",fn:({state:a})=>{const{modifiersData:u,placement:c}=a;["right","left","bottom","top"].includes(c)||(u.arrow.x=35)},requires:["arrow"]}]},v=Ka();let d=0,_=0;const t=fe("cascader"),E=fe("input"),{t:S}=ua(),{form:x,formItem:F}=Vt(),{valueOnClear:Y}=Ra(s),{isComposing:R,handleComposition:q}=Tt({afterComposition(a){var u;const c=(u=a.target)==null?void 0:u.value;Ae(c)}}),O=T(null),H=T(null),J=T(null),I=T(null),X=T(null),D=T(!1),w=T(!1),P=T(!1),j=T(!1),y=T(""),i=T(""),N=T([]),o=T([]),g=T([]),k=V(()=>v.style),C=V(()=>s.disabled||(x==null?void 0:x.disabled)),$=V(()=>s.placeholder||S("el.cascader.placeholder")),M=V(()=>i.value||N.value.length>0||R.value?"":$.value),K=St(),z=V(()=>["small"].includes(K.value)?"small":"default"),W=V(()=>!!s.props.multiple),Z=V(()=>!s.filterable||W.value),f=V(()=>W.value?i.value:y.value),ke=V(()=>{var a;return((a=I.value)==null?void 0:a.checkedNodes)||[]}),ya=V(()=>!s.clearable||C.value||P.value||!w.value?!1:!!ke.value.length),Ce=V(()=>{const{showAllLevels:a,separator:u}=s,c=ke.value;return c.length?W.value?"":c[0].calcText(a,u):""}),_a=V(()=>(F==null?void 0:F.validateState)||""),Me=V({get(){return ga(s.modelValue)},set(a){const u=a??Y.value;l(we,u),l($e,u),s.validateEvent&&(F==null||F.validate("change").catch(c=>kt()))}}),ka=V(()=>[t.b(),t.m(K.value),t.is("disabled",C.value),v.class]),Ca=V(()=>[E.e("icon"),"icon-arrow-down",t.is("reverse",D.value)]),Na=V(()=>t.is("focus",D.value||j.value)),qe=V(()=>{var a,u;return(u=(a=O.value)==null?void 0:a.popperRef)==null?void 0:u.contentRef}),Q=a=>{var u,c,L;C.value||(a=a??!D.value,a!==D.value&&(D.value=a,(c=(u=H.value)==null?void 0:u.input)==null||c.setAttribute("aria-expanded",`${a}`),a?(he(),pe((L=I.value)==null?void 0:L.scrollToExpandingNode)):s.filterable&&Fe(),l("visibleChange",a)))},he=()=>{pe(()=>{var a;(a=O.value)==null||a.updatePopper()})},Le=()=>{P.value=!1},Ie=a=>{const{showAllLevels:u,separator:c}=s;return{node:a,key:a.uid,text:a.calcText(u,c),hitState:!1,closable:!C.value&&!a.isDisabled,isCollapseTag:!1}},De=a=>{var u;const c=a.node;c.doCheck(!1),(u=I.value)==null||u.calculateCheckedValue(),l("removeTag",c.valueByOption)},Ea=()=>{if(!W.value)return;const a=ke.value,u=[],c=[];if(a.forEach(L=>c.push(Ie(L))),o.value=c,a.length){a.slice(0,s.maxCollapseTags).forEach(le=>u.push(Ie(le)));const L=a.slice(s.maxCollapseTags),se=L.length;se&&(s.collapseTags?u.push({key:-1,text:`+ ${se}`,closable:!1,isCollapseTag:!0}):L.forEach(le=>u.push(Ie(le))))}N.value=u},Oe=()=>{var a,u;const{filterMethod:c,showAllLevels:L,separator:se}=s,le=(u=(a=I.value)==null?void 0:a.getFlattedNodes(!s.props.checkStrictly))==null?void 0:u.filter(oe=>oe.isDisabled?!1:(oe.calcText(L,se),c(oe,f.value)));W.value&&(N.value.forEach(oe=>{oe.hitState=!1}),o.value.forEach(oe=>{oe.hitState=!1})),P.value=!0,g.value=le,he()},Va=()=>{var a;let u;P.value&&X.value?u=X.value.$el.querySelector(`.${t.e("suggestion-item")}`):u=(a=I.value)==null?void 0:a.$el.querySelector(`.${t.b("node")}[tabindex="-1"]`),u&&(u.focus(),!P.value&&u.click())},Pe=()=>{var a,u;const c=(a=H.value)==null?void 0:a.input,L=J.value,se=(u=X.value)==null?void 0:u.$el;if(!(!ca||!c)){if(se){const le=se.querySelector(`.${t.e("suggestion-list")}`);le.style.minWidth=`${c.offsetWidth}px`}if(L){const{offsetHeight:le}=L,oe=N.value.length>0?`${Math.max(le+6,d)}px`:`${d}px`;c.style.height=oe,he()}}},Sa=a=>{var u;return(u=I.value)==null?void 0:u.getCheckedNodes(a)},wa=a=>{he(),l("expandChange",a)},$a=a=>{if(!R.value)switch(a.code){case G.enter:Q();break;case G.down:Q(!0),pe(Va),a.preventDefault();break;case G.esc:D.value===!0&&(a.preventDefault(),a.stopPropagation(),Q(!1));break;case G.tab:Q(!1);break}},Ta=()=>{var a;(a=I.value)==null||a.clearCheckedNodes(),!D.value&&s.filterable&&Fe(),Q(!1),l("clear")},Fe=()=>{const{value:a}=Ce;y.value=a,i.value=a},Ma=a=>{var u,c;const{checked:L}=a;W.value?(u=I.value)==null||u.handleCheckChange(a,!L,!1):(!L&&((c=I.value)==null||c.handleCheckChange(a,!0,!1)),Q(!1))},La=a=>{const u=a.target,{code:c}=a;switch(c){case G.up:case G.down:{const L=c===G.up?-1:1;Ve(ha(u,L,`.${t.e("suggestion-item")}[tabindex="-1"]`));break}case G.enter:u.click();break}},Ia=()=>{const a=N.value,u=a[a.length-1];_=i.value?0:_+1,!(!u||!_||s.collapseTags&&a.length>1)&&(u.hitState?De(u):u.hitState=!0)},He=a=>{const u=a.target,c=t.e("search-input");u.className===c&&(j.value=!0),l("focus",a)},Ke=a=>{j.value=!1,l("blur",a)},Da=it(()=>{const{value:a}=f;if(!a)return;const u=s.beforeFilter(a);Wa(u)?u.then(Oe).catch(()=>{}):u!==!1?Oe():Le()},s.debounce),Ae=(a,u)=>{!D.value&&Q(!0),!(u!=null&&u.isComposing)&&(a?Da():Le())},Re=a=>Number.parseFloat(Nt(E.cssVarName("input-height"),a).value)-2;return ie(P,he),ie([ke,C,()=>s.collapseTags],Ea),ie(N,()=>{pe(()=>Pe())}),ie(K,async()=>{await pe();const a=H.value.input;d=Re(a)||d,Pe()}),ie(Ce,Fe,{immediate:!0}),Ue(()=>{const a=H.value.input,u=Re(a);d=a.offsetHeight||u,Ct(a,Pe)}),n({getCheckedNodes:Sa,cascaderPanelRef:I,togglePopperVisible:Q,contentRef:qe,presentText:Ce}),(a,u)=>(b(),A(p(Je),{ref_key:"tooltipRef",ref:O,visible:D.value,teleported:a.teleported,"popper-class":[p(t).e("dropdown"),a.popperClass],"popper-options":r,"fallback-placements":a.fallbackPlacements,"stop-popper-mouse-event":!1,"gpu-acceleration":!1,placement:a.placement,transition:`${p(t).namespace.value}-zoom-in-top`,effect:"light",pure:"",persistent:a.persistent,onHide:Le},{default:m(()=>[ge((b(),U("div",{class:B(p(ka)),style:ja(p(k)),onClick:()=>Q(p(Z)?void 0:!0),onKeydown:$a,onMouseenter:c=>w.value=!0,onMouseleave:c=>w.value=!1},[h(p(fa),{ref_key:"input",ref:H,modelValue:y.value,"onUpdate:modelValue":c=>y.value=c,placeholder:p(M),readonly:p(Z),disabled:p(C),"validate-event":!1,size:p(K),class:B(p(Na)),tabindex:p(W)&&a.filterable&&!p(C)?-1:void 0,onCompositionstart:p(q),onCompositionupdate:p(q),onCompositionend:p(q),onFocus:He,onBlur:Ke,onInput:Ae},{suffix:m(()=>[p(ya)?(b(),A(p(ye),{key:"clear",class:B([p(E).e("icon"),"icon-circle-close"]),onClick:be(Ta,["stop"])},{default:m(()=>[h(p(Za))]),_:1},8,["class","onClick"])):(b(),A(p(ye),{key:"arrow-down",class:B(p(Ca)),onClick:be(c=>Q(),["stop"])},{default:m(()=>[h(p(Ga))]),_:1},8,["class","onClick"]))]),_:1},8,["modelValue","onUpdate:modelValue","placeholder","readonly","disabled","size","class","tabindex","onCompositionstart","onCompositionupdate","onCompositionend"]),p(W)?(b(),U("div",{key:0,ref_key:"tagWrapper",ref:J,class:B([p(t).e("tags"),p(t).is("validate",!!p(_a))])},[(b(!0),U(ne,null,ue(N.value,c=>(b(),A(p(la),{key:c.key,type:a.tagType,size:p(z),effect:a.tagEffect,hit:c.hitState,closable:c.closable,"disable-transitions":"",onClose:L=>De(c)},{default:m(()=>[c.isCollapseTag===!1?(b(),U("span",{key:0},de(c.text),1)):(b(),A(p(Je),{key:1,disabled:D.value||!a.collapseTagsTooltip,"fallback-placements":["bottom","top","right","left"],placement:"bottom",effect:"light"},{default:m(()=>[ae("span",null,de(c.text),1)]),content:m(()=>[ae("div",{class:B(p(t).e("collapse-tags"))},[(b(!0),U(ne,null,ue(o.value.slice(a.maxCollapseTags),(L,se)=>(b(),U("div",{key:se,class:B(p(t).e("collapse-tag"))},[(b(),A(p(la),{key:L.key,class:"in-tooltip",type:a.tagType,size:p(z),effect:a.tagEffect,hit:L.hitState,closable:L.closable,"disable-transitions":"",onClose:le=>De(L)},{default:m(()=>[ae("span",null,de(L.text),1)]),_:2},1032,["type","size","effect","hit","closable","onClose"]))],2))),128))],2)]),_:2},1032,["disabled"]))]),_:2},1032,["type","size","effect","hit","closable","onClose"]))),128)),a.filterable&&!p(C)?ge((b(),U("input",{key:0,"onUpdate:modelValue":c=>i.value=c,type:"text",class:B(p(t).e("search-input")),placeholder:p(Ce)?"":p($),onInput:c=>Ae(i.value,c),onClick:be(c=>Q(!0),["stop"]),onKeydown:Ya(Ia,["delete"]),onCompositionstart:p(q),onCompositionupdate:p(q),onCompositionend:p(q),onFocus:He,onBlur:Ke},null,42,["onUpdate:modelValue","placeholder","onInput","onClick","onKeydown","onCompositionstart","onCompositionupdate","onCompositionend"])),[[Ja,i.value]]):te("v-if",!0)],2)):te("v-if",!0)],46,["onClick","onMouseenter","onMouseleave"])),[[p(Mt),()=>Q(!1),p(qe)]])]),content:m(()=>[ge(h(p(Jt),{ref_key:"cascaderPanelRef",ref:I,modelValue:p(Me),"onUpdate:modelValue":c=>Xa(Me)?Me.value=c:null,options:a.options,props:s.props,border:!1,"render-label":a.$slots.default,onExpandChange:wa,onClose:c=>a.$nextTick(()=>Q(!1))},{empty:m(()=>[Se(a.$slots,"empty")]),_:3},8,["modelValue","onUpdate:modelValue","options","props","render-label","onClose"]),[[Ge,!P.value]]),a.filterable?ge((b(),A(p(ma),{key:0,ref_key:"suggestionPanel",ref:X,tag:"ul",class:B(p(t).e("suggestion-panel")),"view-class":p(t).e("suggestion-list"),onKeydown:La},{default:m(()=>[g.value.length?(b(!0),U(ne,{key:0},ue(g.value,c=>(b(),U("li",{key:c.uid,class:B([p(t).e("suggestion-item"),p(t).is("checked",c.checked)]),tabindex:-1,onClick:L=>Ma(c)},[ae("span",null,de(c.text),1),c.checked?(b(),A(p(ye),{key:0},{default:m(()=>[h(p(oa))]),_:1})):te("v-if",!0)],10,["onClick"]))),128)):Se(a.$slots,"empty",{key:1},()=>[ae("li",{class:B(p(t).e("empty-text"))},de(p(S)("el.cascader.noMatch")),3)])]),_:3},8,["class","view-class"])),[[Ge,P.value]]):te("v-if",!0)]),_:3},8,["visible","teleported","popper-class","fallback-placements","placement","transition","persistent"]))}});var ll=Te(tl,[["__file","cascader.vue"]]);const nl=pa(ll);function sl(e,n){if(!e){if(!n||n.length===0)return"I-01";const l=n.filter(r=>r.startsWith("I-")),s=Math.max(...l.map(r=>parseInt(r.split("-")[1])));return`I-${String(s+1).padStart(2,"0")}`}if(!Array.isArray(n))return"";try{const[l,...s]=e.split("-"),r=ol(l),v=rl(r);if(!v)return"";const d=l.replace(r,v),_=n.filter(S=>S.startsWith(`${d}-`));if(_.length===0)return`${d}-01`;const t=Math.max(..._.map(S=>parseInt(S.split("-")[1]))),E=String(t+1).padStart(2,"0");return`${d}-${E}`}catch{return""}}function ol(e){const n=e.match(/(I|Ⅰ|Ⅱ|Ⅲ|Ⅳ|Ⅴ|Ⅵ|Ⅶ|Ⅷ|Ⅸ|Ⅹ|Ⅺ|Ⅻ)+/);return n?n[0]:e}function rl(e){return{I:"Ⅱ","Ⅰ":"Ⅱ","Ⅱ":"Ⅲ","Ⅲ":"Ⅳ","Ⅳ":"Ⅴ","Ⅴ":"Ⅵ","Ⅵ":"Ⅶ","Ⅶ":"Ⅷ","Ⅷ":"Ⅸ","Ⅸ":"Ⅹ","Ⅹ":"Ⅺ","Ⅺ":"Ⅻ"}[e]||""}const il={class:"form-item-split"},ul={class:"form-item-split"},dl={class:"form-item-split"},cl={class:"form-item-split"},pl={class:"form-item-split"},fl={class:"form-item-split"},ml={__name:"MeterDialog",props:{pMeter:{type:Object,default:()=>({})},id:{type:Number,default:null}},emits:["update:visible"],setup(e,{emit:n}){const l=e,s=n,r=ft(),v=Ye(),d=gt(),_=T(!1),t=T({parent_id:0,company_id:v.currentCompany.id,engine_id:null,type:r.currentSelectedType,meter_code:"",meter_id:"",installation_date:"",manufacturer:"",specification:"",standard_coal_factor:"",area_id:null,status:1,remarks:"",bottom_value:0,multiple:1,sub_category1:"",sub_category2:"",sub_category3:"",sub_category4:""}),E=[{value:1,label:"虚拟表"},{value:2,label:"大连思捷"},{value:3,label:"迈德电子"},{value:4,label:"千汇01"},{value:5,label:"1号平台"},{value:6,label:"千汇中电建"}],S={checkStrictly:!0,value:"value",label:"value"},x=y=>{const i=[],N={};return y.forEach(o=>{N[o.id]={...o,children:[]}}),y.forEach(o=>{o.part_of===null?i.push(N[o.id]):N[o.part_of]&&N[o.part_of].children.push(N[o.id])}),i};let F=T([]);const Y=T([]),R=T([]),q=T([]),O=y=>{console.log(y),y&&y.length>0?(t.value.sub_category1=y[0],t.value.sub_category2=y[1]||"",t.value.sub_category3=y[2]||"",t.value.sub_category4=y[3]||""):(t.value.sub_category1="",t.value.sub_category2="",t.value.sub_category3="",t.value.sub_category4="")},H=async y=>{_.value=!0;try{const i=await mt({id:y});if(i.code!==200)console.error(i.message),Ee.error(i.message);else{const N=i.data[0];t.value={...N,parent_id:Number(N.parent_id),company_id:Number(N.company_id),engine_id:Number(N.engine_id),type:Number(N.type),status:Number(N.status),installation_date:N.installation_date?new Date(N.installation_date):""};const o=[];for(let g=1;g<=4;g++){const k=t.value[`sub_category${g}`];k&&o.push(k)}Y.value=o}}catch(i){console.error(i),Ee.error(i.message||"获取表计信息失败")}finally{_.value=!1}},J={company_id:[{required:!0,message:"请输入公司ID",trigger:"blur"}],engine_id:[{required:!0,message:"请选择引擎",trigger:"change"},{type:"number",message:"引擎ID必须为数字",trigger:["change","blur"]}],standard_coal_factor:[{required:!0,message:"请输入折标煤系数",trigger:"blur"},{pattern:/^\d+(\.\d+)?$/,message:"请输入有效的数值",trigger:"blur"}],meter_code:[{required:!0,message:"请输入表计编码",trigger:"blur"}],meter_id:[{required:!0,message:"请输入表计ID",trigger:"blur"}],installation_date:[{required:!0,message:"请选择安装日期",trigger:"change"}],area_id:[{required:!0,message:"请选择供应地区",trigger:"change"}],status:[{required:!0,message:"请选择状态",trigger:"change"}],remarks:[{required:!1}],type:[{required:!0,message:"请选择类型",trigger:"change"}],bottom_value:[{required:!1},{type:"number",message:"启表底数必须为数字",trigger:["change","blur"]}],multiple:[{required:!1},{type:"number",message:"倍率必须为数字",trigger:["change","blur"]}]},I=T(null),X=()=>{I.value.validate(async y=>{if(y)await w();else return Ee.error("请正确填写表单。"),!1})},D=()=>{if(I.value){I.value.resetFields();let y=sl(l.pMeter.meter_code,r.meterList.map(i=>i.meter_code))||"";t.value={id:null,parent_id:l.pMeter.id?Number(l.pMeter.id):0,company_id:v.currentCompany.id,engine_id:l.pMeter.engine_id?Number(l.pMeter.engine_id):null,type:l.pMeter.type?Number(l.pMeter.type):r.currentSelectedType,meter_code:y,meter_id:"",bottom_value:0,standard_coal_factor:"",multiple:1,installation_date:"",manufacturer:"",specification:"",area_id:null,status:1,remarks:"",sub_category1:"",sub_category2:"",sub_category3:"",sub_category4:""},Y.value=[]}},w=async()=>{_.value=!0;try{t.value.engine_id=Number(t.value.engine_id);let y={};l.id?y=await ht(t.value):y=await vt(t.value),Ee.success("操作成功"),r.fetchMeterList({type:r.currentSelectedType}),s("update:visible")}catch(y){aa(y,"操作失败",!0)}finally{_.value=!1}},P=async()=>{try{const[y,i,N,o]=await Promise.all([Ne({level:1}),Ne({level:2}),Ne({level:3}),Ne({level:4})]);q.value=[...y.data,...i.data,...N.data,...o.data]}catch(y){aa(y,"获取分类数据失败",!0)}};ie(()=>l.pMeter,y=>{t.value.parent_id=y.id?Number(y.id):0,t.value.type=y.type!==void 0?Number(y.type):r.currentSelectedType},{deep:!0});const j=V(()=>t.value.type===1?"水虚拟表":t.value.type===2?"电虚拟表":"气虚拟表");return Ue(async()=>{d.areas.length||await d.fetchAreas(),F.value=await bt(Ye().currentCompany.id,j.value),await P(),R.value=x(q.value),l.id?await H(l.id):D()}),(y,i)=>{const N=fa,o=tt,g=ct,k=pt,C=va,$=dt,M=ut,K=nl,z=nt,W=lt,Z=et;return ge((b(),A(W,{model:t.value,rules:J,ref_key:"meterFormRef",ref:I,"label-width":"120px"},{default:m(()=>[ae("div",il,[h(o,{label:"表计编码",prop:"meter_code"},{default:m(()=>[h(N,{modelValue:t.value.meter_code,"onUpdate:modelValue":i[0]||(i[0]=f=>t.value.meter_code=f)},null,8,["modelValue"])]),_:1}),h(o,{label:"折标煤系数",prop:"standard_coal_factor"},{default:m(()=>[h(k,{modelValue:t.value.standard_coal_factor,"onUpdate:modelValue":i[1]||(i[1]=f=>t.value.standard_coal_factor=f),placeholder:"请输入或选择折标煤系数",filterable:"","allow-create":"","default-first-option":!1},{default:m(()=>[(b(!0),U(ne,null,ue(p(yt),f=>(b(),A(g,{key:f.value,label:`${f.label} (${f.value})`,value:f.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),ae("div",ul,[h(o,{label:"引擎",prop:"engine_id"},{default:m(()=>[h(k,{modelValue:t.value.engine_id,"onUpdate:modelValue":i[2]||(i[2]=f=>t.value.engine_id=f),modelModifiers:{number:!0},placeholder:"请选择引擎",clearable:""},{default:m(()=>[(b(),U(ne,null,ue(E,f=>h(g,{key:f.value,label:f.label,value:f.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),h(o,{label:t.value.engine_id===1?"表计公式":"外部表计id",prop:"meter_id"},{default:m(()=>[t.value.engine_id===2?(b(),A(N,{key:0,modelValue:t.value.meter_id,"onUpdate:modelValue":i[3]||(i[3]=f=>t.value.meter_id=f)},null,8,["modelValue"])):(b(),A(k,{key:1,modelValue:t.value.meter_id,"onUpdate:modelValue":i[4]||(i[4]=f=>t.value.meter_id=f),placeholder:"请选择表计公式",clearable:""},{default:m(()=>[(b(!0),U(ne,null,ue(p(F),f=>(b(),A(g,{key:f.id,label:f.name,value:""+f.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]))]),_:1},8,["label"])]),ae("div",dl,[h(o,{label:"启表底数",prop:"bottom_value"},{default:m(()=>[h(N,{modelValue:t.value.bottom_value,"onUpdate:modelValue":i[5]||(i[5]=f=>t.value.bottom_value=f),modelModifiers:{number:!0},type:"number",placeholder:"请输入启表底数"},null,8,["modelValue"])]),_:1}),h(o,{label:"倍率",prop:"multiple"},{default:m(()=>[h(N,{modelValue:t.value.multiple,"onUpdate:modelValue":i[6]||(i[6]=f=>t.value.multiple=f),modelModifiers:{number:!0},type:"number",placeholder:"请输入倍率"},null,8,["modelValue"])]),_:1})]),ae("div",cl,[h(o,{label:"状态",prop:"status"},{default:m(()=>[h($,{modelValue:t.value.status,"onUpdate:modelValue":i[7]||(i[7]=f=>t.value.status=f),modelModifiers:{number:!0}},{default:m(()=>[h(C,{value:1},{default:m(()=>i[15]||(i[15]=[re("启用")])),_:1}),h(C,{value:2},{default:m(()=>i[16]||(i[16]=[re("停用")])),_:1})]),_:1},8,["modelValue"])]),_:1}),h(o,{label:"类型",prop:"type"},{default:m(()=>[h($,{modelValue:t.value.type,"onUpdate:modelValue":i[8]||(i[8]=f=>t.value.type=f),modelModifiers:{number:!0},disabled:""},{default:m(()=>[h(C,{value:1},{default:m(()=>i[17]||(i[17]=[re("水表")])),_:1}),h(C,{value:2},{default:m(()=>i[18]||(i[18]=[re("电表")])),_:1}),h(C,{value:3},{default:m(()=>i[19]||(i[19]=[re("气表")])),_:1})]),_:1},8,["modelValue"])]),_:1})]),ae("div",pl,[h(o,{label:"安装日期",prop:"installation_date"},{default:m(()=>[h(M,{modelValue:t.value.installation_date,"onUpdate:modelValue":i[9]||(i[9]=f=>t.value.installation_date=f),type:"date",placeholder:"请选择安装日期"},null,8,["modelValue"])]),_:1}),h(o,{label:"分类"},{default:m(()=>[h(K,{modelValue:Y.value,"onUpdate:modelValue":i[10]||(i[10]=f=>Y.value=f),options:R.value,props:S,clearable:"",placeholder:"请选择分类",onChange:O},null,8,["modelValue","options"])]),_:1})]),ae("div",fl,[h(o,{label:"制造商",prop:"manufacturer"},{default:m(()=>[h(N,{modelValue:t.value.manufacturer,"onUpdate:modelValue":i[11]||(i[11]=f=>t.value.manufacturer=f)},null,8,["modelValue"])]),_:1}),h(o,{label:"规格",prop:"specification"},{default:m(()=>[h(N,{modelValue:t.value.specification,"onUpdate:modelValue":i[12]||(i[12]=f=>t.value.specification=f)},null,8,["modelValue"])]),_:1})]),h(o,{label:"供应地区",prop:"area_id"},{default:m(()=>[h(k,{modelValue:t.value.area_id,"onUpdate:modelValue":i[13]||(i[13]=f=>t.value.area_id=f),modelModifiers:{number:!0},clearable:"",placeholder:"请选择供应地区"},{default:m(()=>[(b(!0),U(ne,null,ue(p(d).areas,f=>(b(),A(g,{key:f.id,label:f.name,value:f.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),h(o,{label:"备注",prop:"remarks"},{default:m(()=>[h(N,{modelValue:t.value.remarks,"onUpdate:modelValue":i[14]||(i[14]=f=>t.value.remarks=f)},null,8,["modelValue"])]),_:1}),h(o,null,{default:m(()=>[h(z,{type:"primary",onClick:X},{default:m(()=>i[20]||(i[20]=[re("提交")])),_:1}),h(z,{onClick:D},{default:m(()=>i[21]||(i[21]=[re("重置")])),_:1})]),_:1})]),_:1},8,["model"])),[[Z,_.value]])}}},jl=Qa(ml,[["__scopeId","data-v-f21157a7"]]);export{jl as _};
