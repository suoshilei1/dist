import{z as ie,A as Se,B as ne,C as De,D as Q,E as ce,r as _,F as E,G as Te,H as Me,w as de,c as n,d as w,n as G,I as y,J as P,j as i,K as Z,M as N,N as k,O as me,P as Ie,Q as Ae,R as Le,S as Ve,e as u,h as V,g as T,_ as ee,u as ue,s as $e,T as ze,o as pe,U as q,V as ae,q as fe,W as ge,l as Be,X as Ue,Y as H,i as o,Z as Fe,f as L,$ as Ne,a0 as Ge,a1 as Re,v as ve,b as We,m as Oe,a2 as qe}from"./index-Bx6Y8L80.js";import{E as _e}from"./button-8bviUT_H.js";/* empty css             */import{E as He,a as Qe,b as Ye,c as je}from"./header-DL-7jVxr.js";import{_ as Je}from"./logo-rRFpfryy.js";import{E as Ke}from"./dialog-Dt2QUqOw.js";import"./overlay-04qnzRyj.js";import{E as Xe,a as Ze}from"./form-item-CWYWsPGl.js";import{E as et}from"./input-CFaQgGx5.js";/* empty css                     */import"./popper-DBn8ulUn.js";import"./scrollbar-DuXO1tWo.js";import{E as tt,a as st,b as at}from"./dropdown-item-B05BJF6C.js";import{u as we}from"./area-COPnz-hV.js";import{u as he}from"./meter-5sbrBbgq.js";import{C as ot}from"./CompanyAutoInput-CFzAe0Ah.js";import{c as lt}from"./user-Csntps2O.js";import{s as oe}from"./sha256-ByTVSy_2.js";/* empty css             *//* empty css                 *//* empty css                   */import{E as D}from"./index-KJp6TXG9.js";import{E as rt}from"./index-slq3sC_j.js";import{E as ye}from"./index-A4BGBRGh.js";import{i as it}from"./icon-6zrsquxY.js";import{_ as Ce}from"./plugin-vue_export-helper-CqGSI99y.js";/* empty css                        */import{E as O}from"./index-CWCMyxJA.js";import"./index-AkNVqhGZ.js";import"./use-form-item-50hJ8Ppj.js";import"./index-DZY-cmUL.js";import"./index-CuyxIfpa.js";import"./scroll-BawlEUY1.js";import"./vnode-DK7gyQZj.js";import"./focus-trap-Ddg061Nm.js";import"./aria-BUADUvnR.js";import"./refs-Bp53MkJS.js";import"./castArray-CrUPC_Z8.js";import"./_Uint8Array-B6mJ0Xm4.js";import"./_initCloneObject-nnMrnZRY.js";import"./index-iw6eP590.js";import"./dayjs.min-Cd48fqZ9.js";import"./autocomplete-BsDCzI7r.js";import"./validator-ulZFuTQV.js";const nt=ie({size:{type:[Number,String],values:Se,default:"",validator:f=>ne(f)},shape:{type:String,values:["circle","square"],default:"circle"},icon:{type:it},src:{type:String,default:""},alt:String,srcSet:String,fit:{type:De(String),default:"cover"}}),ct={error:f=>f instanceof Event},dt=Q({name:"ElAvatar"}),mt=Q({...dt,props:nt,emits:ct,setup(f,{emit:d}){const e=f,c=ce("avatar"),s=_(!1),v=E(()=>{const{size:t,icon:p,shape:l}=e,m=[c.b()];return Te(t)&&m.push(c.m(t)),p&&m.push(c.m("icon")),l&&m.push(c.m(l)),m}),g=E(()=>{const{size:t}=e;return ne(t)?c.cssVarBlock({size:Me(t)||""}):void 0}),x=E(()=>({objectFit:e.fit}));de(()=>e.src,()=>s.value=!1);function S(t){s.value=!0,d("error",t)}return(t,p)=>(n(),w("span",{class:k(y(v)),style:G(y(g))},[(t.src||t.srcSet)&&!s.value?(n(),w("img",{key:0,src:t.src,alt:t.alt,srcset:t.srcSet,style:G(y(x)),onError:S},null,44,["src","alt","srcset"])):t.icon?(n(),P(y(ye),{key:1},{default:i(()=>[(n(),P(Z(t.icon)))]),_:1})):N(t.$slots,"default",{key:2})],6))}});var ut=Ce(mt,[["__file","avatar.vue"]]);const pt=me(ut),$={success:"icon-success",warning:"icon-warning",error:"icon-error",info:"icon-info"},le={[$.success]:Ie,[$.warning]:Ae,[$.error]:Le,[$.info]:Ve},ft=ie({title:{type:String,default:""},subTitle:{type:String,default:""},icon:{type:String,values:["success","warning","info","error"],default:"info"}}),gt=Q({name:"ElResult"}),vt=Q({...gt,props:ft,setup(f){const d=f,e=ce("result"),c=E(()=>{const s=d.icon,v=s&&$[s]?$[s]:"icon-info",g=le[v]||le["icon-info"];return{class:v,component:g}});return(s,v)=>(n(),w("div",{class:k(y(e).b())},[u("div",{class:k(y(e).e("icon"))},[N(s.$slots,"icon",{},()=>[y(c).component?(n(),P(Z(y(c).component),{key:0,class:k(y(c).class)},null,8,["class"])):V("v-if",!0)])],2),s.title||s.$slots.title?(n(),w("div",{key:0,class:k(y(e).e("title"))},[N(s.$slots,"title",{},()=>[u("p",null,T(s.title),1)])],2)):V("v-if",!0),s.subTitle||s.$slots["sub-title"]?(n(),w("div",{key:1,class:k(y(e).e("subtitle"))},[N(s.$slots,"sub-title",{},()=>[u("p",null,T(s.subTitle),1)])],2)):V("v-if",!0),s.$slots.extra?(n(),w("div",{key:2,class:k(y(e).e("extra"))},[N(s.$slots,"extra")],2)):V("v-if",!0)],2))}});var _t=Ce(vt,[["__file","result.vue"]]);const wt=me(_t),ht="data:image/svg+xml,%3c?xml%20version='1.0'%20encoding='UTF-8'?%3e%3c!DOCTYPE%20svg%20PUBLIC%20'-//W3C//DTD%20SVG%201.1//EN'%20'http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd'%3e%3c!--%20Creator:%20CorelDRAW%20--%3e%3csvg%20xmlns='http://www.w3.org/2000/svg'%20xml:space='preserve'%20width='19.5692mm'%20height='17.7047mm'%20style='shape-rendering:geometricPrecision;%20text-rendering:geometricPrecision;%20image-rendering:optimizeQuality;%20fill-rule:evenodd;%20clip-rule:evenodd'%20viewBox='0%200%200.671195%200.607245'%20xmlns:xlink='http://www.w3.org/1999/xlink'%3e%3cdefs%3e%3cstyle%20type='text/css'%3e%3c![CDATA[%20.str1%20{stroke:%23fff;stroke-width:0.0242011}%20.str0%20{stroke:%23fff;stroke-width:0.0242011;stroke-linecap:round;stroke-linejoin:round}%20.fil0%20{fill:none}%20]]%3e%3c/style%3e%3c/defs%3e%3cg%20id='图层_x0020_1'%3e%3cmetadata%20id='CorelCorpID_0Corel-Layer'/%3e%3cg%20id='_772231312'%3e%3cpath%20id='_325112704'%20class='fil0%20str0'%20d='M0.00779949%200.288516l0.325493%20-0.276446%200.325836%200.280219m-0.651329%20-0.00377284z'/%3e%3cpath%20id='_325113616'%20class='fil0%20str1'%20d='M0.272584%200.391755l0.122103%200c0.0209221,0%200.0380714,0.0171493%200.0380714,0.0380714l0%200.165319%20-0.198589%200%200%20-0.165319c0,-0.0209221%200.0171493,-0.0380714%200.0384144,-0.0380714z'/%3e%3cpath%20id='_325113184'%20class='fil0%20str1'%20d='M0.581957%200.226093l0%200.311088c0,0.0315547%20-0.0257239,0.0572786%20-0.0572786,0.0572786l-0.382429%200c-0.0315547,0%20-0.0572786,-0.0257239%20-0.0572786,-0.0572786l0%20-0.311088'/%3e%3c/g%3e%3c/g%3e%3c/svg%3e",yt="data:image/svg+xml,%3c?xml%20version='1.0'%20encoding='UTF-8'?%3e%3c!DOCTYPE%20svg%20PUBLIC%20'-//W3C//DTD%20SVG%201.1//EN'%20'http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd'%3e%3c!--%20Creator:%20CorelDRAW%20--%3e%3csvg%20xmlns='http://www.w3.org/2000/svg'%20xml:space='preserve'%20width='23.6091mm'%20height='17.58mm'%20style='shape-rendering:geometricPrecision;%20text-rendering:geometricPrecision;%20image-rendering:optimizeQuality;%20fill-rule:evenodd;%20clip-rule:evenodd'%20viewBox='0%200%201.21653%200.905866'%20xmlns:xlink='http://www.w3.org/1999/xlink'%3e%3cdefs%3e%3cstyle%20type='text/css'%3e%3c![CDATA[%20.str0%20{stroke:%23fff;stroke-width:0.0363583;stroke-linecap:round}%20.fil1%20{fill:none;fill-rule:nonzero}%20.fil2%20{fill:%23fff}%20.fil0%20{fill:%23fff;fill-rule:nonzero}%20]]%3e%3c/style%3e%3c/defs%3e%3cg%20id='图层_x0020_1'%3e%3cmetadata%20id='CorelCorpID_0Corel-Layer'/%3e%3cg%20id='_770419928'%3e%3cpolygon%20id='_325717624'%20class='fil0'%20points='0.090128,0.905866%200.090128,0.749735%200.218948,0.646679%200.218948,0.905866%20'/%3e%3cpolygon%20id='_325718632'%20class='fil0'%20points='0.39466,0.905866%200.39466,0.506007%200.447218,0.463754%200.52348,0.523011%200.52348,0.905866%20'/%3e%3cpolygon%20id='_325719040'%20class='fil0'%20points='0.699191,0.905866%200.699191,0.659046%200.707951,0.665744%200.828012,0.563203%200.828012,0.905866%20'/%3e%3cpolygon%20id='_325719064'%20class='fil0'%20points='1.00372,0.905866%201.00372,0.412741%201.13203,0.302471%201.13203,0.905866%20'/%3e%3cpath%20id='_325719160'%20class='fil1%20str0'%20d='M0.0112898%200.597212l0.390584%20-0.311746%200.25661%200.197868%200.428715%20-0.366881m-1.07591%200.480758z'/%3e%3cpolygon%20id='_325719880'%20class='fil2'%20points='1.21653,0.00979036%201.2052,0.132427%201.19438,0.25558%201.08205,0.12779%200.969714,0%201.09338,0.00463754%20'/%3e%3c/g%3e%3c/g%3e%3c/svg%3e",Ct="data:image/svg+xml,%3c?xml%20version='1.0'%20encoding='UTF-8'?%3e%3c!DOCTYPE%20svg%20PUBLIC%20'-//W3C//DTD%20SVG%201.1//EN'%20'http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd'%3e%3c!--%20Creator:%20CorelDRAW%20--%3e%3csvg%20xmlns='http://www.w3.org/2000/svg'%20xml:space='preserve'%20width='17.6556mm'%20height='17.6556mm'%20style='shape-rendering:geometricPrecision;%20text-rendering:geometricPrecision;%20image-rendering:optimizeQuality;%20fill-rule:evenodd;%20clip-rule:evenodd'%20viewBox='0%200%200.926785%200.926785'%20xmlns:xlink='http://www.w3.org/1999/xlink'%3e%3cdefs%3e%3cstyle%20type='text/css'%3e%3c![CDATA[%20.str0%20{stroke:%23fff;stroke-width:0.0370387}%20.fil0%20{fill:none}%20]]%3e%3c/style%3e%3c/defs%3e%3cg%20id='图层_x0020_1'%3e%3cmetadata%20id='CorelCorpID_0Corel-Layer'/%3e%3cg%20id='_772230232'%3e%3cpath%20id='_325716160'%20class='fil0%20str0'%20d='M0.710895%200.0185193c0.109184,0%200.197372,0.0887122%200.197372,0.197896%200,0.109184%20-0.0881873,0.197372%20-0.197372,0.197372l-0.197896%200%200%20-0.197372c0,-0.109184%200.0887122,-0.197896%200.197896,-0.197896z'/%3e%3cpath%20id='_325716232'%20class='fil0%20str0'%20d='M0.710895%200.908266c0.109184,0%200.197372,-0.0887122%200.197372,-0.197896%200,-0.109184%20-0.0881873,-0.197372%20-0.197372,-0.197372l-0.197896%200%200%200.197372c0,0.109184%200.0887122,0.197896%200.197896,0.197896z'/%3e%3cpath%20id='_325716256'%20class='fil0%20str0'%20d='M0.216416%200.0185193c-0.109184,0%20-0.197896,0.0887122%20-0.197896,0.197896%200,0.109184%200.0887122,0.197372%200.197896,0.197372l0.197896%200%200%20-0.197372c0,-0.109184%20-0.0887122,-0.197896%20-0.197896,-0.197896z'/%3e%3cpath%20id='_325717144'%20class='fil0%20str0'%20d='M0.216416%200.908266c-0.109184,0%20-0.197896,-0.0887122%20-0.197896,-0.197896%200,-0.109184%200.0887122,-0.197372%200.197896,-0.197372l0.197896%200%200%200.197372c0,0.109184%20-0.0887122,0.197896%20-0.197896,0.197896z'/%3e%3c/g%3e%3c/g%3e%3c/svg%3e",kt="data:image/svg+xml,%3c?xml%20version='1.0'%20encoding='UTF-8'?%3e%3c!DOCTYPE%20svg%20PUBLIC%20'-//W3C//DTD%20SVG%201.1//EN'%20'http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd'%3e%3c!--%20Creator:%20CorelDRAW%20--%3e%3csvg%20xmlns='http://www.w3.org/2000/svg'%20xml:space='preserve'%20width='19.3945mm'%20height='17.7656mm'%20style='shape-rendering:geometricPrecision;%20text-rendering:geometricPrecision;%20image-rendering:optimizeQuality;%20fill-rule:evenodd;%20clip-rule:evenodd'%20viewBox='0%200%201.67843%201.53747'%20xmlns:xlink='http://www.w3.org/1999/xlink'%3e%3cdefs%3e%3cstyle%20type='text/css'%3e%3c![CDATA[%20.str0%20{stroke:%23fff;stroke-width:0.0610639}%20.str1%20{stroke:%23fff;stroke-width:0.0610639;stroke-linejoin:round}%20.str2%20{stroke:%23fff;stroke-width:0.0610639;stroke-linecap:round}%20.str3%20{stroke:%23fff;stroke-width:0.0610639;stroke-linecap:round;stroke-linejoin:round}%20.fil0%20{fill:none}%20.fil1%20{fill:black}%20]]%3e%3c/style%3e%3c/defs%3e%3cg%20id='图层_x0020_1'%3e%3cmetadata%20id='CorelCorpID_0Corel-Layer'/%3e%3cg%20id='_772230664'%3e%3cpath%20id='_325082440'%20class='fil0%20str0'%20d='M0.494396%201.42472l-0.334917%200c-0.0709643,0%20-0.128947,-0.057983%20-0.128947,-0.129813l0%20-1.13456c0,-0.0709643%200.057983,-0.129813%200.128947,-0.129813l1.1787%200c0.0709643,0%200.128947,0.0588484%200.128947,0.129813l0%201.07745'/%3e%3cpolygon%20id='_325082728'%20class='fil0%20str1'%20points='1.03528,0.644979%201.34164,1.07596%201.648,1.50693%201.03528,1.50693%200.423432,1.50693%200.72979,1.07596%20'/%3e%3cline%20id='_325083352'%20class='fil0%20str2'%20x1='0.282369'%20y1='0.391411'%20x2='1.21096'%20y2=%20'0.391411'%20/%3e%3cline%20id='_325082992'%20class='fil0%20str3'%20x1='0.278907'%20y1='0.696904'%20x2='0.681326'%20y2=%20'0.696904'%20/%3e%3cline%20id='_325083496'%20class='fil0%20str2'%20x1='0.27458'%20y1='1.05778'%20x2='0.520358'%20y2=%20'1.05778'%20/%3e%3cline%20id='_323923864'%20class='fil0%20str3'%20x1='1.04567'%20y1='1.24558'%20x2='1.04567'%20y2=%20'0.883834'%20/%3e%3ccircle%20id='_323925088'%20class='fil1'%20cx='1.05086'%20cy='1.38837'%20r='0.0588484'/%3e%3c/g%3e%3c/g%3e%3c/svg%3e",xt="data:image/svg+xml,%3c?xml%20version='1.0'%20encoding='UTF-8'?%3e%3c!DOCTYPE%20svg%20PUBLIC%20'-//W3C//DTD%20SVG%201.1//EN'%20'http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd'%3e%3c!--%20Creator:%20CorelDRAW%20--%3e%3csvg%20xmlns='http://www.w3.org/2000/svg'%20xml:space='preserve'%20width='18.8056mm'%20height='17.5656mm'%20style='shape-rendering:geometricPrecision;%20text-rendering:geometricPrecision;%20image-rendering:optimizeQuality;%20fill-rule:evenodd;%20clip-rule:evenodd'%20viewBox='0%200%203.28349%203.06699'%20xmlns:xlink='http://www.w3.org/1999/xlink'%3e%3cdefs%3e%3cstyle%20type='text/css'%3e%3c![CDATA[%20.str1%20{stroke:%23fff;stroke-width:0.123199}%20.str0%20{stroke:%23fff;stroke-width:0.123199;stroke-linecap:round}%20.fil0%20{fill:none}%20]]%3e%3c/style%3e%3c/defs%3e%3cg%20id='图层_x0020_1'%3e%3cmetadata%20id='CorelCorpID_0Corel-Layer'/%3e%3cg%20id='_770422112'%3e%3cpath%20id='_325743304'%20class='fil0%20str0'%20d='M0.0615995%200.402073l0.783962%200m0.680947%200l1.69538%200'/%3e%3cpath%20id='_325743064'%20class='fil0%20str0'%20d='M0.0615995%201.54572l1.69538%200m0.682693%200l0.782216%200'/%3e%3cpath%20id='_325743184'%20class='fil0%20str0'%20d='M0.0615995%202.66491l0.747296%200m0.682693%200l1.7303%200'/%3e%3ccircle%20id='_325743400'%20class='fil0%20str1'%20cx='1.18604'%20cy='0.402073'%20r='0.340474'/%3e%3ccircle%20id='_325744072'%20class='fil0%20str1'%20cx='2.09746'%20cy='1.54572'%20r='0.340474'/%3e%3ccircle%20id='_325743904'%20class='fil0%20str1'%20cx='1.15112'%20cy='2.66491'%20r='0.340474'/%3e%3c/g%3e%3c/g%3e%3c/svg%3e",bt=[{path:"/dashboard",title:"首页",icon:ht},{path:"/energy-data",title:"用能数据",icon:yt,children:[{path:"/energy-data/carbon",title:"能碳监控"},{path:"/energy-data/water-data",title:"用水数据"},{path:"/energy-data/electricity-data",title:"用电数据"}]},{path:"/device-center",title:"设备中心",icon:Ct,children:[{path:"/device-center/console",title:"控制台"},{path:"/device-center/device-info",title:"设备信息"},{path:"/device-center/device-architecture",title:"设备架构"}]},{path:"/warning-center",title:"异常处理中心",icon:kt,children:[{path:"/warning-center/exception-handling",title:"异常处理"},{path:"/warning-center/water-leakage-analysis",title:"智能漏损分析"}]},{path:"/system-management",title:"系统管理",icon:xt,children:[{path:"/system-management/company-management",title:"公司管理"},{path:"/system-management/user-management",title:"用户管理"},{path:"/system-management/block-management",title:"区块管理"},{path:"/system-management/push-management",title:"推送管理"},{path:"/system-management/formula-management",title:"公式管理"},{path:"/system-management/constant-management",title:"常量管理"}]}],Pt={"/dashboard":["view_simple_dashboard","view_big_screen"],"/dashboard/big-screen":["view_big_screen"],"/energy-data":["view_water_chart","view_water_daily_report","manage_water_meter","view_water_cost","view_electricity_chart","view_electricity_daily_report","manage_electricity_meter","view_electricity_cost"],"/energy-data/carbon":["view_carbon_data"],"/energy-data/water-data":["view_water_chart","view_water_daily_report","manage_water_meter","view_water_cost"],"/energy-data/electricity-data":["view_electricity_chart","view_electricity_daily_report","manage_electricity_meter","view_electricity_cost"],"/device-center":["view_device_console","control_device","view_device_info","manage_device"],"/device-center/console":["view_device_console","control_device"],"/device-center/device-info":["view_device_info"],"/device-center/device-architecture":["view_device_architecture"],"/warning-center":["view_exceptions","handle_exceptions","view_leakage"],"/warning-center/exception-handling":["view_exceptions","handle_exceptions"],"/warning-center/water-leakage-analysis":["view_leakage"],"/system-management":["manage_company","view_company","manage_block","manage_push","manage_formula","manage_user_permissions","manage_constant","manage_user","view_user"],"/system-management/company-management":["manage_company"],"/system-management/user-management":["manage_user"],"/system-management/block-management":["manage_block"],"/system-management/push-management":["manage_push"],"/system-management/formula-management":["manage_formula"],"/system-management/constant-management":["manage_constant"]};function re(f,d){const e=Pt[f];return e?e.some(c=>d.includes(c)):!0}function Et(f,d){return f.filter(e=>re(e.path,d)).map(e=>{if(e.children){const c=e.children.filter(s=>re(s.path,d));return c.length===0?null:{...e,children:c}}return e}).filter(Boolean)}const St={class:"menu-list"},Dt=["onClick"],Tt=["src"],Mt={class:"menu-title"},It=["onClick"],At=["src"],Lt={class:"menu-title"},Vt={class:"submenu-list"},$t=["onClick"],zt={__name:"NavList",props:{isCollapse:{type:Boolean,default:!1},isMobile:{type:Boolean,default:!1}},setup(f){const d=ue(),e=$e(),c=_(window.location.pathname),s=_([]),v=_({}),g=E(()=>Et(bt,e.userPermissions));ze(()=>{const t=c.value;g.value.forEach(p=>{p.children&&p.children.some(l=>l.path===t)&&(s.value.includes(p.path)||s.value.push(p.path))})}),pe(()=>{g.value.forEach(t=>{if(t.children){const m=t.children.length*44+(t.children.length-1)*4+6;v.value[t.path]=m,t.children.some(h=>h.path===c.value)&&s.value.push(t.path)}})});const x=t=>{c.value=t,d.push(t)},S=t=>{const p=s.value.indexOf(t);p===-1?s.value.push(t):s.value.splice(p,1)};return(t,p)=>(n(),w("nav",{class:k(["side-menu",{collapsed:f.isCollapse&&!f.isMobile}])},[u("ul",St,[(n(!0),w(q,null,ae(g.value,l=>(n(),w(q,{key:l.path},[l.children?(n(),w("li",{key:1,class:k(["submenu",{open:s.value.includes(l.path)}])},[u("div",{class:"submenu-title",onClick:m=>S(l.path)},[u("img",{src:l.icon,style:{fill:"currentColor",color:"gray"},alt:"",class:"menu-icon"},null,8,At),u("span",Lt,T(l.title),1),p[0]||(p[0]=u("span",{class:"arrow"},null,-1))],8,It),u("div",{class:"submenu-wrapper",style:G({height:s.value.includes(l.path)?v.value[l.path]+"px":"0"})},[u("ul",Vt,[(n(!0),w(q,null,ae(l.children,m=>(n(),w("li",{key:m.path,class:k(["submenu-item",{active:c.value===m.path}]),onClick:h=>x(m.path)},T(m.title),11,$t))),128))])],4)],2)):(n(),w("li",{key:0,class:k(["menu-item",{active:c.value===l.path}]),onClick:m=>x(l.path)},[u("img",{src:l.icon,alt:"",class:"menu-icon"},null,8,Tt),u("span",Mt,T(l.title),1)],10,Dt))],64))),128))])],2))}},Bt=ee(zt,[["__scopeId","data-v-017994a8"]]),Ut={class:"header-left"},Ft={class:"header-right"},Nt={class:"company-selector"},Gt={class:"user-info"},Rt={class:"username"},Wt={class:"dialog-footer"},Ot={__name:"Header",props:{isCollapse:{type:Boolean,required:!0},isMobile:{type:Boolean,required:!0}},emits:["update:isCollapse","fullscreenChange"],setup(f,{emit:d}){let e=_(!1);const c=f,s=d,v=fe(),g=ge(),x=we(),S=he();Be();const t=ue(),p=_(g.currentCompany),l=_(!1),m=_(null),h=_({oldPassword:"",newPassword:"",confirmPassword:""}),z={oldPassword:[{required:!0,message:"请输入旧密码",trigger:"blur"},{min:6,message:"密码长度不能小于6位",trigger:"blur"}],newPassword:[{required:!0,message:"请输入新密码",trigger:"blur"},{min:6,message:"密码长度不能小于6位",trigger:"blur"}],confirmPassword:[{required:!0,message:"请再次输入新密码",trigger:"blur"},{validator:(r,a,b)=>{a!==h.value.newPassword?b(new Error("两次输入的密码不一致")):b()},trigger:"blur"}]};de(p,async(r,a)=>{r!==a&&await B(r)});const M=E(()=>v.userinfo||{}),Y=()=>{s("update:isCollapse",!c.isCollapse)},B=async r=>{if(r)try{g.setCurrentCompany(r),await Promise.all([x.fetchAreas(),S.fetchMeterList()]),D.success("公司切换成功")}catch{D.error("数据加载失败，请重试")}},j=async r=>{switch(r){case"userInfo":t.push("/user-info");break;case"changePassword":l.value=!0;break;case"logout":await J();break}},I=()=>{m.value&&m.value.resetFields(),h.value={oldPassword:"",newPassword:"",confirmPassword:""}},A=async()=>{if(m.value)try{e.value=!0,await m.value.validate(),await lt({username:M.value.username,id:M.value.id,oldPassword:oe(h.value.oldPassword),password:oe(h.value.newPassword)}),D.success("密码修改成功"),l.value=!1,I()}catch(r){r.message?D.error(r.message):D.error("密码修改失败，请重试")}finally{e.value=!1}},J=async()=>{try{await rt.confirm("确认退出登录吗？","提示",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}),localStorage.removeItem("permissions"),await Re(),t.push("/login"),D.success("已安全退出登录")}catch(r){r!=="cancel"&&(console.error(r),D.error("退出登录失败"))}};return(r,a)=>{const b=ye,K=pt,R=tt,W=st,X=at,U=et,F=Xe,ke=Ze,te=_e,xe=Ke,be=He,Pe=Ue("permission"),Ee=ve;return n(),P(be,{height:"55px",class:"header"},{default:i(()=>[u("div",Ut,[f.isMobile?(n(),P(b,{key:0,class:"toggle-btn",onClick:Y},{default:i(()=>[(n(),P(Z(f.isCollapse?"Expand":"Fold")))]),_:1})):V("",!0)]),u("div",Ft,[H((n(),w("div",Nt,[o(ot,{modelValue:p.value,"onUpdate:modelValue":a[0]||(a[0]=C=>p.value=C)},null,8,["modelValue"])])),[[Pe,"manage_company"]]),o(X,{onCommand:j},{dropdown:i(()=>[o(W,null,{default:i(()=>[o(R,{command:"changePassword"},{default:i(()=>[o(b,null,{default:i(()=>[o(y(Fe))]),_:1}),a[6]||(a[6]=L("修改密码 "))]),_:1}),o(R,{divided:"",command:"logout"},{default:i(()=>[o(b,null,{default:i(()=>[o(y(Ne))]),_:1}),a[7]||(a[7]=L("退出登录 "))]),_:1})]),_:1})]),default:i(()=>[u("div",Gt,[o(K,{size:32,class:"user-avatar"},{default:i(()=>{var C,se;return[L(T(((se=(C=M.value.real_name)==null?void 0:C[0])==null?void 0:se.toUpperCase())||"U"),1)]}),_:1}),u("span",Rt,T(M.value.real_name+"：你好呀"||"未登录"),1),o(b,{class:"dropdown-icon"},{default:i(()=>[o(y(Ge))]),_:1})])]),_:1})]),o(xe,{modelValue:l.value,"onUpdate:modelValue":a[5]||(a[5]=C=>l.value=C),title:"修改密码",width:"400px",onClose:I},{footer:i(()=>[u("span",Wt,[o(te,{onClick:a[4]||(a[4]=C=>l.value=!1)},{default:i(()=>a[8]||(a[8]=[L("取消")])),_:1}),o(te,{type:"primary",onClick:A},{default:i(()=>a[9]||(a[9]=[L("确认")])),_:1})])]),default:i(()=>[H((n(),P(ke,{ref_key:"passwordFormRef",ref:m,model:h.value,rules:z,"label-width":"100px"},{default:i(()=>[o(F,{label:"旧密码",prop:"oldPassword"},{default:i(()=>[o(U,{modelValue:h.value.oldPassword,"onUpdate:modelValue":a[1]||(a[1]=C=>h.value.oldPassword=C),type:"password",placeholder:"请输入旧密码","show-password":""},null,8,["modelValue"])]),_:1}),o(F,{label:"新密码",prop:"newPassword"},{default:i(()=>[o(U,{modelValue:h.value.newPassword,"onUpdate:modelValue":a[2]||(a[2]=C=>h.value.newPassword=C),type:"password",placeholder:"请输入新密码","show-password":""},null,8,["modelValue"])]),_:1}),o(F,{label:"确认新密码",prop:"confirmPassword"},{default:i(()=>[o(U,{modelValue:h.value.confirmPassword,"onUpdate:modelValue":a[3]||(a[3]=C=>h.value.confirmPassword=C),type:"password",placeholder:"请再次输入新密码","show-password":""},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])),[[Ee,y(e)]])]),_:1},8,["modelValue"])]),_:1})}}},qt=ee(Ot,[["__scopeId","data-v-e79c95ab"]]),Ht={class:"logo-container"},Qt={class:"platform-name"},Yt={class:"router-view-container"},jt={key:2,class:"loading-container"},Jt={__name:"index",setup(f){const d=_(!1),e=_(!1),c=_(!1),s=_(!1),v=_(!1),g=_(""),x=_(!1),S=fe(),t=ge(),p=we(),l=he(),m=E(()=>({width:e.value?d.value?"0":"260px":d.value?"4rem":"260px",borderRadius:"8px"})),h=E(()=>({marginLeft:c.value?"0":"auto"})),z=async()=>{x.value=!0;try{await S.getUserInfo(),t.setCurrentCompany(S.userCompany),await Promise.all([p.fetchAreas(),l.fetchMeterList()]),s.value=!0,v.value=!1}catch(r){v.value=!0,g.value="初始化数据失败，请刷新页面重试",O({type:"error",title:"错误",message:g.value,duration:0,showClose:!0}),console.error("初始化失败:",r)}finally{x.value=!1}},M=()=>{e.value&&(d.value=!d.value)},Y=r=>{d.value=r},B=()=>{const r=window.innerWidth<=768;e.value!==r&&(e.value=r,d.value=r)},j=r=>{c.value=r},I=_(navigator.onLine),A=()=>{I.value=navigator.onLine,I.value?(v.value=!1,g.value="",O.closeAll(),z()):(v.value=!0,g.value="网络连接不可用，请检查您的网络",O({type:"warning",title:"网络警告",message:g.value,duration:0,showClose:!0}))};pe(async()=>{B(),window.addEventListener("resize",B),window.addEventListener("online",A),window.addEventListener("offline",A),I.value?await z():(v.value=!0,g.value="网络连接不可用，请检查您的网络",O({type:"warning",title:"网络警告",message:g.value,duration:0,showClose:!0}))}),We(()=>{window.removeEventListener("resize",B),window.removeEventListener("online",A),window.removeEventListener("offline",A)});const J=E(()=>"发生错误");return(r,a)=>{const b=Qe,K=Oe("router-view"),R=Ye,W=je,X=_e,U=wt,F=ve;return H((n(),P(W,{class:"layout-container"},{default:i(()=>[!v.value&&s.value?(n(),w(q,{key:0},[e.value&&!d.value?(n(),w("div",{key:0,class:"drawer-overlay",onClick:M})):V("",!0),o(b,{class:k(["aside-container",["aside",{"mobile-aside":e.value}]]),style:G(m.value)},{default:i(()=>[u("div",Ht,[a[0]||(a[0]=u("img",{style:{"border-radius":"8px"},src:Je,alt:"Logo",class:"logo"},null,-1)),H(u("span",Qt,"融禹智慧能源管理",512),[[qe,!d.value||e.value]])]),o(Bt,{"is-collapse":d.value,"is-mobile":e.value},null,8,["is-collapse","is-mobile"])]),_:1},8,["class","style"]),o(W,{class:k(["right-container",{"mobile-right":e.value}]),style:G(h.value)},{default:i(()=>[o(qt,{"is-collapse":d.value,"is-mobile":e.value,"onUpdate:isCollapse":Y,onFullscreenChange:j},null,8,["is-collapse","is-mobile"]),o(R,{class:"main-content"},{default:i(()=>[u("div",Yt,[o(K)])]),_:1})]),_:1},8,["class","style"])],64)):v.value?(n(),P(U,{key:1,icon:"error",title:J.value,"sub-title":g.value,class:"error-result"},{extra:i(()=>[o(X,{type:"primary",onClick:z},{default:i(()=>a[1]||(a[1]=[L("重试")])),_:1})]),_:1},8,["title","sub-title"])):(n(),w("div",jt))]),_:1})),[[F,x.value]])}}},Gs=ee(Jt,[["__scopeId","data-v-5659165d"]]);export{Gs as default};
