import{z as he,C as J,aB as be,G as V,a8 as ye,D as Z,aG as Ee,E as $e,r as p,F as w,aa as we,o as Se,c as S,J as Ae,j as f,e as Q,N as A,I as a,n as X,i as I,d as D,M as h,au as Ie,T as Ce,U as Ne,f as Te,g as ke,al as Be,ai as E,k as Y,aO as Fe,ar as O,O as Pe}from"./index-oALI6hjD.js";import{u as Ve,U as C,I as _,C as x,o as De,t as Oe}from"./index-Ci2yyUHC.js";import{u as _e,E as Ke}from"./input-_j8YarB1.js";import{d as Le,E as Me}from"./scrollbar-BwLVa3O8.js";import{u as Re,E as Ue}from"./popper-8tqvLSZz.js";import{E as We}from"./index-DXOgsKzf.js";import{_ as He}from"./plugin-vue_export-helper-CqGSI99y.js";import{b as ze,u as Ge}from"./use-form-item-CJ5jT23N.js";const qe=he({valueKey:{type:String,default:"value"},modelValue:{type:[String,Number],default:""},debounce:{type:Number,default:300},placement:{type:J(String),values:["top","top-start","top-end","bottom","bottom-start","bottom-end"],default:"bottom-start"},fetchSuggestions:{type:J([Function,Array]),default:be},popperClass:{type:String,default:""},triggerOnFocus:{type:Boolean,default:!0},selectWhenUnmatched:{type:Boolean,default:!1},hideLoading:{type:Boolean,default:!1},teleported:Re.teleported,highlightFirstItem:{type:Boolean,default:!1},fitInputWidth:{type:Boolean,default:!1},clearable:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},name:String,...Ve(["ariaLabel"])}),je={[C]:l=>V(l),[_]:l=>V(l),[x]:l=>V(l),focus:l=>l instanceof FocusEvent,blur:l=>l instanceof FocusEvent,clear:()=>!0,select:l=>ye(l)},ee="ElAutocomplete",Je=Z({name:ee,inheritAttrs:!1}),Qe=Z({...Je,props:qe,emits:je,setup(l,{expose:ae,emit:u}){const o=l,te=_e(),se=Ee(),K=ze(),c=$e("autocomplete"),n=p(),L=p(),N=p(),M=p();let R=!1,T=!1;const i=p([]),s=p(-1),U=p(""),d=p(!1),$=p(!1),g=p(!1),b=Ge(),le=w(()=>se.style),v=w(()=>(i.value.length>0||g.value)&&d.value),W=w(()=>!o.hideLoading&&g.value),oe=w(()=>n.value?Array.from(n.value.$el.querySelectorAll("input")):[]),ne=()=>{v.value&&(U.value=`${n.value.$el.offsetWidth}px`)},re=()=>{s.value=-1},H=async e=>{if($.value)return;const t=r=>{g.value=!1,!$.value&&(O(r)?(i.value=r,s.value=o.highlightFirstItem?0:-1):Oe(ee,"autocomplete suggestions must be an array"))};if(g.value=!0,O(o.fetchSuggestions))t(o.fetchSuggestions);else{const r=await o.fetchSuggestions(e,t);O(r)&&t(r)}},z=Le(H,o.debounce),ue=e=>{const t=!!e;if(u(_,e),u(C,e),$.value=!1,d.value||(d.value=t),!o.triggerOnFocus&&!e){$.value=!0,i.value=[];return}z(e)},ie=e=>{var t;K.value||(((t=e.target)==null?void 0:t.tagName)!=="INPUT"||oe.value.includes(document.activeElement))&&(d.value=!0)},ce=e=>{u(x,e)},pe=e=>{T?T=!1:(d.value=!0,u("focus",e),o.triggerOnFocus&&!R&&z(String(o.modelValue)))},de=e=>{setTimeout(()=>{var t;if((t=N.value)!=null&&t.isFocusInsideContent()){T=!0;return}d.value&&y(),u("blur",e)})},fe=()=>{d.value=!1,u(C,""),u("clear")},G=async()=>{v.value&&s.value>=0&&s.value<i.value.length?k(i.value[s.value]):o.selectWhenUnmatched&&(u("select",{value:o.modelValue}),i.value=[],s.value=-1)},ve=e=>{v.value&&(e.preventDefault(),e.stopPropagation(),y())},y=()=>{d.value=!1},ge=()=>{var e;(e=n.value)==null||e.focus()},me=()=>{var e;(e=n.value)==null||e.blur()},k=async e=>{u(_,e[o.valueKey]),u(C,e[o.valueKey]),u("select",e),i.value=[],s.value=-1},B=e=>{if(!v.value||g.value)return;if(e<0){s.value=-1;return}e>=i.value.length&&(e=i.value.length-1);const t=L.value.querySelector(`.${c.be("suggestion","wrap")}`),m=t.querySelectorAll(`.${c.be("suggestion","list")} li`)[e],F=t.scrollTop,{offsetTop:j,scrollHeight:P}=m;j+P>F+t.clientHeight&&(t.scrollTop+=P),j<F&&(t.scrollTop-=P),s.value=e,n.value.ref.setAttribute("aria-activedescendant",`${b.value}-item-${s.value}`)},q=De(M,()=>{v.value&&y()});return we(()=>{q==null||q()}),Se(()=>{n.value.ref.setAttribute("role","textbox"),n.value.ref.setAttribute("aria-autocomplete","list"),n.value.ref.setAttribute("aria-controls","id"),n.value.ref.setAttribute("aria-activedescendant",`${b.value}-item-${s.value}`),R=n.value.ref.hasAttribute("readonly")}),ae({highlightedIndex:s,activated:d,loading:g,inputRef:n,popperRef:N,suggestions:i,handleSelect:k,handleKeyEnter:G,focus:ge,blur:me,close:y,highlight:B,getData:H}),(e,t)=>(S(),Ae(a(Ue),{ref_key:"popperRef",ref:N,visible:a(v),placement:e.placement,"fallback-placements":["bottom-start","top-start"],"popper-class":[a(c).e("popper"),e.popperClass],teleported:e.teleported,"gpu-acceleration":!1,pure:"","manual-mode":"",effect:"light",trigger:"click",transition:`${a(c).namespace.value}-zoom-in-top`,persistent:"",role:"listbox",onBeforeShow:ne,onHide:re},{content:f(()=>[Q("div",{ref_key:"regionRef",ref:L,class:A([a(c).b("suggestion"),a(c).is("loading",a(W))]),style:X({[e.fitInputWidth?"width":"minWidth"]:U.value,outline:"none"}),role:"region"},[I(a(Me),{id:a(b),tag:"ul","wrap-class":a(c).be("suggestion","wrap"),"view-class":a(c).be("suggestion","list"),role:"listbox"},{default:f(()=>[a(W)?(S(),D("li",{key:0},[h(e.$slots,"loading",{},()=>[I(a(We),{class:A(a(c).is("loading"))},{default:f(()=>[I(a(Ie))]),_:1},8,["class"])])])):(S(!0),D(Ce,{key:1},Ne(i.value,(r,m)=>(S(),D("li",{id:`${a(b)}-item-${m}`,key:m,class:A({highlighted:s.value===m}),role:"option","aria-selected":s.value===m,onClick:F=>k(r)},[h(e.$slots,"default",{item:r},()=>[Te(ke(r[e.valueKey]),1)])],10,["id","aria-selected","onClick"]))),128))]),_:3},8,["id","wrap-class","view-class"])],6)]),default:f(()=>[Q("div",{ref_key:"listboxRef",ref:M,class:A([a(c).b(),e.$attrs.class]),style:X(a(le)),role:"combobox","aria-haspopup":"listbox","aria-expanded":a(v),"aria-owns":a(b)},[I(a(Ke),Be({ref_key:"inputRef",ref:n},a(te),{clearable:e.clearable,disabled:a(K),name:e.name,"model-value":e.modelValue,"aria-label":e.ariaLabel,onInput:ue,onChange:ce,onFocus:pe,onBlur:de,onClear:fe,onKeydown:[E(Y(r=>B(s.value-1),["prevent"]),["up"]),E(Y(r=>B(s.value+1),["prevent"]),["down"]),E(G,["enter"]),E(y,["tab"]),E(ve,["esc"])],onMousedown:ie}),Fe({_:2},[e.$slots.prepend?{name:"prepend",fn:f(()=>[h(e.$slots,"prepend")])}:void 0,e.$slots.append?{name:"append",fn:f(()=>[h(e.$slots,"append")])}:void 0,e.$slots.prefix?{name:"prefix",fn:f(()=>[h(e.$slots,"prefix")])}:void 0,e.$slots.suffix?{name:"suffix",fn:f(()=>[h(e.$slots,"suffix")])}:void 0]),1040,["clearable","disabled","name","model-value","aria-label","onKeydown"])],14,["aria-expanded","aria-owns"])]),_:3},8,["visible","placement","popper-class","teleported","transition"]))}});var Xe=He(Qe,[["__file","autocomplete.vue"]]);const oa=Pe(Xe);export{oa as E};
