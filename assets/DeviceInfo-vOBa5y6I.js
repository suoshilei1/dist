import{_ as w,r as D,F as E,W as A,c as M,d as h,J as z,X as S,k as t,l as r,e as p,f as o,g as n,T as F,V as N,v as T}from"./index-DU5BV6sj.js";import{E as U}from"./dialog-BqmwFatm.js";import"./overlay-CaKmC84a.js";import{E as L}from"./card-CrntnV6K.js";import{E as Q,a as W}from"./descriptions-item-gRtpPMql.js";/* empty css            *//* empty css                */import{E as j}from"./popper-DmsXjoSL.js";import{E as G}from"./button-C3fNXQ0E.js";import{E as J}from"./empty-FpkiWcnp.js";import{u as k,k as C,e as B}from"./meter-CawyXifQ.js";import{f as K}from"./date-CToM-Ban.js";import{_ as O}from"./MeterDialog-CfKn1aHN.js";import{u as P}from"./area-CYcRQDxZ.js";import{E as u}from"./index-BmwD9m8C.js";import{s as X}from"./index.vue-HdrZos6g.js";import{E as Z}from"./index-DemxtX7w.js";import{s as q}from"./useParentComponentEffect-RzTyjUof.js";const H={__name:"DeviceInfo",setup(I,{expose:l}){l();const s=D(!1),e=k(),d=E(()=>e.currentMeter),f=D(!1),b=E(()=>({id:d.value.parent_id,type:d.value.type}));async function _(){e.currentMeter||e.treeDataForChart||(await e.fetchMeterList(),e.setCurrentMeter(e.treeDataForChart[0]))}_();const v={1:"虚拟设备",2:"大连思捷",3:"迈德",4:"千汇-未知公司token",5:"一个没有名字的智慧管理平台",6:"欧锐德电子"};function a(){f.value=!0}async function y(){f.value=!1,s.value=!0;try{const i=await B({id:d.value.id});i.code!==200?(console.error(i.message),u.error(i.message)):(console.log(i),e.setCurrentMeter(i.data[0]))}catch(i){console.error(i),u.error(i.message||"获取表计信息失败")}finally{s.value=!1}}function g(){s.value=!0;const i=[d.value.id];C(i).then(c=>{c.code===200?(u.success("删除成功"),e.fetchMeterList()):(console.error(c.message),u.error(c.message||"删除失败"))}).catch(c=>{console.error(c),u.error("删除失败")}).finally(()=>{s.value=!1})}const m={loading:s,meterStore:e,currentMeter:d,dialogVisible:f,parent_meter:b,initCurrentMeter:_,engineMap:v,handleEdit:a,handleUpdate:y,handleDelete:g,ref:D,computed:E,get useMeterStore(){return k},get formatDate(){return K},MeterDialog:O,get deleteMeterApi(){return C},get getMeterInfoApi(){return B},get ElMessage(){return u},get BMap(){return q},get BMarker(){return X},get useCompanyStore(){return N},get useAreaStore(){return P}};return Object.defineProperty(m,"__isScriptSetup",{enumerable:!1,value:!0}),m}},R={key:1,"element-loading-text":"loading...",class:"meter-detail"},Y={class:"actions"},$={style:{width:"100%"}};function ee(I,l,s,e,d,f){const b=J,_=G,v=j,a=Q,y=Z,g=W,m=L,i=U,c=A("permission"),V=T;return M(),h(F,null,[e.currentMeter?S((M(),h("div",R,[t(m,{class:"box-card"},{header:r(()=>[l[3]||(l[3]=p("span",null,"基本信息",-1)),S((M(),h("div",Y,[t(_,{type:"primary",onClick:e.handleEdit,size:"small"},{default:r(()=>l[1]||(l[1]=[o("编辑")])),_:1}),t(v,{class:"item",effect:"dark",content:"删除表计后，相关数据将被删除，请谨慎操作！",placement:"top"},{default:r(()=>[t(_,{type:"danger",onClick:e.handleDelete,size:"small"},{default:r(()=>l[2]||(l[2]=[o("删除")])),_:1})]),_:1})])),[[c,"manage_device"]])]),default:r(()=>[t(g,{column:2,border:""},{default:r(()=>[t(a,{label:"表计编码"},{default:r(()=>[o(n(e.currentMeter.meter_code),1)]),_:1}),t(a,{label:"引擎"},{default:r(()=>[o(n(e.engineMap[e.currentMeter.engine_id]||"未知"),1)]),_:1}),t(a,{label:e.currentMeter.engine_id===1?"表计公式":"表计外部ID"},{default:r(()=>[o(n(e.currentMeter.meter_id),1)]),_:1},8,["label"]),t(a,{label:"状态"},{default:r(()=>[t(y,{type:e.currentMeter.status===1?"success":"danger",effect:"light"},{default:r(()=>[o(n(e.currentMeter.status===1?"可用":"不可用"),1)]),_:1},8,["type"])]),_:1}),t(a,{label:"类型"},{default:r(()=>[o(n(e.currentMeter.type===1?"水表":e.currentMeter.type===2?"电表":"气表"),1)]),_:1}),t(a,{label:"规格"},{default:r(()=>[o(n(e.currentMeter.specification||"未知"),1)]),_:1}),t(a,{label:"制造商"},{default:r(()=>[o(n(e.currentMeter.manufacturer||"未知"),1)]),_:1}),t(a,{label:"一级分类"},{default:r(()=>[o(n(e.currentMeter.sub_category1||"未知"),1)]),_:1}),t(a,{label:"二级分类"},{default:r(()=>[o(n(e.currentMeter.sub_category2||"未知"),1)]),_:1}),t(a,{label:"三级分类"},{default:r(()=>[o(n(e.currentMeter.sub_category3||"未知"),1)]),_:1}),t(a,{label:"四级分类"},{default:r(()=>[o(n(e.currentMeter.sub_category4||"未知"),1)]),_:1})]),_:1})]),_:1}),t(m,{class:"box-card"},{header:r(()=>l[4]||(l[4]=[p("div",{class:"card-header"},[p("span",null,"安装信息")],-1)])),default:r(()=>[t(g,{column:2,border:""},{default:r(()=>[t(a,{label:"安装位置"},{default:r(()=>[o(n(e.currentMeter.installation_location||"未知"),1)]),_:1}),t(a,{label:"安装日期"},{default:r(()=>[o(n(e.formatDate(e.currentMeter.installation_date)),1)]),_:1}),t(a,{label:"所供区域"},{default:r(()=>[o(n(e.useAreaStore().getAreaNameById(e.currentMeter.area_id)||"未知"),1)]),_:1}),t(a,{label:"信号强度"},{default:r(()=>[o(n(e.currentMeter.CSQ),1)]),_:1}),t(a,{label:"经度"},{default:r(()=>[o(n(e.currentMeter.longitude||"未知"),1)]),_:1}),t(a,{label:"纬度"},{default:r(()=>[o(n(e.currentMeter.latitude||"未知"),1)]),_:1}),t(a,{label:"备注",span:2},{default:r(()=>[o(n(e.currentMeter.remarks||"无"),1)]),_:1})]),_:1})]),_:1}),p("div",$,[t(e.BMap,{enableScrollWheelZoom:!0,ak:"Kwc6trl7dmb2Go3SM6S5QueuW0Foa0QN",center:{lng:e.currentMeter.longitude||108.94682,lat:e.currentMeter.latitude||34.26316},zoom:e.useCompanyStore().currentCompany.zoom-1||12},{default:r(()=>[t(e.BMarker,{position:{lng:e.currentMeter.longitude,lat:e.currentMeter.latitude}},null,8,["position"])]),_:1},8,["center","zoom"])])])),[[V,e.loading]]):(M(),z(b,{key:0,description:"请先选择表计"})),t(i,{"destroy-on-close":"",title:e.currentMeter?"编辑表计":"新增表计","align-center":"",modelValue:e.dialogVisible,"onUpdate:modelValue":l[0]||(l[0]=x=>e.dialogVisible=x),width:"50%"},{default:r(()=>[t(e.MeterDialog,{"onUpdate:visible":e.handleUpdate,pMeter:e.parent_meter,id:e.currentMeter?e.currentMeter.id:null},null,8,["pMeter","id"])]),_:1},8,["title","modelValue"])],64)}const ve=w(H,[["render",ee],["__scopeId","data-v-769559d4"],["__file","D:/临时存放/green-carbon-1.0/src/views/DeviceCenter/DeviceInfo/components/DeviceInfo.vue"]]);export{ve as D};
