import{v as k,L as z,_ as R,r as E,a as x,o as U,b as $,w as q,t as A,c as M,d as S,e as u,n as O,f as g,g as y,h as H,i as s,j as i,k as W,u as j,l as D,m as V,p as G,q as J,s as K}from"./index-Bx6Y8L80.js";import{E as Q}from"./card-fNeABwz5.js";import{E as X,a as Y}from"./form-item-CWYWsPGl.js";import{E as Z}from"./button-8bviUT_H.js";import{E as ee}from"./checkbox-LjaCbo-5.js";import{E as te}from"./input-CFaQgGx5.js";import{_ as oe}from"./logo-rRFpfryy.js";import{s as ae}from"./sha256-ByTVSy_2.js";import{h as se}from"./handleError-DD4JYoq7.js";/* empty css             *//* empty css                        */import{E as re}from"./index-A4BGBRGh.js";import{E as ne}from"./index-slq3sC_j.js";import{E as L}from"./index-KJp6TXG9.js";import{E as ie}from"./index-CWCMyxJA.js";import"./plugin-vue_export-helper-CqGSI99y.js";import"./use-form-item-50hJ8Ppj.js";import"./castArray-CrUPC_Z8.js";import"./index-CuyxIfpa.js";import"./_Uint8Array-B6mJ0Xm4.js";import"./_initCloneObject-nnMrnZRY.js";import"./index-AkNVqhGZ.js";import"./icon-6zrsquxY.js";import"./isEqual-BM-Gj-iT.js";import"./index-iw6eP590.js";import"./index-DZY-cmUL.js";import"./scroll-BawlEUY1.js";import"./vnode-DK7gyQZj.js";import"./aria-BUADUvnR.js";import"./focus-trap-Ddg061Nm.js";import"./validator-ulZFuTQV.js";const le={install(m){m.directive("loading",k),m.config.globalProperties.$loading=z},directive:k,service:z},P=["#1e3a8a","#1e40af","#3b82f6","#60a5fa","#93c5fd"];class me{constructor(t,e){this.x=Math.random()*t,this.y=Math.random()*e,this.z=Math.random()*1e3,this.size=Math.random()*20+10,this.speed=Math.random()+.2,this.rotation=Math.random()*Math.PI*2,this.rotationSpeed=(Math.random()-.5)*.01,this.color=P[Math.floor(Math.random()*P.length)],this.opacity=Math.random()*.2+.1}update(t,e){this.z-=this.speed,this.rotation+=this.rotationSpeed,this.z<1&&(this.z=1e3,this.x=Math.random()*t,this.y=Math.random()*e)}draw(t,e,d){const n=1e3/(1e3-this.z),a=(this.x-e/2)*n+e/2,p=(this.y-d/2)*n+d/2,r=this.size*n;t.save(),t.translate(a,p),t.rotate(this.rotation),t.globalAlpha=this.opacity,t.fillStyle=this.color,t.beginPath(),t.moveTo(-r/2,-r/4),t.lineTo(r/2,-r/4),t.lineTo(r/3,r/4),t.lineTo(-r/3,r/4),t.closePath(),t.fill(),t.restore()}}const de={props:{particleCount:{type:Number,default:50},debug:{type:Boolean,default:!1}},setup(m){const t=E(null),e=x({width:window.innerWidth,height:window.innerHeight,particles:[]}),d={position:"fixed",top:0,left:0,width:"100%",height:"100%",zIndex:1};let n=null,a=null;const p=()=>{const c=t.value;c?(n=c.getContext("2d"),c.width=e.width,c.height=e.height):console.error("Canvas element not found")},r=()=>{e.particles=Array.from({length:m.particleCount},()=>new me(e.width,e.height))},w=()=>{if(!n){console.error("Canvas context not available");return}n.clearRect(0,0,e.width,e.height),n.fillStyle="#0f172a",n.fillRect(0,0,e.width,e.height),e.particles.forEach(c=>{c.update(e.width,e.height),c.draw(n,e.width,e.height)}),a=requestAnimationFrame(w)},_=()=>{e.width=window.innerWidth,e.height=window.innerHeight,t.value&&(t.value.width=e.width,t.value.height=e.height),r()};return U(()=>{p(),r(),w(),window.addEventListener("resize",_)}),$(()=>{a&&cancelAnimationFrame(a),window.removeEventListener("resize",_)}),q(()=>m.particleCount,c=>{r()}),{canvasRef:t,canvasStyle:d,...A(e)}}},ce={key:0,class:"debug-info"};function ue(m,t,e,d,n,a){return M(),S("div",null,[u("canvas",{ref:"canvasRef",style:O(d.canvasStyle)},null,4),e.debug?(M(),S("div",ce,[g(" Canvas size: "+y(m.width)+"x"+y(m.height),1),t[0]||(t[0]=u("br",null,null,-1)),g(" Particle count: "+y(m.particles.length),1)])):H("",!0)])}const pe=R(de,[["render",ue],["__scopeId","data-v-f16e2f26"]]),he={class:"page-container"},fe={class:"login-container"},ge={__name:"index",setup(m){const t=j(),e=D(),d=E(null),n=E(!1),a=x({username:"",password:"",rememberMe:!1}),p={username:[{required:!0,message:"请输入用户名",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:6,message:"密码长度不能少于6位",trigger:"blur"}]};let r=null;const w=async()=>{if(d.value)try{await d.value.validate(),n.value=!0,r=le.service({text:"正在登录...",background:"rgba(0, 0, 0, 0.7)"});const l=await ae(a.password),o=await G(a.username,l);o.code===200?(o.wechat_bind||await ne.alert("你还没有绑定微信，绑定微信后获得更好的体验","未绑定微信"),await _(o)):(console.error(o.message),L.error(o.message))}catch(l){console.error(l),L.error(l.message||"登录失败")}finally{n.value=!1,r&&r.close()}},_=async l=>{var v;c(l);try{await J().getUserInfo(),await K().updateUserPermissions(),ie({title:"登录成功",message:"欢迎回来"+a.username,type:"success"})}catch(b){se(b,"登录成功后获取用户信息失败")}let o=((v=e==null?void 0:e.query)==null?void 0:v.redirect)||"/";t.push(o)},c=l=>{localStorage.setItem("token",l.access_token),localStorage.setItem("refresh_token",l.refresh_token),a.rememberMe?(localStorage.setItem("username",a.username),localStorage.setItem("rememberMe","true")):(localStorage.removeItem("username"),localStorage.removeItem("rememberMe"))};return U(()=>{const l=localStorage.getItem("username");localStorage.getItem("permissions")&&localStorage.removeItem("permissions"),l&&(a.username=l,a.rememberMe=localStorage.getItem("rememberMe")==="true")}),(l,o)=>{const v=V("User"),b=re,I=te,h=X,F=V("Lock"),T=ee,C=Z,B=Y,N=Q;return M(),S("div",he,[s(pe,{particleCount:100}),u("div",fe,[s(N,{class:"login-card",shadow:"hover"},{default:i(()=>[o[7]||(o[7]=u("img",{class:"logo",src:oe,alt:"logo"},null,-1)),o[8]||(o[8]=u("h2",{class:"login-title"},"综合能源智慧管理系统",-1)),s(B,{ref_key:"loginFormRef",ref:d,model:a,rules:p,size:"large",onSubmit:W(w,["prevent"])},{default:i(()=>[s(h,{prop:"username"},{default:i(()=>[s(I,{modelValue:a.username,"onUpdate:modelValue":o[0]||(o[0]=f=>a.username=f),placeholder:"用户名",clearable:""},{prefix:i(()=>[s(b,null,{default:i(()=>[s(v)]),_:1})]),_:1},8,["modelValue"])]),_:1}),s(h,{prop:"password"},{default:i(()=>[s(I,{modelValue:a.password,"onUpdate:modelValue":o[1]||(o[1]=f=>a.password=f),type:"password",placeholder:"密码","show-password":""},{prefix:i(()=>[s(b,null,{default:i(()=>[s(F)]),_:1})]),_:1},8,["modelValue"])]),_:1}),s(h,null,{default:i(()=>[s(T,{modelValue:a.rememberMe,"onUpdate:modelValue":o[2]||(o[2]=f=>a.rememberMe=f)},{default:i(()=>o[3]||(o[3]=[g("记住我")])),_:1},8,["modelValue"])]),_:1}),s(h,null,{default:i(()=>[s(C,{type:"primary","native-type":"submit",loading:n.value},{default:i(()=>o[4]||(o[4]=[g("登录")])),_:1},8,["loading"])]),_:1}),o[6]||(o[6]=u("div",{class:"divider"},"其他登录方式",-1)),s(h,null,{default:i(()=>[s(C,{type:"success",class:"wechat-button"},{default:i(()=>o[5]||(o[5]=[u("i",{class:"iconfont icon-weixin"},null,-1),g("微信登录 ")])),_:1})]),_:1})]),_:1},8,["model"])]),_:1})])])}}},Je=R(ge,[["__scopeId","data-v-49d1cc18"]]);export{Je as default};
