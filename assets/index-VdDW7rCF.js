import{_ as M,ag as x,r as S,F as w,w as W,o as L,ah as G,c as g,d as D,k as m,l as f,T as O,U as j,J as U,e as v,g as R,f as V,ai as Z,N,h as z,K as ne,b as q,aj as se,V as J,ak as P}from"./index-DU5BV6sj.js";import{E as le,a as ie}from"./col-NhIdzeqW.js";import{E as ce}from"./card-CrntnV6K.js";/* empty css            */import{_ as pe}from"./AnimatedNumber-DsaAZO3g.js";import{E as ue,a as de}from"./skeleton-item-CJ9Yu6dc.js";import{e as me,B as Y}from"./BaseChart-DytcZ6H2.js";import{u as $}from"./meter-CawyXifQ.js";import{u as k,D as K}from"./DailyChart-CbM-HdM_.js";import{f as A}from"./date-CToM-Ban.js";import{E as _e}from"./index-DemxtX7w.js";import{u as ye,i as H,a as Q,b as X,c as he}from"./installCanvasRenderer-COQy7h5q.js";import{E as oe}from"./button-C3fNXQ0E.js";import{d as ee}from"./dayjs.min-BzhD8rH5.js";import{E as fe}from"./dialog-BqmwFatm.js";import"./overlay-CaKmC84a.js";import{E as ge}from"./scrollbar-5YYltO8z.js";import{E as ve,a as be}from"./radio-group-zQV3zrYY.js";/* empty css              */import{M as De}from"./MeterTree-D50_V8iM.js";import{E as Ce}from"./index-BCql8Cu-.js";/* empty css             *//* empty css                        */import{E as Se}from"./index-BjNTkPPk.js";import"./plugin-vue_export-helper-CqGSI99y.js";import"./index-DsemQHVw.js";import"./index-imETKNmt.js";/* empty css                */import"./popper-DmsXjoSL.js";import"./aria-BUADUvnR.js";import"./focus-trap-BFH-jL9N.js";import"./use-form-item-Bwue1zaK.js";import"./DebounceAndThrottle-B_grFKK4.js";import"./index-HfsxB2KS.js";import"./icon-Lrcg122U.js";import"./index-DspxDzgo.js";import"./scroll-b_nwKRMA.js";import"./vnode-CCieS0_D.js";import"./refs-BkwxSs2a.js";import"./MeterDialog-CfKn1aHN.js";import"./form-item-Da9sIxn1.js";import"./castArray-C1OtMDCV.js";import"./_Uint8Array-ntTh0Oyk.js";import"./_initCloneObject-CWYxvHbU.js";import"./input-Cag95VNY.js";import"./checkbox-B_XNudq6.js";import"./isEqual-Df5tNRy_.js";import"./date-picker-3aSnRp6y.js";import"./index-BcLR6-Z9.js";import"./index-BRz9a87F.js";import"./select-CVxfSd-L.js";import"./_baseIteratee-B5KIseQu.js";import"./area-CYcRQDxZ.js";import"./formula-D9TWoj50.js";import"./formula-D0gGASyU.js";import"./handleError-Dl3av5vd.js";import"./index-BmwD9m8C.js";import"./constant-CWc50EHd.js";/* empty css                 */import"./tree-D0vh79S7.js";const we={__name:"EnergyStatsCards",props:{loading:{type:Boolean,default:!1}},setup(y,{expose:s}){s(),ye([H,Q,X]);const{t}=x(),e=S([]),n=y,a=k(),i=$(),p=d=>d.toString().replace(/\B(?=(\d{3})+(?!\d))/g,","),r=w(()=>({1:{unit:"m³",name:t("dashboard.water")},2:{unit:"kWh",name:t("dashboard.electricity")},3:{unit:"m³",name:t("dashboard.gas")}})[i.currentSelectedType]||{unit:"",name:t("dashboard.usage")}),l=(d,T)=>!T||T===0?0:Number(((d-T)/T*100).toFixed(2)),o=w(()=>{var d,T,F;return n.loading||a.isLoading?Array(3).fill({title:"",total:0,timeRange:"",data:new Array(24).fill(0),change:0,compareText:""}):[{title:t("dashboard.yesterdayTotal",{type:r.value.name}),total:a.companyReportData.daily.total||0,timeRange:A(new Date,"yyyy-MM-dd"),data:((d=a.companyReportData.daily.data)==null?void 0:d.map(I=>I.Value))||[],change:l(a.companyReportData.daily.total,a.lastCompanyReportData.daily.total),compareText:t("dashboard.comparedToLast")},{title:t("dashboard.monthlyTotal",{type:r.value.name}),total:a.companyReportData.monthly.total||0,timeRange:A(new Date,"yyyy-MM"),data:((T=a.companyReportData.monthly.data)==null?void 0:T.map(I=>I.Value))||[],change:l(a.companyReportData.monthly.total,a.lastCompanyReportData.monthly.total),compareText:t("dashboard.comparedToLast")},{title:t("dashboard.yearlyTotal",{type:r.value.name}),total:a.companyReportData.yearly.total||0,timeRange:A(new Date,"yyyy"),data:((F=a.companyReportData.yearly.data)==null?void 0:F.map(I=>I.Value))||[],change:l(a.companyReportData.yearly.total,a.lastCompanyReportData.yearly.total),compareText:t("dashboard.comparedToLast")}]}),u=(d=[])=>({animation:!1,grid:{top:5,right:5,bottom:5,left:5,containLabel:!1},xAxis:{type:"category",show:!1,boundaryGap:!1},yAxis:{type:"value",show:!1,scale:!0},series:[{type:"line",data:d,smooth:!0,symbol:"none",lineStyle:{width:2,color:"#409EFF"},areaStyle:{color:{type:"linear",x:0,y:0,x2:0,y2:1,colorStops:[{offset:0,color:"rgba(64, 158, 255, 0.3)"},{offset:1,color:"rgba(64, 158, 255, 0.1)"}]}}}]});let c=[];const h=async()=>{n.loading||(c.forEach(d=>d==null?void 0:d.dispose()),c=[],await Z(),e.value.forEach((d,T)=>{if(d&&o.value[T]){const F=he(d);F.setOption(u(o.value[T].data)),c.push(F)}}))},_=()=>{c.forEach(d=>d==null?void 0:d.resize())};let b=null;const E=()=>{b&&clearTimeout(b),b=setTimeout(async()=>{await h()},300)};W([o,()=>i.currentSelectedType],E,{deep:!0}),L(()=>{window.addEventListener("resize",_),E()}),G(()=>{window.removeEventListener("resize",_),b&&clearTimeout(b),c.forEach(d=>d==null?void 0:d.dispose()),c=[]});const C={t,chartRefs:e,props:n,reportStore:a,meterStore:i,formatNumber:p,getTypeInfo:r,calculateChange:l,displayStats:o,createChartOption:u,get chartInstances(){return c},set chartInstances(d){c=d},initCharts:h,handleResize:_,get updateTimer(){return b},set updateTimer(d){b=d},debouncedUpdateCharts:E,ref:S,computed:w,watch:W,onMounted:L,onBeforeUnmount:G,nextTick:Z,get echarts(){return me},get LineChart(){return H},get GridComponent(){return Q},get CanvasRenderer(){return X},get useMeterStore(){return $},get useReportStore(){return k},get formatDate(){return A},get useI18n(){return x}};return Object.defineProperty(C,"__isScriptSetup",{enumerable:!1,value:!0}),C}},Ee={class:"stats-scroll-container"},Te={class:"card-content"},ke={class:"stat-info"},xe={class:"mini-chart-skeleton"},Me={class:"stat-info"},Re=["title"],We={class:"stat-value"},Ve={class:"stat-time"},Ae={class:"stat-comparison"};function Le(y,s,t,e,n,a){const i=ue,p=de,r=pe,l=_e,o=ce,u=le,c=ie;return g(),D("div",Ee,[m(c,{gutter:16,class:"energy-stats"},{default:f(()=>[(g(!0),D(O,null,j(e.displayStats,(h,_)=>(g(),U(u,{span:8,key:_},{default:f(()=>[m(o,{shadow:"hover"},{default:f(()=>[v("div",Te,[t.loading?(g(),D(O,{key:0},[v("div",ke,[m(p,{animated:"",rows:3},{template:f(()=>[m(i,{variant:"h3",style:{width:"80%","margin-bottom":"12px"}}),m(i,{variant:"p",style:{width:"70%",margin:"12px 0"}}),m(i,{variant:"text",style:{width:"50%"}})]),_:1})]),v("div",xe,[m(p,{animated:""},{template:f(()=>[m(i,{variant:"image",style:{width:"200px",height:"100px"}})]),_:1})])],64)):(g(),D(O,{key:1},[v("div",Me,[v("h3",{class:"stat-title",title:h.title},R(h.title),9,Re),v("p",We,[m(r,{value:h.total,formatter:e.formatNumber},null,8,["value"])]),v("p",Ve,R(h.timeRange),1),v("p",Ae,[m(l,{type:h.change>0?"danger":"success",size:"small"},{default:f(()=>[V(R(h.compareText)+R(h.change>0?"+":"")+R(h.change)+"% ",1)]),_:2},1032,["type"])])]),v("div",{class:"mini-chart",ref_for:!0,ref:"chartRefs"},null,512)],64))])]),_:2},1024)]),_:2},1024))),128))]),_:1})])}const $e=M(we,[["render",Le],["__scopeId","data-v-b6615bae"],["__file","D:/临时存放/green-carbon-1.0/src/views/EnergyData/WaterData/WaterDataCenter/ChartAnalysis/components/EnergyStatsCards.vue"]]),Fe={__name:"ChartSelect",props:{viewType:{type:Array,default:["periods","chartTypes"]},modelValue:{type:Object,required:!0,default:()=>({chartType:"bar",period:"daily"})},chartId:{type:String,default:"default"}},emits:["update:modelValue"],setup(y,{expose:s,emit:t}){s();const e=y,n=t,l={props:e,emit:n,chartTypes:[{value:"line",icon:"fa fa-line-chart",label:"折线图"},{value:"bar",icon:"fa fa-bar-chart",label:"柱状图"}],periods:[{value:"daily",label:"日"},{value:"weekly",label:"周"},{value:"monthly",label:"月"},{value:"yearly",label:"年"}],updateChartType:o=>{n("update:modelValue",{...e.modelValue,chartType:o})},updatePeriod:o=>{n("update:modelValue",{...e.modelValue,period:o})}};return Object.defineProperty(l,"__isScriptSetup",{enumerable:!1,value:!0}),l}},Ie={class:"chart-selector"},Oe={key:0,class:"button-group"},Ne={key:1,class:"button-group"};function Pe(y,s,t,e,n,a){const i=oe;return g(),D("div",Ie,[t.viewType.includes("chartTypes")?(g(),D("div",Oe,[(g(),D(O,null,j(e.chartTypes,p=>m(i,{key:p.value,class:N({"is-active":t.modelValue.chartType===p.value}),onClick:r=>e.updateChartType(p.value),round:""},{icon:f(()=>[v("i",{class:N(p.icon)},null,2)]),_:2},1032,["class","onClick"])),64))])):z("",!0),t.viewType.includes("periods")?(g(),D("div",Ne,[(g(),D(O,null,j(e.periods,p=>m(i,{key:p.value,class:N({"is-active":t.modelValue.period===p.value}),onClick:r=>e.updatePeriod(p.value),round:""},{default:f(()=>[V(R(p.label),1)]),_:2},1032,["class","onClick"])),64))])):z("",!0)])}const Be=M(Fe,[["render",Pe],["__scopeId","data-v-c815b385"],["__file","D:/临时存放/green-carbon-1.0/src/views/EnergyData/WaterData/WaterDataCenter/ChartAnalysis/components/components/ChartSelect.vue"]]),je={__name:"WeeklyChart",props:{chartType:{type:String,default:"bar"}},setup(y,{expose:s}){s();const{t}=x(),e=k(),n=y,a=l=>{const o=[t("date.week[0]"),t("date.week[1]"),t("date.week[2]"),t("date.week[3]"),t("date.week[4]"),t("date.week[5]"),t("date.week[6]")],u=new Date(l);return o[u.getDay()]},i=l=>{var o;return(o=l==null?void 0:l.data)!=null&&o.length?l.data.map(u=>({time:a(u.start_time),value:Number(u.Value||0).toFixed(2)})):[]},p=w(()=>{const l=e.fourWeekData[0],o=e.fourWeekData[1],u=e.fourWeekData[2],c=e.fourWeekData[3],h=i(l),_=i(o),b=i(u),E=i(c);return!h.length&&!_.length&&!b.length&&!E.length?null:{title:t("date.title.weekly"),xAxisData:h.map(C=>C.time),series:[{name:t("date.label.threeWeeksAgo"),data:E.map(C=>C.value),type:n.chartType,showExtremum:!0},{name:t("date.label.twoWeeksAgo"),data:b.map(C=>C.value),type:n.chartType,showExtremum:!0},{name:t("date.label.lastWeek"),data:_.map(C=>C.value),type:n.chartType,showExtremum:!0},{name:t("date.label.thisWeek"),data:h.map(C=>C.value),type:n.chartType,showExtremum:!0}],showMarkLine:!0,showZoom:!1}}),r={t,reportStore:e,props:n,getWeekDayName:a,formatChartData:i,chartOption:p,computed:w,get useReportStore(){return k},get useI18n(){return x},BaseChart:Y};return Object.defineProperty(r,"__isScriptSetup",{enumerable:!1,value:!0}),r}},ze={class:"chart-wrapper"};function Ue(y,s,t,e,n,a){return g(),D("div",ze,[m(e.BaseChart,{height:"100%",options:e.chartOption},null,8,["options"])])}const te=M(je,[["render",Ue],["__file","D:/临时存放/green-carbon-1.0/src/views/EnergyData/WaterData/WaterDataCenter/ChartAnalysis/components/charts/WeeklyChart.vue"]]),Ye={__name:"MonthlyChart",props:{chartType:{type:String,default:"bar"}},setup(y,{expose:s}){s();const{t}=x(),e=k(),n=y,a=r=>{var l;return(l=r==null?void 0:r.data)!=null&&l.length?r.data.map(o=>({time:ee(o.start_time).format("DD"),value:Number(o.Value||0).toFixed(2)})):[]},i=w(()=>{const r=e.getReportDataList("monthly"),l=e.getReportDataList("monthly",!0),o=a(r),u=a(l);return!o.length&&!u.length?null:{title:t("date.title.monthly"),xAxisData:o.map(c=>c.time),series:[{name:t("date.label.lastMonth"),data:u.map(c=>c.value),type:n.chartType,showExtremum:!0},{name:t("date.label.thisMonth"),data:o.map(c=>c.value),type:n.chartType,showExtremum:!0}],customColors:["#DEEEFF","#409EFF"],showMarkLine:!0,showZoom:!1}}),p={t,reportStore:e,props:n,formatChartData:a,chartOption:i,computed:w,get useReportStore(){return k},get useI18n(){return x},BaseChart:Y,get dayjs(){return ee}};return Object.defineProperty(p,"__isScriptSetup",{enumerable:!1,value:!0}),p}},Ge={class:"chart-wrapper",style:{height:"100%",width:"100%"}};function Ze(y,s,t,e,n,a){return g(),D("div",Ge,[m(e.BaseChart,{height:"100%",options:e.chartOption},null,8,["options"])])}const ae=M(Ye,[["render",Ze],["__scopeId","data-v-f38d8a56"],["__file","D:/临时存放/green-carbon-1.0/src/views/EnergyData/WaterData/WaterDataCenter/ChartAnalysis/components/charts/MonthlyChart.vue"]]),qe={__name:"YearlyChart",props:{chartType:{type:String,default:"bar"}},setup(y,{expose:s}){s();const{t}=x(),e=k(),n=y,a=r=>{var l;return(l=r==null?void 0:r.data)!=null&&l.length?r.data.map(o=>({time:A(o.start_time,"MM"),value:Number(o.Value||0).toFixed(2)})):[]},i=w(()=>{const r=e.getReportDataList("yearly"),l=e.getReportDataList("yearly",!0),o=a(r),u=a(l);return!o.length&&!u.length?null:{title:t("date.title.yearly"),xAxisData:o.map(c=>c.time),series:[{name:t("date.label.lastYear"),data:u.map(c=>c.value),type:n.chartType,showExtremum:!0},{name:t("date.label.thisYear"),data:o.map(c=>c.value),type:n.chartType,showExtremum:!0}],customColors:["#d7ebff","#409EFF"],showMarkLine:!0,showZoom:!1}}),p={t,reportStore:e,props:n,formatChartData:a,chartOption:i,computed:w,get useReportStore(){return k},get useI18n(){return x},BaseChart:Y,get formatDate(){return A}};return Object.defineProperty(p,"__isScriptSetup",{enumerable:!1,value:!0}),p}},Je={class:"chart-wrapper"};function Ke(y,s,t,e,n,a){return g(),D("div",Je,[m(e.BaseChart,{height:"100%",options:e.chartOption},null,8,["options"])])}const re=M(qe,[["render",Ke],["__scopeId","data-v-5bb50bfc"],["__file","D:/临时存放/green-carbon-1.0/src/views/EnergyData/WaterData/WaterDataCenter/ChartAnalysis/components/charts/YearlyChart.vue"]]),He={__name:"EnergyChart",setup(y,{expose:s}){s();const t=S({chartType:"bar",period:"daily"}),e=w(()=>({daily:K,weekly:te,monthly:ae,yearly:re})[t.value.period]),n={chartState:t,currentChartComponent:e,ref:S,computed:w,ChartSelect:Be,DailyChart:K,WeeklyChart:te,MonthlyChart:ae,YearlyChart:re};return Object.defineProperty(n,"__isScriptSetup",{enumerable:!1,value:!0}),n}},Qe={class:"chart-scroll-container"},Xe={class:"chart-container"},et={class:"chart-header"};function tt(y,s,t,e,n,a){return g(),D("div",Qe,[v("div",Xe,[v("div",et,[m(e.ChartSelect,{"chart-id":"water",modelValue:e.chartState,"onUpdate:modelValue":s[0]||(s[0]=i=>e.chartState=i)},null,8,["modelValue"])]),(g(),U(ne(e.currentChartComponent),{chartType:e.chartState.chartType,class:"charts"},null,8,["chartType"]))])])}const at=M(He,[["render",tt],["__scopeId","data-v-009fa469"],["__file","D:/临时存放/green-carbon-1.0/src/views/EnergyData/WaterData/WaterDataCenter/ChartAnalysis/components/EnergyChart.vue"]]),rt={__name:"MeterSelector",props:{type:{type:Number,default:1}},setup(y,{expose:s}){s();const t=$(),e=S(!1),n=S(!1),a=S(t.currentMeter?"specific":"all"),i=y,p=u=>{u==="all"&&t.setCurrentMeter(null)},r=()=>{a.value==="all"&&t.setCurrentMeter(null),n.value=!1},l=async()=>{try{e.value=!0,await t.fetchMeterList({type:i.type})}catch(u){console.error("Error fetching meters:",u)}finally{e.value=!1}};W(()=>t.currentMeter,u=>{a.value=u?"specific":"all"}),L(()=>{t.setCurrentMeter(null),l()}),q(()=>{t.setCurrentMeter(null)});const o={meterStore:t,loading:e,dialogVisible:n,selectedType:a,props:i,handleSelectAll:p,handleConfirm:r,getMeters:l,ref:S,watch:W,onMounted:L,onUnmounted:q,get Filter(){return se},MeterTree:De,get useMeterStore(){return $}};return Object.defineProperty(o,"__isScriptSetup",{enumerable:!1,value:!0}),o}},ot={class:"meter-selector"},nt={class:"meter-selector__content"},st={class:"select-all-option"},lt={class:"dialog-footer"};function it(y,s,t,e,n,a){const i=Ce,p=oe,r=ve,l=be,o=ge,u=fe;return g(),D("div",ot,[m(p,{type:"primary",onClick:s[0]||(s[0]=c=>e.dialogVisible=!0)},{icon:f(()=>[m(i,null,{default:f(()=>[m(e.Filter)]),_:1})]),default:f(()=>[V(" "+R(e.meterStore.currentMeter?e.meterStore.currentMeter.meter_code:"全部"),1)]),_:1}),m(u,{modelValue:e.dialogVisible,"onUpdate:modelValue":s[2]||(s[2]=c=>e.dialogVisible=c),title:"当前表计:"+(e.meterStore.currentMeter?e.meterStore.currentMeter.meter_code:"全部"),width:"600px"},{footer:f(()=>[v("span",lt,[m(p,{type:"primary",onClick:e.handleConfirm},{default:f(()=>s[5]||(s[5]=[V(" 确认 ")])),_:1})])]),default:f(()=>[v("div",nt,[v("div",st,[m(l,{modelValue:e.selectedType,"onUpdate:modelValue":s[1]||(s[1]=c=>e.selectedType=c),onChange:e.handleSelectAll},{default:f(()=>[m(r,{label:"all"},{default:f(()=>s[3]||(s[3]=[V("全部")])),_:1}),m(r,{label:"specific"},{default:f(()=>s[4]||(s[4]=[V("选择具体表计")])),_:1})]),_:1},8,["modelValue"])]),m(o,{height:"400px"},{default:f(()=>[m(e.MeterTree,{data:e.meterStore.treeDataForChart,disabled:e.selectedType==="all"},null,8,["data","disabled"])]),_:1})])]),_:1},8,["modelValue","title"])])}const ct=M(rt,[["render",it],["__scopeId","data-v-9353a566"],["__file","D:/临时存放/green-carbon-1.0/src/views/EnergyData/WaterData/WaterDataCenter/ChartAnalysis/components/MeterSelector.vue"]]),B=1,pt={__name:"index",setup(y,{expose:s}){s();const t=$(),e=k(),n=J(),{currentMeter:a,currentSelectedType:i}=P(t),{currentCompany:p}=P(n),r=S(!1),l=S(!1),o=_=>{console.error(_),Se({title:"数据加载失败",message:(_==null?void 0:_.message)||"数据加载失败",type:"error"})},u=async()=>{if(!r.value)try{r.value=!0,await e.fetchAllReportsData()}catch(_){o(_)}finally{r.value=!1}},c=async()=>{if(!r.value)try{r.value=!0,t.setCurrentMeter(null),t.setCurrentSelectedType(B),await t.fetchMeterList(),await e.fetchAllReportsData()}catch(_){o(_)}finally{r.value=!1}};W([a,i],async([_,b],[E,C])=>{if(!l.value){_&&b&&(l.value=!0,await u());return}(_!==E||b!==C)&&await u()},{deep:!0}),W(p,async(_,b)=>{if(!(!_||_===b))try{r.value=!0,t.setCurrentSelectedType(B),t.setCurrentMeter(null),await e.fetchAllReportsData()}catch(E){o(E)}finally{r.value=!1}}),L(()=>{c()});const h={SELECTED_METER_TYPE:B,meterStore:t,reportStore:e,companyStore:n,currentMeter:a,currentSelectedType:i,currentCompany:p,isLoading:r,initialized:l,handleError:o,fetchAllReportsData:u,initializeData:c,ref:S,watch:W,onMounted:L,get storeToRefs(){return P},EnergyStatsCards:$e,EnergyChart:at,MeterSelector:ct,get useMeterStore(){return $},get useReportStore(){return k},get useCompanyStore(){return J}};return Object.defineProperty(h,"__isScriptSetup",{enumerable:!1,value:!0}),h}},ut={class:"dashboard"},dt={class:"dashboard-header page-title"};function mt(y,s,t,e,n,a){return g(),D("div",ut,[v("div",dt,[m(e.MeterSelector,{type:e.SELECTED_METER_TYPE})]),m(e.EnergyStatsCards,{loading:e.isLoading},null,8,["loading"]),e.isLoading?z("",!0):(g(),U(e.EnergyChart,{key:0,style:{"margin-top":"16px"}}))])}const ba=M(pt,[["render",mt],["__scopeId","data-v-ed2ea1a2"],["__file","D:/临时存放/green-carbon-1.0/src/views/EnergyData/WaterData/WaterDataCenter/ChartAnalysis/index.vue"]]);export{ba as default};
